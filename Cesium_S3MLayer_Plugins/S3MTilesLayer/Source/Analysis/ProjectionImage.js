const _0x3d4146=(function(){let _0x4fffe4=!![];return function(_0x1da471,_0x5dcda0){const _0x1f738d=_0x4fffe4?function(){if(_0x5dcda0){const _0x312daa=_0x5dcda0['apply'](_0x1da471,arguments);return _0x5dcda0=null,_0x312daa;}}:function(){};return _0x4fffe4=![],_0x1f738d;};}()),_0x3aa468=_0x3d4146(this,function(){return _0x3aa468['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x3aa468)['search']('(((.+)+)+)+$');});_0x3aa468();import _0x55f3a4 from'./DepthFramebuffer.js';import _0x32a03d from'./Shaders/NoLightNoTextureVS.js';import _0x5be12d from'./Shaders/NoLightNoTextureFS.js';import _0x3bfc37 from'./Shaders/ViewShedAnalysisVS.js';import _0x1733c1 from'./Shaders/ProjectionImageFS.js';import _0x554dc1 from'./XMLParser.js';const _0x2a4f3d=Cesium['BoundingSphere'],_0x22b9ac=Cesium['Cartesian2'],_0x127463=Cesium['Cartesian3'],_0xc7ea4e=Cesium['Cartesian4'],_0x353564=Cesium['Color'],_0x5e83af=Cesium['ComponentDatatype'],_0x2f29d8=Cesium['defined'],_0xb20698=Cesium['defaultValue'],_0x3ce731=Cesium['destroyObject'],_0x7c7da5=Cesium['DeveloperError'],_0x3d52bd=Cesium['IndexDatatype'],_0x135c04=Cesium['Math'],_0x510c39=Cesium['Matrix4'],_0x4f4674=Cesium['PrimitiveType'],_0x3e9050=Cesium['Check'],_0x1bd265=Cesium['appendForwardSlash'],_0x141efd=Cesium['Rectangle'],_0x1864d9=Cesium['Intersect'],_0x267725=Cesium['Cartographic'],_0xba25cc=Cesium['Pass'],_0xa6ba60=Cesium['Buffer'],_0x4598b7=Cesium['BufferUsage'],_0x1c77d9=Cesium['DrawCommand'],_0x2c78a8=Cesium['RenderState'],_0x55839c=Cesium['Texture'],_0x5ade83=Cesium['ShaderProgram'],_0x58f09e=Cesium['VertexArray'],_0x1bb0d5=Cesium['ShaderSource'],_0x208b49=Cesium['BlendingState'],_0x25f7eb=Cesium['SceneMode'],_0x49f4cf=Cesium['StencilOperation'],_0x314a5f=Cesium['StencilFunction'],_0xf51908=Cesium['DepthFunction'],_0x1404ec=Cesium['Resource'];function _0x556621(_0x37223f){if(!_0x2f29d8(_0x37223f))throw new _0x7c7da5('scene\x20are\x20required.');if(!_0x37223f['context']['depthTexture'])throw new _0x7c7da5('the\x20depth\x20buffer\x20is\x20not\x20supported.');this['scene']=_0x37223f,this['_cameraDepthBuffer']=undefined,this['_lineCommand']=undefined,this['_stencilCommand']=undefined,this['_colorCommand']=undefined,this['_boundingSphere']=new _0x2a4f3d(),this['_viewPosition']=[0x0,0x0,0x0],this['_direction']=0x0,this['_pitch']=0x0,this['_roll']=0x0,this['_horizontalFov']=0x5a,this['_verticalFov']=0x3c,this['_distance']=0xc8,this['_hintLineColor']=new _0x353564(0x1,0x1,0x1,0x1),this['_hintLineVisible']=!![],this['_texture']=undefined,this['_segmentCount']=0x14,this['_invertViewMatrix']=new _0x510c39(),this['_viewProjMatrix']=new _0x510c39(),this['_renderTextureMatrix']=new _0x510c39(),this['_update']=!![],this['_video']=undefined,this['_brightness']=0x1,this['_contrast']=0x1,this['_hue']=0x0,this['_saturation']=0x1,this['_gamma']=0x1,this['_featheringScale']=0x0,this['_v3AffineX']=new _0x127463(0x1,0x0,0x0),this['_v3AffineY']=new _0x127463(0x0,0x1,0x0),this['_visible']=!![],this['_visibleDistanceMax']=0x1f4,this['isBuild']=![];}Object['defineProperties'](_0x556621['prototype'],{'viewPosition':{'get':function(){return this['_viewPosition'];},'set':function(_0x52548f){this['_viewPosition']=_0x52548f,this['_update']=!![];}},'direction':{'get':function(){return this['_direction'];},'set':function(_0x5466ba){this['_direction']=_0x5466ba,this['_update']=!![];}},'pitch':{'get':function(){return this['_pitch'];},'set':function(_0x59bd16){this['_pitch']=_0x59bd16,this['_update']=!![];}},'roll':{'get':function(){return this['_roll'];},'set':function(_0x484b20){this['_roll']=_0x484b20,this['_update']=!![];}},'horizontalFov':{'get':function(){return this['_horizontalFov'];},'set':function(_0x25711f){this['_horizontalFov']=_0x25711f,this['_update']=!![];}},'verticalFov':{'get':function(){return this['_verticalFov'];},'set':function(_0x934e0){this['_verticalFov']=_0x934e0,this['_update']=!![];}},'distance':{'get':function(){return this['_distance'];},'set':function(_0x80c678){if(_0x80c678<=0x0)throw new _0x7c7da5('the\x20distance\x20is\x20greater\x20than\x200.0');this['_distance']=_0x80c678,this['_update']=!![];}},'featheringScale':{'get':function(){return this['_featheringScale'];},'set':function(_0x12ec99){if(_0x12ec99<0x0||_0x12ec99>0x1)throw new _0x7c7da5('the\x20distance\x20is\x20greater\x20than\x200.0\x20an\x20less\x20than\x201.0');this['_featheringScale']=_0x12ec99;}},'hintLineColor':{'get':function(){return this['_hintLineColor'];},'set':function(_0xa33419){if(!_0x2f29d8(_0xa33419))return;this['_hintLineColor']=_0x353564['clone'](_0xa33419,this['_hintLineColor']);}},'hintLineVisible':{'get':function(){return this['_hintLineVisible'];},'set':function(_0x254fe9){this['_hintLineVisible']=_0x254fe9;}},'brightness':{'get':function(){return this['_brightness'];},'set':function(_0x3565ae){_0x3e9050['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.brightness',_0x3565ae,0x0),this['_brightness']=_0x3565ae;}},'contrast':{'get':function(){return this['_contrast'];},'set':function(_0x1b9c76){_0x3e9050['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.contrast',_0x1b9c76,0x0),this['_contrast']=_0x1b9c76;}},'hue':{'get':function(){return this['_hue'];},'set':function(_0x51a151){_0x3e9050['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.hue',_0x51a151,0x0),this['_hue']=_0x51a151;}},'saturation':{'get':function(){return this['_saturation'];},'set':function(_0x4ae730){_0x3e9050['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.saturation',_0x4ae730,0x0),this['_saturation']=_0x4ae730;}},'gamma':{'get':function(){return this['_gamma'];},'set':function(_0x48b805){_0x3e9050['typeOf']['number']['greaterThan']('ProjectionImage.gamma',_0x48b805,0x0),this['_gamma']=_0x48b805;}},'visible':{'get':function(){return this['_visible'];},'set':function(_0x51d7ba){_0x3e9050['typeOf']['bool']('ProjectionImage.visible',_0x51d7ba),this['_visible']=_0x51d7ba;}},'visibleDistanceMax':{'get':function(){return this['_visibleDistanceMax'];},'set':function(_0x3636cf){_0x3e9050['typeOf']['number']('ProjectionImage.visibleDistance',_0x3636cf),this['_visibleDistanceMax']=_0x3636cf;}}});function _0x19152e(_0x276d70){_0x2f29d8(_0x276d70['_stencilCommand'])&&(_0x276d70['_stencilCommand']['vertexArray']=_0x276d70['_stencilCommand']['vertexArray']&&_0x276d70['_stencilCommand']['vertexArray']['destroy'](),_0x276d70['_stencilCommand']['shaderProgram']=_0x276d70['_stencilCommand']['shaderProgram']&&_0x276d70['_stencilCommand']['shaderProgram']['destroy'](),_0x276d70['_stencilCommand']=undefined),_0x2f29d8(_0x276d70['_colorCommand'])&&(_0x276d70['_colorCommand']['vertexArray']=_0x276d70['_colorCommand']['vertexArray']&&_0x276d70['_colorCommand']['vertexArray']['destroy'](),_0x276d70['_colorCommand']['shaderProgram']=_0x276d70['_colorCommand']['shaderProgram']&&_0x276d70['_colorCommand']['shaderProgram']['destroy'](),_0x276d70['_colorCommand']=undefined),_0x2f29d8(_0x276d70['_lineCommand'])&&(_0x276d70['_lineCommand']['vertexArray']=_0x276d70['_lineCommand']['vertexArray']&&_0x276d70['_lineCommand']['vertexArray']['destroy'](),_0x276d70['_lineCommand']['shaderProgram']=_0x276d70['_lineCommand']['shaderProgram']&&_0x276d70['_lineCommand']['shaderProgram']['destroy'](),_0x276d70['_lineCommand']=undefined);}function _0x2d0063(_0x519a19,_0x1daa23,_0x100b1c){const _0x568b22=_0x519a19['_horizontalFov']*_0x135c04['RADIANS_PER_DEGREE'],_0x3c4b28=_0x519a19['_verticalFov']*_0x135c04['RADIANS_PER_DEGREE'],_0x4e679b=Math['tan'](_0x568b22*0.5),_0x288cb5=Math['tan'](_0x3c4b28*0.5),_0x3c40f2=_0x4e679b/_0x288cb5,_0x49e0b9=_0x519a19['_distance']*0.001,_0x242ec8=Math['max'](_0x519a19['_distance'],0xa),_0x58469e=_0x519a19['_direction']*_0x135c04['RADIANS_PER_DEGREE'],_0x11db62=_0x519a19['_pitch']*_0x135c04['RADIANS_PER_DEGREE'],_0x59c29b=_0x519a19['_roll']*_0x135c04['RADIANS_PER_DEGREE'],_0x1a4993=_0x127463['fromDegreesArrayHeights'](_0x519a19['_viewPosition'])[0x0],_0x42a36f=_0x100b1c['camera'],_0x1921f4=_0x42a36f['frustum']['aspectRatio'],_0x1bed84=_0x42a36f['frustum']['fov'],_0x30b353=_0x42a36f['frustum']['near'],_0x4762e9=_0x42a36f['frustum']['far'],_0x1d457e=new _0x127463(),_0x3fad8d=_0x42a36f['heading'],_0x404446=_0x42a36f['pitch'],_0x4ac7f4=_0x42a36f['roll'];_0x127463['clone'](_0x42a36f['position'],_0x1d457e),_0x519a19['_cameraDepthBuffer']['isUpdate']=!![];const _0x5c1b00=_0x100b1c['useLogDepth'];_0x519a19['_cameraDepthBuffer']['beginFunc']=function(){_0x100b1c['useLogDepth']=![],_0x127463['clone'](_0x42a36f['position'],_0x1d457e),_0x42a36f['frustum']['aspectRatio']=_0x3c40f2,_0x42a36f['frustum']['fov']=_0x3c40f2>=0x1?_0x568b22:_0x3c4b28,_0x42a36f['frustum']['near']=0x1,_0x42a36f['frustum']['far']=_0x242ec8,_0x5c1b00&&(_0x42a36f['frustum']['near']=0.1,_0x42a36f['frustum']['far']=0x5f5e100),_0x42a36f['setView']({'destination':_0x1a4993,'orientation':{'heading':_0x58469e,'pitch':_0x11db62,'roll':_0x59c29b}}),_0x510c39['multiply'](_0x42a36f['frustum']['projectionMatrix'],_0x42a36f['viewMatrix'],_0x519a19['_viewProjMatrix']),_0x510c39['clone'](_0x42a36f['inverseViewMatrix'],_0x519a19['_invertViewMatrix']),_0x127463['clone'](_0x127463['ZERO'],_0x519a19['_boundingSphere']['center']),_0x519a19['_boundingSphere']['radius']=_0x519a19['_distance'],_0x2a4f3d['transform'](_0x519a19['_boundingSphere'],_0x519a19['_invertViewMatrix'],_0x519a19['_boundingSphere']);},_0x519a19['_cameraDepthBuffer']['endFunc']=function(){_0x42a36f['setView']({'destination':_0x1d457e,'orientation':{'heading':_0x3fad8d,'pitch':_0x404446,'roll':_0x4ac7f4},'convert':![]}),_0x42a36f['frustum']['aspectRatio']=_0x1921f4,_0x42a36f['frustum']['fov']=_0x1bed84,_0x42a36f['frustum']['near']=_0x30b353,_0x42a36f['frustum']['far']=_0x4762e9,_0x100b1c['useLogDepth']=_0x5c1b00,_0x519a19['_cameraDepthBuffer']['isUpdate']=![];};}function _0x10784e(_0xce6483,_0x2f2184,_0x29b800){const _0x2a00fc=(_0xce6483['_segmentCount']+0x1)*(_0xce6483['_segmentCount']+0x1)+0x1,_0x43e264=_0x5e83af['createTypedArray'](_0x5e83af['FLOAT'],_0x2a00fc*0x3);let _0x7c4588=0x3;const _0x211159=_0xce6483['_horizontalFov']*_0x135c04['RADIANS_PER_DEGREE'],_0x28baba=_0xce6483['_verticalFov']*_0x135c04['RADIANS_PER_DEGREE'],_0x367f09=Math['tan'](_0x211159*0.5),_0x4494bd=Math['tan'](_0x28baba*0.5),_0x226a97=_0xce6483['_distance']*_0x367f09,_0x3bcab5=_0xce6483['_distance']*_0x4494bd,_0x54409b=Math['PI']-_0x211159*0.5;let _0x150876=0x0,_0xeca884=0x0,_0x1a76ea=_0x211159/_0xce6483['_segmentCount'];for(let _0x316b07=0x0;_0x316b07<_0xce6483['_segmentCount']+0x1;_0x316b07++){_0x150876=_0x54409b+_0x316b07*_0x1a76ea;const _0xd579ae=_0x3bcab5/(_0xce6483['_distance']/Math['cos'](_0x150876)),_0x2d6980=Math['atan'](_0xd579ae),_0x429900=-_0x2d6980,_0x596eb2=_0x2d6980*0x2/_0xce6483['_segmentCount'];for(let _0x5976aa=0x0;_0x5976aa<_0xce6483['_segmentCount']+0x1;_0x5976aa++){_0xeca884=_0x429900+_0x5976aa*_0x596eb2,_0x43e264[_0x7c4588++]=_0xce6483['_distance']*Math['cos'](_0xeca884)*Math['sin'](_0x150876),_0x43e264[_0x7c4588++]=_0xce6483['_distance']*Math['sin'](_0xeca884),_0x43e264[_0x7c4588++]=_0xce6483['_distance']*Math['cos'](_0xeca884)*Math['cos'](_0x150876);}}const _0x50c904=(0x4+_0xce6483['_segmentCount']*0x5+_0xce6483['_segmentCount']*0x2*0x3)*0x2,_0x521615=_0xce6483['_segmentCount']*_0xce6483['_segmentCount']*0x3*0x2+_0xce6483['_segmentCount']*0x3*0x4,_0xb436d6=_0x5e83af['createTypedArray'](_0x5e83af['UNSIGNED_SHORT'],_0x50c904),_0x243bbf=_0x5e83af['createTypedArray'](_0x5e83af['UNSIGNED_SHORT'],_0x521615);let _0x164be7=0x0;const _0x45cb55=0x1;for(let _0x6153bb=0x0;_0x6153bb<_0xce6483['_segmentCount'];_0x6153bb++){for(let _0x217a49=0x0;_0x217a49<_0xce6483['_segmentCount'];_0x217a49++){_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+_0x217a49*(_0xce6483['_segmentCount']+0x1),_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+0x1+_0x217a49*(_0xce6483['_segmentCount']+0x1),_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+(_0x217a49+0x1)*(_0xce6483['_segmentCount']+0x1),_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+0x1+_0x217a49*(_0xce6483['_segmentCount']+0x1),_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+0x1+(_0x217a49+0x1)*(_0xce6483['_segmentCount']+0x1),_0x243bbf[_0x164be7++]=_0x45cb55+_0x6153bb+(_0x217a49+0x1)*(_0xce6483['_segmentCount']+0x1);}}for(let _0x15c76b=0x0;_0x15c76b<_0xce6483['_segmentCount'];_0x15c76b++){_0x243bbf[_0x164be7++]=_0x15c76b+0x1+_0x45cb55,_0x243bbf[_0x164be7++]=_0x15c76b+_0x45cb55,_0x243bbf[_0x164be7++]=0x0,_0x243bbf[_0x164be7++]=0x0,_0x243bbf[_0x164be7++]=_0x15c76b+_0xce6483['_segmentCount']*(_0xce6483['_segmentCount']+0x1)+_0x45cb55,_0x243bbf[_0x164be7++]=_0x15c76b+0x1+_0xce6483['_segmentCount']*(_0xce6483['_segmentCount']+0x1)+_0x45cb55;}for(let _0x1b8f8e=0x0;_0x1b8f8e<_0xce6483['_segmentCount'];_0x1b8f8e++){_0x243bbf[_0x164be7++]=0x0,_0x243bbf[_0x164be7++]=_0x1b8f8e*(_0xce6483['_segmentCount']+0x1)+_0x45cb55,_0x243bbf[_0x164be7++]=(_0x1b8f8e+0x1)*(_0xce6483['_segmentCount']+0x1)+_0x45cb55,_0x243bbf[_0x164be7++]=_0xce6483['_segmentCount']+(_0x1b8f8e+0x1)*(_0xce6483['_segmentCount']+0x1)+_0x45cb55,_0x243bbf[_0x164be7++]=_0xce6483['_segmentCount']+_0x1b8f8e*(_0xce6483['_segmentCount']+0x1)+_0x45cb55,_0x243bbf[_0x164be7++]=0x0;}_0x164be7=0x0,_0xb436d6[_0x164be7++]=0x0,_0xb436d6[_0x164be7++]=0x1,_0xb436d6[_0x164be7++]=0x0,_0xb436d6[_0x164be7++]=_0xce6483['_segmentCount']+0x1,_0xb436d6[_0x164be7++]=0x0,_0xb436d6[_0x164be7++]=_0xce6483['_segmentCount']*(_0xce6483['_segmentCount']+0x1)+0x1,_0xb436d6[_0x164be7++]=0x0,_0xb436d6[_0x164be7++]=(_0xce6483['_segmentCount']+0x1)*(_0xce6483['_segmentCount']+0x1);for(let _0x46b774=0x0;_0x46b774<0x5;_0x46b774++){for(let _0x1e6b62=0x0;_0x1e6b62<_0xce6483['_segmentCount'];_0x1e6b62++){_0xb436d6[_0x164be7++]=0x1+_0x1e6b62+(_0xce6483['_segmentCount']+0x1)*0x5*_0x46b774,_0xb436d6[_0x164be7++]=0x1+(_0x1e6b62+0x1)+(_0xce6483['_segmentCount']+0x1)*0x5*_0x46b774;}}for(let _0x1510b9=0x0;_0x1510b9<0x5;_0x1510b9++){for(let _0x57bf86=0x0;_0x57bf86<_0xce6483['_segmentCount'];_0x57bf86++){_0xb436d6[_0x164be7++]=0x1+(_0xce6483['_segmentCount']+0x1)*_0x57bf86+_0x1510b9*0x5,_0xb436d6[_0x164be7++]=0x1+(_0xce6483['_segmentCount']+0x1)*(_0x57bf86+0x1)+_0x1510b9*0x5;}}const _0x199307=_0xa6ba60['createVertexBuffer']({'context':_0x2f2184,'typedArray':_0x43e264,'usage':_0x4598b7['STATIC_DRAW']}),_0x447b0e=[],_0x58b4e0={};_0x58b4e0['aPosition']=0x0,_0x447b0e['push']({'index':_0x58b4e0['aPosition'],'vertexBuffer':_0x199307,'componentsPerAttribute':0x3,'componentDatatype':_0x5e83af['FLOAT'],'offsetInBytes':0x0,'strideInBytes':0x3*0x4,'normalize':![]});const _0x385ee5=_0xa6ba60['createIndexBuffer']({'context':_0x2f2184,'typedArray':_0xb436d6,'usage':_0x4598b7['STATIC_DRAW'],'indexDatatype':_0x3d52bd['UNSIGNED_SHORT']}),_0x429dd6=_0xa6ba60['createIndexBuffer']({'context':_0x2f2184,'typedArray':_0x243bbf,'usage':_0x4598b7['STATIC_DRAW'],'indexDatatype':_0x3d52bd['UNSIGNED_SHORT']});_0xce6483['_lineCommand']=new _0x1c77d9({'primitiveType':_0x4f4674['LINES'],'modelMatrix':_0xce6483['_invertViewMatrix'],'boundingVolume':_0xce6483['_boundingSphere'],'pass':_0xba25cc['OPAQUE'],'owner':_0xce6483,'cull':!![]}),_0xce6483['_lineCommand']['vertexArray']=new _0x58f09e({'context':_0x2f2184,'attributes':_0x447b0e,'indexBuffer':_0x385ee5}),_0xce6483['_lineCommand']['shaderProgram']=_0x5ade83['fromCache']({'context':_0x2f2184,'vertexShaderSource':_0x32a03d,'fragmentShaderSource':_0x5be12d,'attributeLocations':_0x58b4e0}),_0xce6483['_lineCommand']['renderState']=_0x2c78a8['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![]}});const _0x3a5fbb=[];for(let _0xdca1ab=0x0;_0xdca1ab<0x6;_0xdca1ab++){_0x3a5fbb[_0xdca1ab]=new _0xc7ea4e(0x0,0x0,0x0,0x0);}_0xce6483['_lineCommand']['uniformMap']={'uDiffuseColor':function(){return _0xce6483['_hintLineColor'];},'clip_mode':function(){return 0x0;},'clip_planes':function(){return _0x3a5fbb;},'clip_line_color':function(){return _0xc7ea4e['UNIT_W'];}},_0xce6483['_stencilCommand']=new _0x1c77d9({'primitiveType':_0x4f4674['TRIANGLES'],'modelMatrix':_0xce6483['_invertViewMatrix'],'boundingVolume':_0xce6483['_boundingSphere'],'pass':_0xba25cc['OPAQUE'],'owner':_0xce6483,'cull':!![]}),_0xce6483['_stencilCommand']['vertexArray']=new _0x58f09e({'context':_0x2f2184,'attributes':_0x447b0e,'indexBuffer':_0x429dd6}),_0xce6483['_stencilCommand']['shaderProgram']=_0x5ade83['fromCache']({'context':_0x2f2184,'vertexShaderSource':_0x32a03d,'fragmentShaderSource':_0x5be12d,'attributeLocations':_0x58b4e0});let _0x25cda={'enabled':!![],'frontFunction':_0x314a5f['ALWAYS'],'frontOperation':{'fail':_0x49f4cf['KEEP'],'zFail':_0x49f4cf['KEEP'],'zPass':_0x49f4cf['INCREMENT_WRAP']},'backFunction':_0x314a5f['ALWAYS'],'backOperation':{'fail':_0x49f4cf['KEEP'],'zFail':_0x49f4cf['KEEP'],'zPass':_0x49f4cf['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0};_0xce6483['_stencilCommand']['renderState']=_0x2c78a8['fromCache']({'depthMask':![],'colorMask':{'red':![],'green':![],'blue':![],'alpha':![]},'depthTest':{'enabled':!![],'func':_0xf51908['GREATER']},'stencilTest':_0x25cda,'stencilMask':0x1}),_0xce6483['_stencilCommand']['uniformMap']={'uColor':function(){return _0x353564['WHITE'];}},_0xce6483['_colorCommand']=new _0x1c77d9({'primitiveType':_0x4f4674['TRIANGLES'],'modelMatrix':_0xce6483['_invertViewMatrix'],'boundingVolume':_0xce6483['_boundingSphere'],'pass':_0xba25cc['OPAQUE'],'owner':_0xce6483,'cull':!![]}),_0xce6483['_colorCommand']['vertexArray']=new _0x58f09e({'context':_0x2f2184,'attributes':_0x447b0e,'indexBuffer':_0x429dd6});const _0x1fcaaf=new _0x1bb0d5({'name':'ViewShedAnalysisVS','sources':[_0x3bfc37]});_0xce6483['_colorCommand']['shaderProgram']=_0x5ade83['fromCache']({'context':_0x2f2184,'vertexShaderSource':_0x1fcaaf,'fragmentShaderSource':_0x1733c1,'attributeLocations':_0x58b4e0}),_0x25cda={'enabled':!![],'frontFunction':_0x314a5f['NOT_EQUAL'],'frontOperation':{'fail':_0x49f4cf['KEEP'],'zFail':_0x49f4cf['KEEP'],'zPass':_0x49f4cf['DECREMENT_WRAP']},'backFunction':_0x314a5f['NOT_EQUAL'],'backOperation':{'fail':_0x49f4cf['KEEP'],'zFail':_0x49f4cf['KEEP'],'zPass':_0x49f4cf['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0},_0xce6483['_colorCommand']['renderState']=_0x2c78a8['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':![]},'depthMask':![],'stencilTest':_0x25cda,'blending':_0x208b49['ALPHA_BLEND']}),_0xce6483['_colorCommand']['uniformMap']={'uRenderTextureMatrix':function(){return _0xce6483['_renderTextureMatrix'];},'uTexture1_size':function(){const _0x1d8ec3=_0xce6483['_cameraDepthBuffer']['depthTexture'],_0x52dc7d=new _0x22b9ac(_0x1d8ec3['width'],_0x1d8ec3['height']);return _0x52dc7d;},'uTexture1':function(){return _0xce6483['_cameraDepthBuffer']['depthTexture'];},'uDiffuseTexture':function(){return _0xce6483['_texture'];},'uBrightness':function(){return _0xce6483['_brightness'];},'uContrast':function(){return _0xce6483['_contrast'];},'uHue':function(){return _0xce6483['_hue'];},'uSaturation':function(){return _0xce6483['_saturation'];},'uOneOverGamma':function(){return 0x1/_0xce6483['_gamma'];},'uFeatheringScale':function(){return _0xce6483['_featheringScale'];},'uV3AffineX':function(){return _0xce6483['_v3AffineX'];},'uV3AffineY':function(){return _0xce6483['_v3AffineY'];}};}function _0x129c80(_0x405133,_0x5aa1e7,_0x58f354){if(_0x127463['distance'](_0x405133['positionWC'],_0x5aa1e7['center'])>_0x58f354)return!![];const _0x4c637c=_0x405133['frustum']['computeCullingVolume'](_0x405133['positionWC'],_0x405133['directionWC'],_0x405133['upWC']),_0x2bfe69=_0x4c637c['computeVisibility'](_0x5aa1e7);return _0x2bfe69===_0x1864d9['OUTSIDE'];}_0x556621['prototype']['update']=function(_0x45d001){const _0x459560=_0x45d001['context'],_0x5658f5=_0x45d001['commandList'],_0x377867=_0x45d001['camera'];if(_0x45d001['fbo']||!this['_visible']||_0x377867['bReflect'])return;if(_0x2f29d8(this['_boundingSphereFromXML'])){if(_0x129c80(_0x377867,this['_boundingSphereFromXML'],this['_visibleDistanceMax']))return;}if(this['_boundingSphere']['radius']!==0x0&&!this['_update']){if(_0x129c80(_0x377867,this['_boundingSphere'],this['_visibleDistanceMax']))return;}_0x510c39['multiply'](this['_viewProjMatrix'],_0x377867['inverseViewMatrix'],this['_renderTextureMatrix']);_0x2f29d8(this['_video'])&&(this['_video']['readyState']>=0x2&&(!_0x2f29d8(this['_texture'])?this['_texture']=new _0x55839c({'context':_0x459560,'source':this['_video']}):this['_texture']['copyFrom'](this['_video'])));if(!_0x2f29d8(this['_texture']))return;const _0x3eee19=this['scene'];this['_update']&&(!_0x2f29d8(this['_cameraDepthBuffer'])&&(this['_cameraDepthBuffer']=new _0x55f3a4(_0x459560)),this['_update']=![],_0x19152e(this),_0x2d0063(this,_0x459560,_0x45d001),_0x10784e(this,_0x459560,_0x45d001));if(_0x2f29d8(this['_cameraDepthBuffer']['depthTexture'])){_0x2f29d8(this['_stencilCommand'])&&_0x5658f5['push'](this['_stencilCommand']);_0x2f29d8(this['_colorCommand'])&&_0x5658f5['push'](this['_colorCommand']);if(_0x2f29d8(this['_lineCommand'])&&this['_hintLineVisible']){}}},_0x556621['prototype']['setImage']=function(_0x57fd88){if(!_0x2f29d8(_0x57fd88))throw new _0x7c7da5('options\x20is\x20required.');if(!_0x2f29d8(_0x57fd88['url'])&&!_0x2f29d8(_0x57fd88['video'])&&!_0x2f29d8(_0x57fd88['image']))throw new _0x7c7da5('options.url\x20or\x20options.video\x20or\x20options.image\x20are\x20required.');if(_0x2f29d8(_0x57fd88['url'])){const _0x4078ee=_0x1404ec['createIfNeeded'](_0x57fd88['url']),_0x21b98a=this;_0x4078ee['fetchImage']()['then'](_0x50bfeb=>{_0x2f29d8(_0x21b98a['_texture'])&&_0x21b98a['_texture']['destroy'](),_0x21b98a['_texture']=new _0x55839c({'context':_0x21b98a['scene']['_context'],'source':_0x50bfeb});});}else _0x2f29d8(_0x57fd88['image'])?!_0x2f29d8(this['_texture'])?this['_texture']=new _0x55839c({'context':this['scene']['_context'],'source':_0x57fd88['image']}):this['_texture']['copyFrom'](_0x57fd88['image']):this['_video']=_0x57fd88['video'];},_0x556621['prototype']['setDistDirByPoint']=function(_0x1faa38){if(_0x1faa38[0x0]===this['_viewPosition'][0x0]&&_0x1faa38[0x1]===this['_viewPosition'][0x1]&&_0x1faa38[0x2]===this['_viewPosition'][0x2])throw new _0x7c7da5('the\x20position\x20is\x20[longitude,\x20latitude\x20,height]\x20and\x20is\x20not\x20equals\x20viewPosition');const _0x5b3956=this['scene']['camera'],_0x32de0f=_0x5b3956['_projection'];let _0x55bec4,_0x4fb780;if(this['scene']['mode']===_0x25f7eb['SCENE3D'])_0x55bec4=_0x127463['fromDegreesArrayHeights'](_0x1faa38)[0x0],_0x4fb780=_0x127463['fromDegreesArrayHeights'](this['_viewPosition'])[0x0];else{const _0x2bc794=_0x267725['fromDegrees'](_0x1faa38[0x0],_0x1faa38[0x1],_0x1faa38[0x2]);_0x55bec4=_0x32de0f['project'](_0x2bc794,new _0x127463());const _0x2c8def=_0x267725['fromDegrees'](this['_viewPosition'][0x0],this['_viewPosition'][0x1],this['_viewPosition'][0x2]);_0x4fb780=_0x32de0f['project'](_0x2c8def,new _0x127463());}const _0x4cf903=new _0x127463();_0x127463['subtract'](_0x55bec4,_0x4fb780,_0x4cf903);const _0xa58b6e=_0x127463['magnitude'](_0x4cf903);_0x127463['normalize'](_0x4cf903,_0x4cf903),this['distance']=_0xa58b6e;const _0x57c24b=_0x5b3956['heading'],_0x46bb3c=_0x5b3956['pitch'],_0x4e9815=_0x5b3956['roll'],_0x50c105=new _0x127463();_0x127463['clone'](_0x5b3956['position'],_0x50c105);const _0x3dca8e=_0x4cf903['clone']();let _0x30e5ee=_0x4fb780['clone']();_0x30e5ee=_0x127463['normalize'](_0x30e5ee,_0x30e5ee);Math['abs'](_0x127463['dot'](_0x30e5ee,_0x3dca8e))>=0x1&&(Math['abs'](_0x127463['dot'](_0x3dca8e,_0x127463['UNIT_Y']))<0x1?_0x30e5ee=_0x127463['clone'](_0x127463['UNIT_Y'],_0x30e5ee):_0x30e5ee=_0x127463['clone'](_0x127463['UNIT_Z'],_0x30e5ee));let _0x37ad98=new _0x127463();_0x127463['cross'](_0x30e5ee,_0x3dca8e,_0x37ad98),_0x37ad98=_0x127463['normalize'](_0x37ad98,_0x37ad98),_0x127463['cross'](_0x3dca8e,_0x37ad98,_0x30e5ee),_0x30e5ee=_0x127463['normalize'](_0x30e5ee,_0x30e5ee),_0x5b3956['setView']({'destination':_0x4fb780,'orientation':{'direction':_0x3dca8e,'up':_0x30e5ee},'convert':![]}),this['direction']=_0x5b3956['heading']*_0x135c04['DEGREES_PER_RADIAN'],this['pitch']=_0x5b3956['pitch']*_0x135c04['DEGREES_PER_RADIAN'],_0x5b3956['setView']({'destination':_0x50c105,'orientation':{'heading':_0x57c24b,'pitch':_0x46bb3c,'roll':_0x4e9815},'convert':![]});},_0x556621['prototype']['setInfo']=function(_0x8af2f4){if(!_0x2f29d8(_0x8af2f4))throw new _0x7c7da5('No\x20url\x20provided.');const _0x4ba072=this,_0x18fc53=_0x1404ec['createIfNeeded'](_0x8af2f4);return _0x18fc53['fetchXML']()['then'](function(_0x21701a){const _0x1318e9=_0x21701a['firstChild'],_0xa9fb8f=_0x37c05f(_0x1318e9);_0x4ba072['direction']=_0xa9fb8f['heading'],_0x4ba072['pitch']=_0xb20698(_0xa9fb8f['pitch'],_0x4ba072['pitch']),_0x4ba072['_roll']=_0xb20698(_0xa9fb8f['roll'],_0x4ba072['_roll']),_0x4ba072['horizontalFov']=_0xa9fb8f['horizontalFov'],_0x4ba072['verticalFov']=_0xa9fb8f['verticalFov'],_0x127463['clone'](_0xa9fb8f['matrixU'],_0x4ba072['_v3AffineX']),_0x127463['clone'](_0xa9fb8f['matrixV'],_0x4ba072['_v3AffineY']),_0x4ba072['distance']=_0xa9fb8f['distance'],_0x4ba072['viewPosition']=_0xa9fb8f['viewPosition'],_0x4ba072['_boundingSphereFromXML']=_0xa9fb8f['boundingSphere'];},_0x4eb229=>{console['error'](_0x4eb229);});};function _0x37c05f(_0x52e789){const _0x18ca9a=_0x554dc1['queryStringValue'](_0x52e789,'VideoName'),_0x1bb793=_0x554dc1['queryFirstNode'](_0x52e789,'Fov'),_0x3ec38a=_0x554dc1['queryNumericValue'](_0x1bb793,'Horizontal'),_0x4d6504=_0x554dc1['queryNumericValue'](_0x1bb793,'Vertical'),_0x3198c5=_0x554dc1['queryNumericValue'](_0x52e789,'Distance'),_0x551be0=_0x554dc1['queryNumericValue'](_0x52e789,'Heading'),_0x370506=_0x554dc1['queryNumericValue'](_0x52e789,'Pitch'),_0x356128=_0x554dc1['queryNumericValue'](_0x52e789,'Roll'),_0x2cb540=_0x554dc1['queryFirstNode'](_0x52e789,'ViewPosition'),_0x5b59b4=[0x0,0x0,0x0];_0x5b59b4[0x0]=_0x554dc1['queryNumericValue'](_0x2cb540,'X'),_0x5b59b4[0x1]=_0x554dc1['queryNumericValue'](_0x2cb540,'Y'),_0x5b59b4[0x2]=_0x554dc1['queryNumericValue'](_0x2cb540,'Z');const _0x7f66e2=_0x554dc1['queryFirstNode'](_0x52e789,'Matrix'),_0x1dd6ce=_0x554dc1['queryStringValue'](_0x7f66e2,'U'),_0x5b56a8=_0x554dc1['queryStringValue'](_0x7f66e2,'V'),_0x35ffeb=_0x554dc1['queryStringValue'](_0x7f66e2,'W'),_0x42ae8f=_0x1dd6ce['split'](','),_0x28e8dd=new _0x127463(parseFloat(_0x42ae8f[0x0]),parseFloat(_0x42ae8f[0x1]),parseFloat(_0x42ae8f[0x2])),_0x546a5f=_0x5b56a8['split'](','),_0x245999=new _0x127463(parseFloat(_0x546a5f[0x0]),parseFloat(_0x546a5f[0x1]),parseFloat(_0x546a5f[0x2])),_0x3355fb=_0x554dc1['queryFirstNode'](_0x52e789,'Bounds');let _0x569bad;if(_0x3355fb){const _0x50cbf8=_0x135c04['toRadians'](_0x554dc1['queryNumericValue'](_0x3355fb,'Left')),_0x34b09b=_0x135c04['toRadians'](_0x554dc1['queryNumericValue'](_0x3355fb,'Top')),_0x3deebf=_0x135c04['toRadians'](_0x554dc1['queryNumericValue'](_0x3355fb,'Right')),_0x3c08f8=_0x135c04['toRadians'](_0x554dc1['queryNumericValue'](_0x3355fb,'Bottom')),_0x447df3=new _0x141efd(_0x50cbf8,_0x3c08f8,_0x3deebf,_0x34b09b);let _0x9329f0=_0x3198c5*Math['cos'](_0x135c04['toRadians'](_0x370506));_0x9329f0=_0x370506<0x0?-_0x9329f0:_0x9329f0;const _0x2d9716=_0x5b59b4[0x2]+_0x9329f0;_0x569bad=_0x2a4f3d['fromRectangle3D'](_0x447df3,undefined,_0x2d9716);}return{'videoName':_0x18ca9a,'viewPosition':_0x5b59b4,'heading':_0x551be0,'pitch':_0x370506,'roll':_0x356128,'horizontalFov':_0x3ec38a,'verticalFov':_0x4d6504,'matrixU':_0x28e8dd,'matrixV':_0x245999,'distance':_0x3198c5,'boundingSphere':_0x569bad};}function _0x1a7100(_0x16502e,_0x4e7ff5){let _0x453d36=document['getElementById']('projection-image');!_0x2f29d8(_0x453d36)&&(_0x453d36=document['createElement']('div'),_0x453d36['setAttribute']('id','projection-image'),document['body']['appendChild'](_0x453d36));const _0x337b50=document['createElement']('video');return _0x337b50['style']='visibility:hidden;position:absolute;top:0px;left:0px;',_0x337b50['setAttribute']('width','320'),_0x337b50['setAttribute']('height','240'),_0x337b50['setAttribute']('autoplay','autoplay'),_0x337b50['setAttribute']('loop','loop'),_0x337b50['setAttribute']('crossorigin','crossorigin'),_0x337b50['setAttribute']('src',_0x16502e),_0x337b50['setAttribute']('id','projection-image-'+_0x4e7ff5),_0x453d36['appendChild'](_0x337b50),_0x337b50;}_0x556621['fromInfo']=function(_0x5d05ef,_0x248453,_0x407582){if(!_0x2f29d8(_0x5d05ef))throw new _0x7c7da5('No\x20scene\x20provided.');if(!_0x2f29d8(_0x248453))throw new _0x7c7da5('No\x20url\x20provided.');const _0xd68b05=_0x1404ec['createIfNeeded'](_0x248453);return _0xd68b05['fetchXML']()['then'](function(_0x3001bb){const _0x20a1cb={},_0x2f3cf6=_0x3001bb['firstChild'];for(let _0x2edf02=0x0,_0x179fd5=_0x2f3cf6['children']['length'];_0x2edf02<_0x179fd5;_0x2edf02++){const _0x281937=_0x2f3cf6['children'][_0x2edf02],_0x10d52c=_0x37c05f(_0x281937);let _0x1c2ff5=_0x10d52c['videoName'];_0x2f29d8(_0x407582)?_0x1c2ff5=_0x1bd265(_0x407582)+_0x10d52c['videoName']:_0x1c2ff5=_0x248453['slice'](0x0,_0x248453['lastIndexOf']('/')+0x1)+_0x10d52c['videoName'];const _0xc4d914=new _0x556621(_0x5d05ef),_0x431ff9=_0x1a7100(_0x1c2ff5,_0xc4d914['_guid']);_0xc4d914['viewPosition']=_0x10d52c['viewPosition'],_0xc4d914['direction']=_0x10d52c['heading'],_0xc4d914['pitch']=_0x10d52c['pitch'],_0xc4d914['horizontalFov']=_0x10d52c['horizontalFov'],_0xc4d914['verticalFov']=_0x10d52c['verticalFov'],_0x127463['clone'](_0x10d52c['matrixU'],_0xc4d914['_v3AffineX']),_0x127463['clone'](_0x10d52c['matrixV'],_0xc4d914['_v3AffineY']),_0xc4d914['distance']=_0x10d52c['distance'],_0xc4d914['setImage']({'video':_0x431ff9}),_0xc4d914['_boundingSphere']=XML=_0x10d52c['boundingSphere'],_0x431ff9['addEventListener']('loadeddata',function(_0x2abcde){_0x2abcde['build']();}['bind'](_0x431ff9,_0xc4d914)),_0x20a1cb[_0x10d52c['videoName']]=_0xc4d914;}return _0x20a1cb;},_0x3bc21e=>{console['error'](_0x3bc21e);});},_0x556621['prototype']['build']=function(){if(this['isBuild'])return;this['isBuild']=!![],this['scene']['primitives']['add'](this),this['removeListenerFunc']=this['scene']['preUpdate']['addEventListener'](_0x5be142=>{_0x2f29d8(this['_cameraDepthBuffer'])&&this['_cameraDepthBuffer']['renderToTexture'](_0x5be142);},this);},_0x556621['prototype']['clear']=function(){if(!this['isBuild'])return;this['isBuild']=![],this['removeListenerFunc'](),this['scene']['primitives']['remove'](this);},_0x556621['prototype']['destroy']=function(){const _0x44b287=document['getElementById']('projection-image-'+this['_guid']);if(_0x44b287){const _0x4222f8=_0x44b287['parentNode'];_0x4222f8['removeChild'](_0x44b287),_0x4222f8['children']['length']===0x0&&_0x4222f8['parentNode']['removeChild'](_0x4222f8);}return this['_cameraDepthBuffer']=this['_cameraDepthBuffer']&&this['_cameraDepthBuffer']['destroy'](),_0x19152e(this),this['_texture']=this['_texture']&&!this['_texture']['isDestroyed']()&&this['_texture']['destroy'](),this['scene']['primitives']['remove'](this),_0x3ce731(this);};export default _0x556621;