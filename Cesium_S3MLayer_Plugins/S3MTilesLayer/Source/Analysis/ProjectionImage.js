const _0x86aba=(function(){let _0x5a81f2=!![];return function(_0x19442c,_0x5120f2){const _0xce1e00=_0x5a81f2?function(){if(_0x5120f2){const _0x260229=_0x5120f2['apply'](_0x19442c,arguments);return _0x5120f2=null,_0x260229;}}:function(){};return _0x5a81f2=![],_0xce1e00;};}()),_0x475dae=_0x86aba(this,function(){return _0x475dae['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x475dae)['search']('(((.+)+)+)+$');});_0x475dae();import _0x20c959 from'./DepthFramebuffer.js';import _0x8beffc from'./Shaders/NoLightNoTextureVS.js';import _0x3b51d7 from'./Shaders/NoLightNoTextureFS.js';import _0x1f5015 from'./Shaders/ViewShedAnalysisVS.js';import _0x4cf87b from'./Shaders/ProjectionImageFS.js';import _0x487a01 from'./XMLParser.js';const _0x21228b=Cesium['BoundingSphere'],_0x4b066a=Cesium['Cartesian2'],_0x54b82c=Cesium['Cartesian3'],_0x1b0acf=Cesium['Cartesian4'],_0x2e796e=Cesium['Color'],_0x10f64c=Cesium['ComponentDatatype'],_0x176f59=Cesium['defined'],_0x221890=Cesium['defaultValue'],_0x195288=Cesium['destroyObject'],_0x4b6721=Cesium['DeveloperError'],_0x4bc455=Cesium['IndexDatatype'],_0x28513b=Cesium['Math'],_0x2deb1e=Cesium['Matrix4'],_0x131780=Cesium['PrimitiveType'],_0x3fb68a=Cesium['Check'],_0x53922d=Cesium['appendForwardSlash'],_0x309115=Cesium['Rectangle'],_0x895ef0=Cesium['Intersect'],_0xec7c7d=Cesium['Cartographic'],_0x57ab81=Cesium['Pass'],_0x1aeb34=Cesium['Buffer'],_0x44adcb=Cesium['BufferUsage'],_0x97144d=Cesium['DrawCommand'],_0x181c33=Cesium['RenderState'],_0x432d89=Cesium['Texture'],_0x6112ff=Cesium['ShaderProgram'],_0x378304=Cesium['VertexArray'],_0x2dd57b=Cesium['ShaderSource'],_0x1b358a=Cesium['BlendingState'],_0x4818e2=Cesium['SceneMode'],_0x36815b=Cesium['StencilOperation'],_0x374e82=Cesium['StencilFunction'],_0x583da4=Cesium['DepthFunction'],_0x597cc4=Cesium['Resource'];function _0x26c657(_0x528193){if(!_0x176f59(_0x528193))throw new _0x4b6721('scene\x20are\x20required.');if(!_0x528193['context']['depthTexture'])throw new _0x4b6721('the\x20depth\x20buffer\x20is\x20not\x20supported.');this['scene']=_0x528193,this['_cameraDepthBuffer']=undefined,this['_lineCommand']=undefined,this['_stencilCommand']=undefined,this['_colorCommand']=undefined,this['_boundingSphere']=new _0x21228b(),this['_viewPosition']=[0x0,0x0,0x0],this['_direction']=0x0,this['_pitch']=0x0,this['_roll']=0x0,this['_horizontalFov']=0x5a,this['_verticalFov']=0x3c,this['_distance']=0xc8,this['_hintLineColor']=new _0x2e796e(0x1,0x1,0x1,0x1),this['_hintLineVisible']=!![],this['_texture']=undefined,this['_segmentCount']=0x14,this['_invertViewMatrix']=new _0x2deb1e(),this['_viewProjMatrix']=new _0x2deb1e(),this['_renderTextureMatrix']=new _0x2deb1e(),this['_update']=!![],this['_video']=undefined,this['_brightness']=0x1,this['_contrast']=0x1,this['_hue']=0x0,this['_saturation']=0x1,this['_gamma']=0x1,this['_featheringScale']=0x0,this['_v3AffineX']=new _0x54b82c(0x1,0x0,0x0),this['_v3AffineY']=new _0x54b82c(0x0,0x1,0x0),this['_visible']=!![],this['_visibleDistanceMax']=0x1f4,this['isBuild']=![];}Object['defineProperties'](_0x26c657['prototype'],{'viewPosition':{'get':function(){return this['_viewPosition'];},'set':function(_0x410f5f){this['_viewPosition']=_0x410f5f,this['_update']=!![];}},'direction':{'get':function(){return this['_direction'];},'set':function(_0x315b59){this['_direction']=_0x315b59,this['_update']=!![];}},'pitch':{'get':function(){return this['_pitch'];},'set':function(_0x30c431){this['_pitch']=_0x30c431,this['_update']=!![];}},'roll':{'get':function(){return this['_roll'];},'set':function(_0x2c2902){this['_roll']=_0x2c2902,this['_update']=!![];}},'horizontalFov':{'get':function(){return this['_horizontalFov'];},'set':function(_0x5494f7){this['_horizontalFov']=_0x5494f7,this['_update']=!![];}},'verticalFov':{'get':function(){return this['_verticalFov'];},'set':function(_0x3a3088){this['_verticalFov']=_0x3a3088,this['_update']=!![];}},'distance':{'get':function(){return this['_distance'];},'set':function(_0x3f2f4f){if(_0x3f2f4f<=0x0)throw new _0x4b6721('the\x20distance\x20is\x20greater\x20than\x200.0');this['_distance']=_0x3f2f4f,this['_update']=!![];}},'featheringScale':{'get':function(){return this['_featheringScale'];},'set':function(_0x7e22a3){if(_0x7e22a3<0x0||_0x7e22a3>0x1)throw new _0x4b6721('the\x20distance\x20is\x20greater\x20than\x200.0\x20an\x20less\x20than\x201.0');this['_featheringScale']=_0x7e22a3;}},'hintLineColor':{'get':function(){return this['_hintLineColor'];},'set':function(_0x116569){if(!_0x176f59(_0x116569))return;this['_hintLineColor']=_0x2e796e['clone'](_0x116569,this['_hintLineColor']);}},'hintLineVisible':{'get':function(){return this['_hintLineVisible'];},'set':function(_0x1e6248){this['_hintLineVisible']=_0x1e6248;}},'brightness':{'get':function(){return this['_brightness'];},'set':function(_0x2337e4){_0x3fb68a['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.brightness',_0x2337e4,0x0),this['_brightness']=_0x2337e4;}},'contrast':{'get':function(){return this['_contrast'];},'set':function(_0x324fd7){_0x3fb68a['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.contrast',_0x324fd7,0x0),this['_contrast']=_0x324fd7;}},'hue':{'get':function(){return this['_hue'];},'set':function(_0x5ccbca){_0x3fb68a['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.hue',_0x5ccbca,0x0),this['_hue']=_0x5ccbca;}},'saturation':{'get':function(){return this['_saturation'];},'set':function(_0x5ac2ac){_0x3fb68a['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.saturation',_0x5ac2ac,0x0),this['_saturation']=_0x5ac2ac;}},'gamma':{'get':function(){return this['_gamma'];},'set':function(_0x1f6da6){_0x3fb68a['typeOf']['number']['greaterThan']('ProjectionImage.gamma',_0x1f6da6,0x0),this['_gamma']=_0x1f6da6;}},'visible':{'get':function(){return this['_visible'];},'set':function(_0x3ffa1d){_0x3fb68a['typeOf']['bool']('ProjectionImage.visible',_0x3ffa1d),this['_visible']=_0x3ffa1d;}},'visibleDistanceMax':{'get':function(){return this['_visibleDistanceMax'];},'set':function(_0x4e3ace){_0x3fb68a['typeOf']['number']('ProjectionImage.visibleDistance',_0x4e3ace),this['_visibleDistanceMax']=_0x4e3ace;}}});function _0x47bd24(_0x2b5aa2){_0x176f59(_0x2b5aa2['_stencilCommand'])&&(_0x2b5aa2['_stencilCommand']['vertexArray']=_0x2b5aa2['_stencilCommand']['vertexArray']&&_0x2b5aa2['_stencilCommand']['vertexArray']['destroy'](),_0x2b5aa2['_stencilCommand']['shaderProgram']=_0x2b5aa2['_stencilCommand']['shaderProgram']&&_0x2b5aa2['_stencilCommand']['shaderProgram']['destroy'](),_0x2b5aa2['_stencilCommand']=undefined),_0x176f59(_0x2b5aa2['_colorCommand'])&&(_0x2b5aa2['_colorCommand']['vertexArray']=_0x2b5aa2['_colorCommand']['vertexArray']&&_0x2b5aa2['_colorCommand']['vertexArray']['destroy'](),_0x2b5aa2['_colorCommand']['shaderProgram']=_0x2b5aa2['_colorCommand']['shaderProgram']&&_0x2b5aa2['_colorCommand']['shaderProgram']['destroy'](),_0x2b5aa2['_colorCommand']=undefined),_0x176f59(_0x2b5aa2['_lineCommand'])&&(_0x2b5aa2['_lineCommand']['vertexArray']=_0x2b5aa2['_lineCommand']['vertexArray']&&_0x2b5aa2['_lineCommand']['vertexArray']['destroy'](),_0x2b5aa2['_lineCommand']['shaderProgram']=_0x2b5aa2['_lineCommand']['shaderProgram']&&_0x2b5aa2['_lineCommand']['shaderProgram']['destroy'](),_0x2b5aa2['_lineCommand']=undefined);}function _0x4c9eee(_0x5d2433,_0x3b0835,_0x30cba2){const _0x3087c4=_0x5d2433['_horizontalFov']*_0x28513b['RADIANS_PER_DEGREE'],_0x3e8f80=_0x5d2433['_verticalFov']*_0x28513b['RADIANS_PER_DEGREE'],_0x34c392=Math['tan'](_0x3087c4*0.5),_0x15ee5e=Math['tan'](_0x3e8f80*0.5),_0x406f3e=_0x34c392/_0x15ee5e,_0x43b2fc=_0x5d2433['_distance']*0.001,_0xfb89ca=Math['max'](_0x5d2433['_distance'],0xa),_0x8edded=_0x5d2433['_direction']*_0x28513b['RADIANS_PER_DEGREE'],_0x1dd35e=_0x5d2433['_pitch']*_0x28513b['RADIANS_PER_DEGREE'],_0x5b4d8a=_0x5d2433['_roll']*_0x28513b['RADIANS_PER_DEGREE'],_0xdfed85=_0x54b82c['fromDegreesArrayHeights'](_0x5d2433['_viewPosition'])[0x0],_0x36c5d9=_0x30cba2['camera'],_0x38a699=_0x36c5d9['frustum']['aspectRatio'],_0x15dcaa=_0x36c5d9['frustum']['fov'],_0xc2bf88=_0x36c5d9['frustum']['near'],_0x3091b8=_0x36c5d9['frustum']['far'],_0x506be1=new _0x54b82c(),_0x29bf78=_0x36c5d9['heading'],_0x21f517=_0x36c5d9['pitch'],_0x3b0a4c=_0x36c5d9['roll'];_0x54b82c['clone'](_0x36c5d9['position'],_0x506be1),_0x5d2433['_cameraDepthBuffer']['isUpdate']=!![];const _0x536031=_0x30cba2['useLogDepth'];_0x5d2433['_cameraDepthBuffer']['beginFunc']=function(){_0x30cba2['useLogDepth']=![],_0x54b82c['clone'](_0x36c5d9['position'],_0x506be1),_0x36c5d9['frustum']['aspectRatio']=_0x406f3e,_0x36c5d9['frustum']['fov']=_0x406f3e>=0x1?_0x3087c4:_0x3e8f80,_0x36c5d9['frustum']['near']=0x1,_0x36c5d9['frustum']['far']=_0xfb89ca,_0x536031&&(_0x36c5d9['frustum']['near']=0.1,_0x36c5d9['frustum']['far']=0x5f5e100),_0x36c5d9['setView']({'destination':_0xdfed85,'orientation':{'heading':_0x8edded,'pitch':_0x1dd35e,'roll':_0x5b4d8a}}),_0x2deb1e['multiply'](_0x36c5d9['frustum']['projectionMatrix'],_0x36c5d9['viewMatrix'],_0x5d2433['_viewProjMatrix']),_0x2deb1e['clone'](_0x36c5d9['inverseViewMatrix'],_0x5d2433['_invertViewMatrix']),_0x54b82c['clone'](_0x54b82c['ZERO'],_0x5d2433['_boundingSphere']['center']),_0x5d2433['_boundingSphere']['radius']=_0x5d2433['_distance'],_0x21228b['transform'](_0x5d2433['_boundingSphere'],_0x5d2433['_invertViewMatrix'],_0x5d2433['_boundingSphere']);},_0x5d2433['_cameraDepthBuffer']['endFunc']=function(){_0x36c5d9['setView']({'destination':_0x506be1,'orientation':{'heading':_0x29bf78,'pitch':_0x21f517,'roll':_0x3b0a4c},'convert':![]}),_0x36c5d9['frustum']['aspectRatio']=_0x38a699,_0x36c5d9['frustum']['fov']=_0x15dcaa,_0x36c5d9['frustum']['near']=_0xc2bf88,_0x36c5d9['frustum']['far']=_0x3091b8,_0x30cba2['useLogDepth']=_0x536031,_0x5d2433['_cameraDepthBuffer']['isUpdate']=![];};}function _0x56d502(_0x11beb8,_0x40cc83,_0x3e34a0){const _0x50bc84=(_0x11beb8['_segmentCount']+0x1)*(_0x11beb8['_segmentCount']+0x1)+0x1,_0x1c5fc9=_0x10f64c['createTypedArray'](_0x10f64c['FLOAT'],_0x50bc84*0x3);let _0xbb17fb=0x3;const _0x3675f5=_0x11beb8['_horizontalFov']*_0x28513b['RADIANS_PER_DEGREE'],_0x1b80aa=_0x11beb8['_verticalFov']*_0x28513b['RADIANS_PER_DEGREE'],_0x133b4b=Math['tan'](_0x3675f5*0.5),_0x57aa7b=Math['tan'](_0x1b80aa*0.5),_0x41d0ce=_0x11beb8['_distance']*_0x133b4b,_0x1bacfc=_0x11beb8['_distance']*_0x57aa7b,_0x5d6241=Math['PI']-_0x3675f5*0.5;let _0x3630f0=0x0,_0x2cf222=0x0,_0xfec823=_0x3675f5/_0x11beb8['_segmentCount'];for(let _0x176555=0x0;_0x176555<_0x11beb8['_segmentCount']+0x1;_0x176555++){_0x3630f0=_0x5d6241+_0x176555*_0xfec823;const _0x558b4e=_0x1bacfc/(_0x11beb8['_distance']/Math['cos'](_0x3630f0)),_0x4bff7f=Math['atan'](_0x558b4e),_0x5048c2=-_0x4bff7f,_0x5d9d78=_0x4bff7f*0x2/_0x11beb8['_segmentCount'];for(let _0x118fff=0x0;_0x118fff<_0x11beb8['_segmentCount']+0x1;_0x118fff++){_0x2cf222=_0x5048c2+_0x118fff*_0x5d9d78,_0x1c5fc9[_0xbb17fb++]=_0x11beb8['_distance']*Math['cos'](_0x2cf222)*Math['sin'](_0x3630f0),_0x1c5fc9[_0xbb17fb++]=_0x11beb8['_distance']*Math['sin'](_0x2cf222),_0x1c5fc9[_0xbb17fb++]=_0x11beb8['_distance']*Math['cos'](_0x2cf222)*Math['cos'](_0x3630f0);}}const _0x32ed2b=(0x4+_0x11beb8['_segmentCount']*0x5+_0x11beb8['_segmentCount']*0x2*0x3)*0x2,_0x110aea=_0x11beb8['_segmentCount']*_0x11beb8['_segmentCount']*0x3*0x2+_0x11beb8['_segmentCount']*0x3*0x4,_0x1c0624=_0x10f64c['createTypedArray'](_0x10f64c['UNSIGNED_SHORT'],_0x32ed2b),_0x238d4f=_0x10f64c['createTypedArray'](_0x10f64c['UNSIGNED_SHORT'],_0x110aea);let _0x32c372=0x0;const _0x23997c=0x1;for(let _0x4dcefc=0x0;_0x4dcefc<_0x11beb8['_segmentCount'];_0x4dcefc++){for(let _0x5d597d=0x0;_0x5d597d<_0x11beb8['_segmentCount'];_0x5d597d++){_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+_0x5d597d*(_0x11beb8['_segmentCount']+0x1),_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+0x1+_0x5d597d*(_0x11beb8['_segmentCount']+0x1),_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+(_0x5d597d+0x1)*(_0x11beb8['_segmentCount']+0x1),_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+0x1+_0x5d597d*(_0x11beb8['_segmentCount']+0x1),_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+0x1+(_0x5d597d+0x1)*(_0x11beb8['_segmentCount']+0x1),_0x238d4f[_0x32c372++]=_0x23997c+_0x4dcefc+(_0x5d597d+0x1)*(_0x11beb8['_segmentCount']+0x1);}}for(let _0x136e0a=0x0;_0x136e0a<_0x11beb8['_segmentCount'];_0x136e0a++){_0x238d4f[_0x32c372++]=_0x136e0a+0x1+_0x23997c,_0x238d4f[_0x32c372++]=_0x136e0a+_0x23997c,_0x238d4f[_0x32c372++]=0x0,_0x238d4f[_0x32c372++]=0x0,_0x238d4f[_0x32c372++]=_0x136e0a+_0x11beb8['_segmentCount']*(_0x11beb8['_segmentCount']+0x1)+_0x23997c,_0x238d4f[_0x32c372++]=_0x136e0a+0x1+_0x11beb8['_segmentCount']*(_0x11beb8['_segmentCount']+0x1)+_0x23997c;}for(let _0x186b24=0x0;_0x186b24<_0x11beb8['_segmentCount'];_0x186b24++){_0x238d4f[_0x32c372++]=0x0,_0x238d4f[_0x32c372++]=_0x186b24*(_0x11beb8['_segmentCount']+0x1)+_0x23997c,_0x238d4f[_0x32c372++]=(_0x186b24+0x1)*(_0x11beb8['_segmentCount']+0x1)+_0x23997c,_0x238d4f[_0x32c372++]=_0x11beb8['_segmentCount']+(_0x186b24+0x1)*(_0x11beb8['_segmentCount']+0x1)+_0x23997c,_0x238d4f[_0x32c372++]=_0x11beb8['_segmentCount']+_0x186b24*(_0x11beb8['_segmentCount']+0x1)+_0x23997c,_0x238d4f[_0x32c372++]=0x0;}_0x32c372=0x0,_0x1c0624[_0x32c372++]=0x0,_0x1c0624[_0x32c372++]=0x1,_0x1c0624[_0x32c372++]=0x0,_0x1c0624[_0x32c372++]=_0x11beb8['_segmentCount']+0x1,_0x1c0624[_0x32c372++]=0x0,_0x1c0624[_0x32c372++]=_0x11beb8['_segmentCount']*(_0x11beb8['_segmentCount']+0x1)+0x1,_0x1c0624[_0x32c372++]=0x0,_0x1c0624[_0x32c372++]=(_0x11beb8['_segmentCount']+0x1)*(_0x11beb8['_segmentCount']+0x1);for(let _0x537368=0x0;_0x537368<0x5;_0x537368++){for(let _0x424c53=0x0;_0x424c53<_0x11beb8['_segmentCount'];_0x424c53++){_0x1c0624[_0x32c372++]=0x1+_0x424c53+(_0x11beb8['_segmentCount']+0x1)*0x5*_0x537368,_0x1c0624[_0x32c372++]=0x1+(_0x424c53+0x1)+(_0x11beb8['_segmentCount']+0x1)*0x5*_0x537368;}}for(let _0x2b92c3=0x0;_0x2b92c3<0x5;_0x2b92c3++){for(let _0x1c45ee=0x0;_0x1c45ee<_0x11beb8['_segmentCount'];_0x1c45ee++){_0x1c0624[_0x32c372++]=0x1+(_0x11beb8['_segmentCount']+0x1)*_0x1c45ee+_0x2b92c3*0x5,_0x1c0624[_0x32c372++]=0x1+(_0x11beb8['_segmentCount']+0x1)*(_0x1c45ee+0x1)+_0x2b92c3*0x5;}}const _0x3a2369=_0x1aeb34['createVertexBuffer']({'context':_0x40cc83,'typedArray':_0x1c5fc9,'usage':_0x44adcb['STATIC_DRAW']}),_0x49b922=[],_0x31a54c={};_0x31a54c['aPosition']=0x0,_0x49b922['push']({'index':_0x31a54c['aPosition'],'vertexBuffer':_0x3a2369,'componentsPerAttribute':0x3,'componentDatatype':_0x10f64c['FLOAT'],'offsetInBytes':0x0,'strideInBytes':0x3*0x4,'normalize':![]});const _0x110782=_0x1aeb34['createIndexBuffer']({'context':_0x40cc83,'typedArray':_0x1c0624,'usage':_0x44adcb['STATIC_DRAW'],'indexDatatype':_0x4bc455['UNSIGNED_SHORT']}),_0x1fb7fb=_0x1aeb34['createIndexBuffer']({'context':_0x40cc83,'typedArray':_0x238d4f,'usage':_0x44adcb['STATIC_DRAW'],'indexDatatype':_0x4bc455['UNSIGNED_SHORT']});_0x11beb8['_lineCommand']=new _0x97144d({'primitiveType':_0x131780['LINES'],'modelMatrix':_0x11beb8['_invertViewMatrix'],'boundingVolume':_0x11beb8['_boundingSphere'],'pass':_0x57ab81['OPAQUE'],'owner':_0x11beb8,'cull':!![]}),_0x11beb8['_lineCommand']['vertexArray']=new _0x378304({'context':_0x40cc83,'attributes':_0x49b922,'indexBuffer':_0x110782}),_0x11beb8['_lineCommand']['shaderProgram']=_0x6112ff['fromCache']({'context':_0x40cc83,'vertexShaderSource':_0x8beffc,'fragmentShaderSource':_0x3b51d7,'attributeLocations':_0x31a54c}),_0x11beb8['_lineCommand']['renderState']=_0x181c33['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![]}});const _0x106bde=[];for(let _0x97d54a=0x0;_0x97d54a<0x6;_0x97d54a++){_0x106bde[_0x97d54a]=new _0x1b0acf(0x0,0x0,0x0,0x0);}_0x11beb8['_lineCommand']['uniformMap']={'uDiffuseColor':function(){return _0x11beb8['_hintLineColor'];},'clip_mode':function(){return 0x0;},'clip_planes':function(){return _0x106bde;},'clip_line_color':function(){return _0x1b0acf['UNIT_W'];}},_0x11beb8['_stencilCommand']=new _0x97144d({'primitiveType':_0x131780['TRIANGLES'],'modelMatrix':_0x11beb8['_invertViewMatrix'],'boundingVolume':_0x11beb8['_boundingSphere'],'pass':_0x57ab81['OPAQUE'],'owner':_0x11beb8,'cull':!![]}),_0x11beb8['_stencilCommand']['vertexArray']=new _0x378304({'context':_0x40cc83,'attributes':_0x49b922,'indexBuffer':_0x1fb7fb}),_0x11beb8['_stencilCommand']['shaderProgram']=_0x6112ff['fromCache']({'context':_0x40cc83,'vertexShaderSource':_0x8beffc,'fragmentShaderSource':_0x3b51d7,'attributeLocations':_0x31a54c});let _0x3480ce={'enabled':!![],'frontFunction':_0x374e82['ALWAYS'],'frontOperation':{'fail':_0x36815b['KEEP'],'zFail':_0x36815b['KEEP'],'zPass':_0x36815b['INCREMENT_WRAP']},'backFunction':_0x374e82['ALWAYS'],'backOperation':{'fail':_0x36815b['KEEP'],'zFail':_0x36815b['KEEP'],'zPass':_0x36815b['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0};_0x11beb8['_stencilCommand']['renderState']=_0x181c33['fromCache']({'depthMask':![],'colorMask':{'red':![],'green':![],'blue':![],'alpha':![]},'depthTest':{'enabled':!![],'func':_0x583da4['GREATER']},'stencilTest':_0x3480ce,'stencilMask':0x1}),_0x11beb8['_stencilCommand']['uniformMap']={'uColor':function(){return _0x2e796e['WHITE'];}},_0x11beb8['_colorCommand']=new _0x97144d({'primitiveType':_0x131780['TRIANGLES'],'modelMatrix':_0x11beb8['_invertViewMatrix'],'boundingVolume':_0x11beb8['_boundingSphere'],'pass':_0x57ab81['OPAQUE'],'owner':_0x11beb8,'cull':!![]}),_0x11beb8['_colorCommand']['vertexArray']=new _0x378304({'context':_0x40cc83,'attributes':_0x49b922,'indexBuffer':_0x1fb7fb});const _0x222804=new _0x2dd57b({'name':'ViewShedAnalysisVS','sources':[_0x1f5015]});_0x11beb8['_colorCommand']['shaderProgram']=_0x6112ff['fromCache']({'context':_0x40cc83,'vertexShaderSource':_0x222804,'fragmentShaderSource':_0x4cf87b,'attributeLocations':_0x31a54c}),_0x3480ce={'enabled':!![],'frontFunction':_0x374e82['NOT_EQUAL'],'frontOperation':{'fail':_0x36815b['KEEP'],'zFail':_0x36815b['KEEP'],'zPass':_0x36815b['DECREMENT_WRAP']},'backFunction':_0x374e82['NOT_EQUAL'],'backOperation':{'fail':_0x36815b['KEEP'],'zFail':_0x36815b['KEEP'],'zPass':_0x36815b['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0},_0x11beb8['_colorCommand']['renderState']=_0x181c33['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':![]},'depthMask':![],'stencilTest':_0x3480ce,'blending':_0x1b358a['ALPHA_BLEND']}),_0x11beb8['_colorCommand']['uniformMap']={'uRenderTextureMatrix':function(){return _0x11beb8['_renderTextureMatrix'];},'uTexture1_size':function(){const _0x2b57de=_0x11beb8['_cameraDepthBuffer']['depthTexture'],_0x37514c=new _0x4b066a(_0x2b57de['width'],_0x2b57de['height']);return _0x37514c;},'uTexture1':function(){return _0x11beb8['_cameraDepthBuffer']['depthTexture'];},'uDiffuseTexture':function(){return _0x11beb8['_texture'];},'uBrightness':function(){return _0x11beb8['_brightness'];},'uContrast':function(){return _0x11beb8['_contrast'];},'uHue':function(){return _0x11beb8['_hue'];},'uSaturation':function(){return _0x11beb8['_saturation'];},'uOneOverGamma':function(){return 0x1/_0x11beb8['_gamma'];},'uFeatheringScale':function(){return _0x11beb8['_featheringScale'];},'uV3AffineX':function(){return _0x11beb8['_v3AffineX'];},'uV3AffineY':function(){return _0x11beb8['_v3AffineY'];}};}function _0x93d8db(_0x22693e,_0x2ffb16,_0x2cc785){if(_0x54b82c['distance'](_0x22693e['positionWC'],_0x2ffb16['center'])>_0x2cc785)return!![];const _0x162695=_0x22693e['frustum']['computeCullingVolume'](_0x22693e['positionWC'],_0x22693e['directionWC'],_0x22693e['upWC']),_0x2b9302=_0x162695['computeVisibility'](_0x2ffb16);return _0x2b9302===_0x895ef0['OUTSIDE'];}_0x26c657['prototype']['update']=function(_0x1327a8){const _0x2c5a14=_0x1327a8['context'],_0x585410=_0x1327a8['commandList'],_0xb344c6=_0x1327a8['camera'];if(_0x1327a8['fbo']||!this['_visible']||_0xb344c6['bReflect'])return;if(_0x176f59(this['_boundingSphereFromXML'])){if(_0x93d8db(_0xb344c6,this['_boundingSphereFromXML'],this['_visibleDistanceMax']))return;}if(this['_boundingSphere']['radius']!==0x0&&!this['_update']){if(_0x93d8db(_0xb344c6,this['_boundingSphere'],this['_visibleDistanceMax']))return;}_0x2deb1e['multiply'](this['_viewProjMatrix'],_0xb344c6['inverseViewMatrix'],this['_renderTextureMatrix']);_0x176f59(this['_video'])&&(this['_video']['readyState']>=0x2&&(!_0x176f59(this['_texture'])?this['_texture']=new _0x432d89({'context':_0x2c5a14,'source':this['_video']}):this['_texture']['copyFrom'](this['_video'])));if(!_0x176f59(this['_texture']))return;const _0x105efd=this['scene'];this['_update']&&(!_0x176f59(this['_cameraDepthBuffer'])&&(this['_cameraDepthBuffer']=new _0x20c959(_0x2c5a14)),this['_update']=![],_0x47bd24(this),_0x4c9eee(this,_0x2c5a14,_0x1327a8),_0x56d502(this,_0x2c5a14,_0x1327a8));if(_0x176f59(this['_cameraDepthBuffer']['depthTexture'])){_0x176f59(this['_stencilCommand'])&&_0x585410['push'](this['_stencilCommand']);_0x176f59(this['_colorCommand'])&&_0x585410['push'](this['_colorCommand']);if(_0x176f59(this['_lineCommand'])&&this['_hintLineVisible']){}}},_0x26c657['prototype']['setImage']=function(_0x30ee1f){if(!_0x176f59(_0x30ee1f))throw new _0x4b6721('options\x20is\x20required.');if(!_0x176f59(_0x30ee1f['url'])&&!_0x176f59(_0x30ee1f['video'])&&!_0x176f59(_0x30ee1f['image']))throw new _0x4b6721('options.url\x20or\x20options.video\x20or\x20options.image\x20are\x20required.');if(_0x176f59(_0x30ee1f['url'])){const _0x2c37c9=_0x597cc4['createIfNeeded'](_0x30ee1f['url']),_0x22ee17=this;_0x2c37c9['fetchImage']()['then'](_0x2e64fb=>{_0x176f59(_0x22ee17['_texture'])&&_0x22ee17['_texture']['destroy'](),_0x22ee17['_texture']=new _0x432d89({'context':_0x22ee17['scene']['_context'],'source':_0x2e64fb});});}else _0x176f59(_0x30ee1f['image'])?!_0x176f59(this['_texture'])?this['_texture']=new _0x432d89({'context':this['scene']['_context'],'source':_0x30ee1f['image']}):this['_texture']['copyFrom'](_0x30ee1f['image']):this['_video']=_0x30ee1f['video'];},_0x26c657['prototype']['setDistDirByPoint']=function(_0x397cc5){if(_0x397cc5[0x0]===this['_viewPosition'][0x0]&&_0x397cc5[0x1]===this['_viewPosition'][0x1]&&_0x397cc5[0x2]===this['_viewPosition'][0x2])throw new _0x4b6721('the\x20position\x20is\x20[longitude,\x20latitude\x20,height]\x20and\x20is\x20not\x20equals\x20viewPosition');const _0xe71bb=this['scene']['camera'],_0x453a67=_0xe71bb['_projection'];let _0x5425bf,_0x391b4f;if(this['scene']['mode']===_0x4818e2['SCENE3D'])_0x5425bf=_0x54b82c['fromDegreesArrayHeights'](_0x397cc5)[0x0],_0x391b4f=_0x54b82c['fromDegreesArrayHeights'](this['_viewPosition'])[0x0];else{const _0x451ab1=_0xec7c7d['fromDegrees'](_0x397cc5[0x0],_0x397cc5[0x1],_0x397cc5[0x2]);_0x5425bf=_0x453a67['project'](_0x451ab1,new _0x54b82c());const _0x5e2d14=_0xec7c7d['fromDegrees'](this['_viewPosition'][0x0],this['_viewPosition'][0x1],this['_viewPosition'][0x2]);_0x391b4f=_0x453a67['project'](_0x5e2d14,new _0x54b82c());}const _0x1f68d5=new _0x54b82c();_0x54b82c['subtract'](_0x5425bf,_0x391b4f,_0x1f68d5);const _0x557108=_0x54b82c['magnitude'](_0x1f68d5);_0x54b82c['normalize'](_0x1f68d5,_0x1f68d5),this['distance']=_0x557108;const _0xeddd09=_0xe71bb['heading'],_0x18e330=_0xe71bb['pitch'],_0x3cf162=_0xe71bb['roll'],_0x2c950c=new _0x54b82c();_0x54b82c['clone'](_0xe71bb['position'],_0x2c950c);const _0x261d01=_0x1f68d5['clone']();let _0x5e4a62=_0x391b4f['clone']();_0x5e4a62=_0x54b82c['normalize'](_0x5e4a62,_0x5e4a62);Math['abs'](_0x54b82c['dot'](_0x5e4a62,_0x261d01))>=0x1&&(Math['abs'](_0x54b82c['dot'](_0x261d01,_0x54b82c['UNIT_Y']))<0x1?_0x5e4a62=_0x54b82c['clone'](_0x54b82c['UNIT_Y'],_0x5e4a62):_0x5e4a62=_0x54b82c['clone'](_0x54b82c['UNIT_Z'],_0x5e4a62));let _0x4dfe2e=new _0x54b82c();_0x54b82c['cross'](_0x5e4a62,_0x261d01,_0x4dfe2e),_0x4dfe2e=_0x54b82c['normalize'](_0x4dfe2e,_0x4dfe2e),_0x54b82c['cross'](_0x261d01,_0x4dfe2e,_0x5e4a62),_0x5e4a62=_0x54b82c['normalize'](_0x5e4a62,_0x5e4a62),_0xe71bb['setView']({'destination':_0x391b4f,'orientation':{'direction':_0x261d01,'up':_0x5e4a62},'convert':![]}),this['direction']=_0xe71bb['heading']*_0x28513b['DEGREES_PER_RADIAN'],this['pitch']=_0xe71bb['pitch']*_0x28513b['DEGREES_PER_RADIAN'],_0xe71bb['setView']({'destination':_0x2c950c,'orientation':{'heading':_0xeddd09,'pitch':_0x18e330,'roll':_0x3cf162},'convert':![]});},_0x26c657['prototype']['setInfo']=function(_0x364bc7){if(!_0x176f59(_0x364bc7))throw new _0x4b6721('No\x20url\x20provided.');const _0x142137=this,_0x84114b=_0x597cc4['createIfNeeded'](_0x364bc7);return _0x84114b['fetchXML']()['then'](function(_0x1a178c){const _0x227b63=_0x1a178c['firstChild'],_0x1a48d4=_0x23d457(_0x227b63);_0x142137['direction']=_0x1a48d4['heading'],_0x142137['pitch']=_0x221890(_0x1a48d4['pitch'],_0x142137['pitch']),_0x142137['_roll']=_0x221890(_0x1a48d4['roll'],_0x142137['_roll']),_0x142137['horizontalFov']=_0x1a48d4['horizontalFov'],_0x142137['verticalFov']=_0x1a48d4['verticalFov'],_0x54b82c['clone'](_0x1a48d4['matrixU'],_0x142137['_v3AffineX']),_0x54b82c['clone'](_0x1a48d4['matrixV'],_0x142137['_v3AffineY']),_0x142137['distance']=_0x1a48d4['distance'],_0x142137['viewPosition']=_0x1a48d4['viewPosition'],_0x142137['_boundingSphereFromXML']=_0x1a48d4['boundingSphere'];},_0x36141a=>{console['error'](_0x36141a);});};function _0x23d457(_0x53126c){const _0x48e119=_0x487a01['queryStringValue'](_0x53126c,'VideoName'),_0x201771=_0x487a01['queryFirstNode'](_0x53126c,'Fov'),_0x5379d9=_0x487a01['queryNumericValue'](_0x201771,'Horizontal'),_0x4310ce=_0x487a01['queryNumericValue'](_0x201771,'Vertical'),_0x184745=_0x487a01['queryNumericValue'](_0x53126c,'Distance'),_0x38e1f8=_0x487a01['queryNumericValue'](_0x53126c,'Heading'),_0x225a5b=_0x487a01['queryNumericValue'](_0x53126c,'Pitch'),_0x5456b1=_0x487a01['queryNumericValue'](_0x53126c,'Roll'),_0x212c4f=_0x487a01['queryFirstNode'](_0x53126c,'ViewPosition'),_0x14cd37=[0x0,0x0,0x0];_0x14cd37[0x0]=_0x487a01['queryNumericValue'](_0x212c4f,'X'),_0x14cd37[0x1]=_0x487a01['queryNumericValue'](_0x212c4f,'Y'),_0x14cd37[0x2]=_0x487a01['queryNumericValue'](_0x212c4f,'Z');const _0x558680=_0x487a01['queryFirstNode'](_0x53126c,'Matrix'),_0x18f24e=_0x487a01['queryStringValue'](_0x558680,'U'),_0x279b35=_0x487a01['queryStringValue'](_0x558680,'V'),_0x43cf98=_0x487a01['queryStringValue'](_0x558680,'W'),_0x406077=_0x18f24e['split'](','),_0x43d276=new _0x54b82c(parseFloat(_0x406077[0x0]),parseFloat(_0x406077[0x1]),parseFloat(_0x406077[0x2])),_0x37afb5=_0x279b35['split'](','),_0x325af8=new _0x54b82c(parseFloat(_0x37afb5[0x0]),parseFloat(_0x37afb5[0x1]),parseFloat(_0x37afb5[0x2])),_0x3cf3bd=_0x487a01['queryFirstNode'](_0x53126c,'Bounds');let _0x5730b2;if(_0x3cf3bd){const _0x47daf3=_0x28513b['toRadians'](_0x487a01['queryNumericValue'](_0x3cf3bd,'Left')),_0xc24bb=_0x28513b['toRadians'](_0x487a01['queryNumericValue'](_0x3cf3bd,'Top')),_0x20cbf9=_0x28513b['toRadians'](_0x487a01['queryNumericValue'](_0x3cf3bd,'Right')),_0x396f5c=_0x28513b['toRadians'](_0x487a01['queryNumericValue'](_0x3cf3bd,'Bottom')),_0x4f626d=new _0x309115(_0x47daf3,_0x396f5c,_0x20cbf9,_0xc24bb);let _0x47a939=_0x184745*Math['cos'](_0x28513b['toRadians'](_0x225a5b));_0x47a939=_0x225a5b<0x0?-_0x47a939:_0x47a939;const _0x3cb1b8=_0x14cd37[0x2]+_0x47a939;_0x5730b2=_0x21228b['fromRectangle3D'](_0x4f626d,undefined,_0x3cb1b8);}return{'videoName':_0x48e119,'viewPosition':_0x14cd37,'heading':_0x38e1f8,'pitch':_0x225a5b,'roll':_0x5456b1,'horizontalFov':_0x5379d9,'verticalFov':_0x4310ce,'matrixU':_0x43d276,'matrixV':_0x325af8,'distance':_0x184745,'boundingSphere':_0x5730b2};}function _0x59df18(_0x3c1b96,_0x548d5a){let _0x3765d5=document['getElementById']('projection-image');!_0x176f59(_0x3765d5)&&(_0x3765d5=document['createElement']('div'),_0x3765d5['setAttribute']('id','projection-image'),document['body']['appendChild'](_0x3765d5));const _0x1e4b52=document['createElement']('video');return _0x1e4b52['style']='visibility:hidden;position:absolute;top:0px;left:0px;',_0x1e4b52['setAttribute']('width','320'),_0x1e4b52['setAttribute']('height','240'),_0x1e4b52['setAttribute']('autoplay','autoplay'),_0x1e4b52['setAttribute']('loop','loop'),_0x1e4b52['setAttribute']('crossorigin','crossorigin'),_0x1e4b52['setAttribute']('src',_0x3c1b96),_0x1e4b52['setAttribute']('id','projection-image-'+_0x548d5a),_0x3765d5['appendChild'](_0x1e4b52),_0x1e4b52;}_0x26c657['fromInfo']=function(_0xdb5b16,_0x5cbc4a,_0x5f19ea){if(!_0x176f59(_0xdb5b16))throw new _0x4b6721('No\x20scene\x20provided.');if(!_0x176f59(_0x5cbc4a))throw new _0x4b6721('No\x20url\x20provided.');const _0x218a22=_0x597cc4['createIfNeeded'](_0x5cbc4a);return _0x218a22['fetchXML']()['then'](function(_0x13b8e5){const _0xe40b5f={},_0x2bb333=_0x13b8e5['firstChild'];for(let _0x2de0fb=0x0,_0x108043=_0x2bb333['children']['length'];_0x2de0fb<_0x108043;_0x2de0fb++){const _0xcf66b9=_0x2bb333['children'][_0x2de0fb],_0x2988ae=_0x23d457(_0xcf66b9);let _0xb28df7=_0x2988ae['videoName'];_0x176f59(_0x5f19ea)?_0xb28df7=_0x53922d(_0x5f19ea)+_0x2988ae['videoName']:_0xb28df7=_0x5cbc4a['slice'](0x0,_0x5cbc4a['lastIndexOf']('/')+0x1)+_0x2988ae['videoName'];const _0x3fd906=new _0x26c657(_0xdb5b16),_0x1ca2ab=_0x59df18(_0xb28df7,_0x3fd906['_guid']);_0x3fd906['viewPosition']=_0x2988ae['viewPosition'],_0x3fd906['direction']=_0x2988ae['heading'],_0x3fd906['pitch']=_0x2988ae['pitch'],_0x3fd906['horizontalFov']=_0x2988ae['horizontalFov'],_0x3fd906['verticalFov']=_0x2988ae['verticalFov'],_0x54b82c['clone'](_0x2988ae['matrixU'],_0x3fd906['_v3AffineX']),_0x54b82c['clone'](_0x2988ae['matrixV'],_0x3fd906['_v3AffineY']),_0x3fd906['distance']=_0x2988ae['distance'],_0x3fd906['setImage']({'video':_0x1ca2ab}),_0x3fd906['_boundingSphere']=XML=_0x2988ae['boundingSphere'],_0x1ca2ab['addEventListener']('loadeddata',function(_0x1bd825){_0x1bd825['build']();}['bind'](_0x1ca2ab,_0x3fd906)),_0xe40b5f[_0x2988ae['videoName']]=_0x3fd906;}return _0xe40b5f;},_0x281d1a=>{console['error'](_0x281d1a);});},_0x26c657['prototype']['build']=function(){if(this['isBuild'])return;this['isBuild']=!![],this['scene']['primitives']['add'](this),this['removeListenerFunc']=this['scene']['preUpdate']['addEventListener'](_0x125d86=>{_0x176f59(this['_cameraDepthBuffer'])&&this['_cameraDepthBuffer']['renderToTexture'](_0x125d86);},this);},_0x26c657['prototype']['clear']=function(){if(!this['isBuild'])return;this['isBuild']=![],this['removeListenerFunc'](),this['scene']['primitives']['remove'](this);},_0x26c657['prototype']['destroy']=function(){const _0x1be60e=document['getElementById']('projection-image-'+this['_guid']);if(_0x1be60e){const _0x5b0cc7=_0x1be60e['parentNode'];_0x5b0cc7['removeChild'](_0x1be60e),_0x5b0cc7['children']['length']===0x0&&_0x5b0cc7['parentNode']['removeChild'](_0x5b0cc7);}return this['_cameraDepthBuffer']=this['_cameraDepthBuffer']&&this['_cameraDepthBuffer']['destroy'](),_0x47bd24(this),this['_texture']=this['_texture']&&!this['_texture']['isDestroyed']()&&this['_texture']['destroy'](),this['scene']['primitives']['remove'](this),_0x195288(this);};export default _0x26c657;