const _0x4cde20=(function(){let _0x2b28a3=!![];return function(_0x336370,_0x535ef4){const _0x9fea15=_0x2b28a3?function(){if(_0x535ef4){const _0x33f216=_0x535ef4['apply'](_0x336370,arguments);return _0x535ef4=null,_0x33f216;}}:function(){};return _0x2b28a3=![],_0x9fea15;};}()),_0xfee4ca=_0x4cde20(this,function(){return _0xfee4ca['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0xfee4ca)['search']('(((.+)+)+)+$');});_0xfee4ca();import _0x3014cd from'./DepthFramebuffer.js';import _0x412e5e from'./Shaders/NoLightNoTextureVS.js';import _0x22f492 from'./Shaders/NoLightNoTextureFS.js';import _0xdf14cf from'./Shaders/ViewShedAnalysisVS.js';import _0x16f125 from'./Shaders/ProjectionImageFS.js';import _0xc9c04e from'./XMLParser.js';const _0xd905a3=Cesium['BoundingSphere'],_0x54e1be=Cesium['Cartesian2'],_0x3256d0=Cesium['Cartesian3'],_0x3404b1=Cesium['Cartesian4'],_0x59c5da=Cesium['Color'],_0x14866b=Cesium['ComponentDatatype'],_0x573053=Cesium['defined'],_0x362342=Cesium['defaultValue'],_0x4c4454=Cesium['destroyObject'],_0x11c1e1=Cesium['DeveloperError'],_0x21dce5=Cesium['IndexDatatype'],_0x13b42f=Cesium['Math'],_0x366b5e=Cesium['Matrix4'],_0x407851=Cesium['PrimitiveType'],_0x37bb8b=Cesium['Check'],_0x2a0756=Cesium['appendForwardSlash'],_0x13be09=Cesium['Rectangle'],_0x22e220=Cesium['Intersect'],_0x5087ae=Cesium['Cartographic'],_0x1b8d7b=Cesium['Pass'],_0x17d5d7=Cesium['Buffer'],_0x1dc320=Cesium['BufferUsage'],_0x372442=Cesium['DrawCommand'],_0x54c45c=Cesium['RenderState'],_0x3780c3=Cesium['Texture'],_0x1076ae=Cesium['ShaderProgram'],_0xb01a31=Cesium['VertexArray'],_0x1658af=Cesium['ShaderSource'],_0x21f082=Cesium['BlendingState'],_0x4350e5=Cesium['SceneMode'],_0x33a24d=Cesium['StencilOperation'],_0x7e2474=Cesium['StencilFunction'],_0x23285a=Cesium['DepthFunction'],_0x1e5906=Cesium['Resource'];function _0x4fb36d(_0x661aac){if(!_0x573053(_0x661aac))throw new _0x11c1e1('scene\x20are\x20required.');if(!_0x661aac['context']['depthTexture'])throw new _0x11c1e1('the\x20depth\x20buffer\x20is\x20not\x20supported.');this['scene']=_0x661aac,this['_cameraDepthBuffer']=undefined,this['_lineCommand']=undefined,this['_stencilCommand']=undefined,this['_colorCommand']=undefined,this['_boundingSphere']=new _0xd905a3(),this['_viewPosition']=[0x0,0x0,0x0],this['_direction']=0x0,this['_pitch']=0x0,this['_roll']=0x0,this['_horizontalFov']=0x5a,this['_verticalFov']=0x3c,this['_distance']=0xc8,this['_hintLineColor']=new _0x59c5da(0x1,0x1,0x1,0x1),this['_hintLineVisible']=!![],this['_texture']=undefined,this['_segmentCount']=0x14,this['_invertViewMatrix']=new _0x366b5e(),this['_viewProjMatrix']=new _0x366b5e(),this['_renderTextureMatrix']=new _0x366b5e(),this['_update']=!![],this['_video']=undefined,this['_brightness']=0x1,this['_contrast']=0x1,this['_hue']=0x0,this['_saturation']=0x1,this['_gamma']=0x1,this['_featheringScale']=0x0,this['_v3AffineX']=new _0x3256d0(0x1,0x0,0x0),this['_v3AffineY']=new _0x3256d0(0x0,0x1,0x0),this['_visible']=!![],this['_visibleDistanceMax']=0x1f4,this['isBuild']=![];}Object['defineProperties'](_0x4fb36d['prototype'],{'viewPosition':{'get':function(){return this['_viewPosition'];},'set':function(_0x1878e4){this['_viewPosition']=_0x1878e4,this['_update']=!![];}},'direction':{'get':function(){return this['_direction'];},'set':function(_0x23d131){this['_direction']=_0x23d131,this['_update']=!![];}},'pitch':{'get':function(){return this['_pitch'];},'set':function(_0x4f084a){this['_pitch']=_0x4f084a,this['_update']=!![];}},'roll':{'get':function(){return this['_roll'];},'set':function(_0x6470a9){this['_roll']=_0x6470a9,this['_update']=!![];}},'horizontalFov':{'get':function(){return this['_horizontalFov'];},'set':function(_0x3a5cee){this['_horizontalFov']=_0x3a5cee,this['_update']=!![];}},'verticalFov':{'get':function(){return this['_verticalFov'];},'set':function(_0x401f2e){this['_verticalFov']=_0x401f2e,this['_update']=!![];}},'distance':{'get':function(){return this['_distance'];},'set':function(_0x462078){if(_0x462078<=0x0)throw new _0x11c1e1('the\x20distance\x20is\x20greater\x20than\x200.0');this['_distance']=_0x462078,this['_update']=!![];}},'featheringScale':{'get':function(){return this['_featheringScale'];},'set':function(_0x550970){if(_0x550970<0x0||_0x550970>0x1)throw new _0x11c1e1('the\x20distance\x20is\x20greater\x20than\x200.0\x20an\x20less\x20than\x201.0');this['_featheringScale']=_0x550970;}},'hintLineColor':{'get':function(){return this['_hintLineColor'];},'set':function(_0x12b152){if(!_0x573053(_0x12b152))return;this['_hintLineColor']=_0x59c5da['clone'](_0x12b152,this['_hintLineColor']);}},'hintLineVisible':{'get':function(){return this['_hintLineVisible'];},'set':function(_0x6dd795){this['_hintLineVisible']=_0x6dd795;}},'brightness':{'get':function(){return this['_brightness'];},'set':function(_0x5e55b7){_0x37bb8b['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.brightness',_0x5e55b7,0x0),this['_brightness']=_0x5e55b7;}},'contrast':{'get':function(){return this['_contrast'];},'set':function(_0x2b939c){_0x37bb8b['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.contrast',_0x2b939c,0x0),this['_contrast']=_0x2b939c;}},'hue':{'get':function(){return this['_hue'];},'set':function(_0x1f054b){_0x37bb8b['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.hue',_0x1f054b,0x0),this['_hue']=_0x1f054b;}},'saturation':{'get':function(){return this['_saturation'];},'set':function(_0x3bf23c){_0x37bb8b['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.saturation',_0x3bf23c,0x0),this['_saturation']=_0x3bf23c;}},'gamma':{'get':function(){return this['_gamma'];},'set':function(_0x3566d3){_0x37bb8b['typeOf']['number']['greaterThan']('ProjectionImage.gamma',_0x3566d3,0x0),this['_gamma']=_0x3566d3;}},'visible':{'get':function(){return this['_visible'];},'set':function(_0x59ae30){_0x37bb8b['typeOf']['bool']('ProjectionImage.visible',_0x59ae30),this['_visible']=_0x59ae30;}},'visibleDistanceMax':{'get':function(){return this['_visibleDistanceMax'];},'set':function(_0x497562){_0x37bb8b['typeOf']['number']('ProjectionImage.visibleDistance',_0x497562),this['_visibleDistanceMax']=_0x497562;}}});function _0x52f349(_0x360ec1){_0x573053(_0x360ec1['_stencilCommand'])&&(_0x360ec1['_stencilCommand']['vertexArray']=_0x360ec1['_stencilCommand']['vertexArray']&&_0x360ec1['_stencilCommand']['vertexArray']['destroy'](),_0x360ec1['_stencilCommand']['shaderProgram']=_0x360ec1['_stencilCommand']['shaderProgram']&&_0x360ec1['_stencilCommand']['shaderProgram']['destroy'](),_0x360ec1['_stencilCommand']=undefined),_0x573053(_0x360ec1['_colorCommand'])&&(_0x360ec1['_colorCommand']['vertexArray']=_0x360ec1['_colorCommand']['vertexArray']&&_0x360ec1['_colorCommand']['vertexArray']['destroy'](),_0x360ec1['_colorCommand']['shaderProgram']=_0x360ec1['_colorCommand']['shaderProgram']&&_0x360ec1['_colorCommand']['shaderProgram']['destroy'](),_0x360ec1['_colorCommand']=undefined),_0x573053(_0x360ec1['_lineCommand'])&&(_0x360ec1['_lineCommand']['vertexArray']=_0x360ec1['_lineCommand']['vertexArray']&&_0x360ec1['_lineCommand']['vertexArray']['destroy'](),_0x360ec1['_lineCommand']['shaderProgram']=_0x360ec1['_lineCommand']['shaderProgram']&&_0x360ec1['_lineCommand']['shaderProgram']['destroy'](),_0x360ec1['_lineCommand']=undefined);}function _0x2117ff(_0x242fcb,_0x4b539f,_0x3f4050){const _0x3c61ed=_0x242fcb['_horizontalFov']*_0x13b42f['RADIANS_PER_DEGREE'],_0x44b2cc=_0x242fcb['_verticalFov']*_0x13b42f['RADIANS_PER_DEGREE'],_0x4b3891=Math['tan'](_0x3c61ed*0.5),_0x168d76=Math['tan'](_0x44b2cc*0.5),_0x2bf55b=_0x4b3891/_0x168d76,_0x322631=_0x242fcb['_distance']*0.001,_0x188f81=Math['max'](_0x242fcb['_distance'],0xa),_0x3ccdf8=_0x242fcb['_direction']*_0x13b42f['RADIANS_PER_DEGREE'],_0x562d16=_0x242fcb['_pitch']*_0x13b42f['RADIANS_PER_DEGREE'],_0x2069d8=_0x242fcb['_roll']*_0x13b42f['RADIANS_PER_DEGREE'],_0x3b374f=_0x3256d0['fromDegreesArrayHeights'](_0x242fcb['_viewPosition'])[0x0],_0x25b876=_0x3f4050['camera'],_0x20ca0d=_0x25b876['frustum']['aspectRatio'],_0x359793=_0x25b876['frustum']['fov'],_0x44b8b6=_0x25b876['frustum']['near'],_0x3e910a=_0x25b876['frustum']['far'],_0x589c2e=new _0x3256d0(),_0x3941f3=_0x25b876['heading'],_0x4e49b8=_0x25b876['pitch'],_0x3279df=_0x25b876['roll'];_0x3256d0['clone'](_0x25b876['position'],_0x589c2e),_0x242fcb['_cameraDepthBuffer']['isUpdate']=!![];const _0x3099d6=_0x3f4050['useLogDepth'];_0x242fcb['_cameraDepthBuffer']['beginFunc']=function(){_0x3f4050['useLogDepth']=![],_0x3256d0['clone'](_0x25b876['position'],_0x589c2e),_0x25b876['frustum']['aspectRatio']=_0x2bf55b,_0x25b876['frustum']['fov']=_0x2bf55b>=0x1?_0x3c61ed:_0x44b2cc,_0x25b876['frustum']['near']=0x1,_0x25b876['frustum']['far']=_0x188f81,_0x3099d6&&(_0x25b876['frustum']['near']=0.1,_0x25b876['frustum']['far']=0x5f5e100),_0x25b876['setView']({'destination':_0x3b374f,'orientation':{'heading':_0x3ccdf8,'pitch':_0x562d16,'roll':_0x2069d8}}),_0x366b5e['multiply'](_0x25b876['frustum']['projectionMatrix'],_0x25b876['viewMatrix'],_0x242fcb['_viewProjMatrix']),_0x366b5e['clone'](_0x25b876['inverseViewMatrix'],_0x242fcb['_invertViewMatrix']),_0x3256d0['clone'](_0x3256d0['ZERO'],_0x242fcb['_boundingSphere']['center']),_0x242fcb['_boundingSphere']['radius']=_0x242fcb['_distance'],_0xd905a3['transform'](_0x242fcb['_boundingSphere'],_0x242fcb['_invertViewMatrix'],_0x242fcb['_boundingSphere']);},_0x242fcb['_cameraDepthBuffer']['endFunc']=function(){_0x25b876['setView']({'destination':_0x589c2e,'orientation':{'heading':_0x3941f3,'pitch':_0x4e49b8,'roll':_0x3279df},'convert':![]}),_0x25b876['frustum']['aspectRatio']=_0x20ca0d,_0x25b876['frustum']['fov']=_0x359793,_0x25b876['frustum']['near']=_0x44b8b6,_0x25b876['frustum']['far']=_0x3e910a,_0x3f4050['useLogDepth']=_0x3099d6,_0x242fcb['_cameraDepthBuffer']['isUpdate']=![];};}function _0x9188e1(_0x20e312,_0x54c1fd,_0x1808a5){const _0x3979b1=(_0x20e312['_segmentCount']+0x1)*(_0x20e312['_segmentCount']+0x1)+0x1,_0x4e35ab=_0x14866b['createTypedArray'](_0x14866b['FLOAT'],_0x3979b1*0x3);let _0xf1406a=0x3;const _0x359d8e=_0x20e312['_horizontalFov']*_0x13b42f['RADIANS_PER_DEGREE'],_0x23133a=_0x20e312['_verticalFov']*_0x13b42f['RADIANS_PER_DEGREE'],_0x382a03=Math['tan'](_0x359d8e*0.5),_0x1f9430=Math['tan'](_0x23133a*0.5),_0x2d383d=_0x20e312['_distance']*_0x382a03,_0x12cbfb=_0x20e312['_distance']*_0x1f9430,_0x220786=Math['PI']-_0x359d8e*0.5;let _0x3b40b3=0x0,_0x12efc3=0x0,_0xbb1fcd=_0x359d8e/_0x20e312['_segmentCount'];for(let _0x9d2828=0x0;_0x9d2828<_0x20e312['_segmentCount']+0x1;_0x9d2828++){_0x3b40b3=_0x220786+_0x9d2828*_0xbb1fcd;const _0x1dc54e=_0x12cbfb/(_0x20e312['_distance']/Math['cos'](_0x3b40b3)),_0x3ef7de=Math['atan'](_0x1dc54e),_0x4a996d=-_0x3ef7de,_0x33aea2=_0x3ef7de*0x2/_0x20e312['_segmentCount'];for(let _0x22b510=0x0;_0x22b510<_0x20e312['_segmentCount']+0x1;_0x22b510++){_0x12efc3=_0x4a996d+_0x22b510*_0x33aea2,_0x4e35ab[_0xf1406a++]=_0x20e312['_distance']*Math['cos'](_0x12efc3)*Math['sin'](_0x3b40b3),_0x4e35ab[_0xf1406a++]=_0x20e312['_distance']*Math['sin'](_0x12efc3),_0x4e35ab[_0xf1406a++]=_0x20e312['_distance']*Math['cos'](_0x12efc3)*Math['cos'](_0x3b40b3);}}const _0x285ee9=(0x4+_0x20e312['_segmentCount']*0x5+_0x20e312['_segmentCount']*0x2*0x3)*0x2,_0x4f09ec=_0x20e312['_segmentCount']*_0x20e312['_segmentCount']*0x3*0x2+_0x20e312['_segmentCount']*0x3*0x4,_0x5d5097=_0x14866b['createTypedArray'](_0x14866b['UNSIGNED_SHORT'],_0x285ee9),_0x1adda4=_0x14866b['createTypedArray'](_0x14866b['UNSIGNED_SHORT'],_0x4f09ec);let _0x191022=0x0;const _0x1b1958=0x1;for(let _0x3261e5=0x0;_0x3261e5<_0x20e312['_segmentCount'];_0x3261e5++){for(let _0x93eb07=0x0;_0x93eb07<_0x20e312['_segmentCount'];_0x93eb07++){_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+_0x93eb07*(_0x20e312['_segmentCount']+0x1),_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+0x1+_0x93eb07*(_0x20e312['_segmentCount']+0x1),_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+(_0x93eb07+0x1)*(_0x20e312['_segmentCount']+0x1),_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+0x1+_0x93eb07*(_0x20e312['_segmentCount']+0x1),_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+0x1+(_0x93eb07+0x1)*(_0x20e312['_segmentCount']+0x1),_0x1adda4[_0x191022++]=_0x1b1958+_0x3261e5+(_0x93eb07+0x1)*(_0x20e312['_segmentCount']+0x1);}}for(let _0x2ee7ef=0x0;_0x2ee7ef<_0x20e312['_segmentCount'];_0x2ee7ef++){_0x1adda4[_0x191022++]=_0x2ee7ef+0x1+_0x1b1958,_0x1adda4[_0x191022++]=_0x2ee7ef+_0x1b1958,_0x1adda4[_0x191022++]=0x0,_0x1adda4[_0x191022++]=0x0,_0x1adda4[_0x191022++]=_0x2ee7ef+_0x20e312['_segmentCount']*(_0x20e312['_segmentCount']+0x1)+_0x1b1958,_0x1adda4[_0x191022++]=_0x2ee7ef+0x1+_0x20e312['_segmentCount']*(_0x20e312['_segmentCount']+0x1)+_0x1b1958;}for(let _0x5afb72=0x0;_0x5afb72<_0x20e312['_segmentCount'];_0x5afb72++){_0x1adda4[_0x191022++]=0x0,_0x1adda4[_0x191022++]=_0x5afb72*(_0x20e312['_segmentCount']+0x1)+_0x1b1958,_0x1adda4[_0x191022++]=(_0x5afb72+0x1)*(_0x20e312['_segmentCount']+0x1)+_0x1b1958,_0x1adda4[_0x191022++]=_0x20e312['_segmentCount']+(_0x5afb72+0x1)*(_0x20e312['_segmentCount']+0x1)+_0x1b1958,_0x1adda4[_0x191022++]=_0x20e312['_segmentCount']+_0x5afb72*(_0x20e312['_segmentCount']+0x1)+_0x1b1958,_0x1adda4[_0x191022++]=0x0;}_0x191022=0x0,_0x5d5097[_0x191022++]=0x0,_0x5d5097[_0x191022++]=0x1,_0x5d5097[_0x191022++]=0x0,_0x5d5097[_0x191022++]=_0x20e312['_segmentCount']+0x1,_0x5d5097[_0x191022++]=0x0,_0x5d5097[_0x191022++]=_0x20e312['_segmentCount']*(_0x20e312['_segmentCount']+0x1)+0x1,_0x5d5097[_0x191022++]=0x0,_0x5d5097[_0x191022++]=(_0x20e312['_segmentCount']+0x1)*(_0x20e312['_segmentCount']+0x1);for(let _0x8510e=0x0;_0x8510e<0x5;_0x8510e++){for(let _0xb47f26=0x0;_0xb47f26<_0x20e312['_segmentCount'];_0xb47f26++){_0x5d5097[_0x191022++]=0x1+_0xb47f26+(_0x20e312['_segmentCount']+0x1)*0x5*_0x8510e,_0x5d5097[_0x191022++]=0x1+(_0xb47f26+0x1)+(_0x20e312['_segmentCount']+0x1)*0x5*_0x8510e;}}for(let _0x197b7e=0x0;_0x197b7e<0x5;_0x197b7e++){for(let _0x2886e5=0x0;_0x2886e5<_0x20e312['_segmentCount'];_0x2886e5++){_0x5d5097[_0x191022++]=0x1+(_0x20e312['_segmentCount']+0x1)*_0x2886e5+_0x197b7e*0x5,_0x5d5097[_0x191022++]=0x1+(_0x20e312['_segmentCount']+0x1)*(_0x2886e5+0x1)+_0x197b7e*0x5;}}const _0x30f11c=_0x17d5d7['createVertexBuffer']({'context':_0x54c1fd,'typedArray':_0x4e35ab,'usage':_0x1dc320['STATIC_DRAW']}),_0x4d63c9=[],_0x4c61dc={};_0x4c61dc['aPosition']=0x0,_0x4d63c9['push']({'index':_0x4c61dc['aPosition'],'vertexBuffer':_0x30f11c,'componentsPerAttribute':0x3,'componentDatatype':_0x14866b['FLOAT'],'offsetInBytes':0x0,'strideInBytes':0x3*0x4,'normalize':![]});const _0x374bce=_0x17d5d7['createIndexBuffer']({'context':_0x54c1fd,'typedArray':_0x5d5097,'usage':_0x1dc320['STATIC_DRAW'],'indexDatatype':_0x21dce5['UNSIGNED_SHORT']}),_0x3944a3=_0x17d5d7['createIndexBuffer']({'context':_0x54c1fd,'typedArray':_0x1adda4,'usage':_0x1dc320['STATIC_DRAW'],'indexDatatype':_0x21dce5['UNSIGNED_SHORT']});_0x20e312['_lineCommand']=new _0x372442({'primitiveType':_0x407851['LINES'],'modelMatrix':_0x20e312['_invertViewMatrix'],'boundingVolume':_0x20e312['_boundingSphere'],'pass':_0x1b8d7b['OPAQUE'],'owner':_0x20e312,'cull':!![]}),_0x20e312['_lineCommand']['vertexArray']=new _0xb01a31({'context':_0x54c1fd,'attributes':_0x4d63c9,'indexBuffer':_0x374bce}),_0x20e312['_lineCommand']['shaderProgram']=_0x1076ae['fromCache']({'context':_0x54c1fd,'vertexShaderSource':_0x412e5e,'fragmentShaderSource':_0x22f492,'attributeLocations':_0x4c61dc}),_0x20e312['_lineCommand']['renderState']=_0x54c45c['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![]}});const _0x5d7c55=[];for(let _0x661f41=0x0;_0x661f41<0x6;_0x661f41++){_0x5d7c55[_0x661f41]=new _0x3404b1(0x0,0x0,0x0,0x0);}_0x20e312['_lineCommand']['uniformMap']={'uDiffuseColor':function(){return _0x20e312['_hintLineColor'];},'clip_mode':function(){return 0x0;},'clip_planes':function(){return _0x5d7c55;},'clip_line_color':function(){return _0x3404b1['UNIT_W'];}},_0x20e312['_stencilCommand']=new _0x372442({'primitiveType':_0x407851['TRIANGLES'],'modelMatrix':_0x20e312['_invertViewMatrix'],'boundingVolume':_0x20e312['_boundingSphere'],'pass':_0x1b8d7b['OPAQUE'],'owner':_0x20e312,'cull':!![]}),_0x20e312['_stencilCommand']['vertexArray']=new _0xb01a31({'context':_0x54c1fd,'attributes':_0x4d63c9,'indexBuffer':_0x3944a3}),_0x20e312['_stencilCommand']['shaderProgram']=_0x1076ae['fromCache']({'context':_0x54c1fd,'vertexShaderSource':_0x412e5e,'fragmentShaderSource':_0x22f492,'attributeLocations':_0x4c61dc});let _0x768846={'enabled':!![],'frontFunction':_0x7e2474['ALWAYS'],'frontOperation':{'fail':_0x33a24d['KEEP'],'zFail':_0x33a24d['KEEP'],'zPass':_0x33a24d['INCREMENT_WRAP']},'backFunction':_0x7e2474['ALWAYS'],'backOperation':{'fail':_0x33a24d['KEEP'],'zFail':_0x33a24d['KEEP'],'zPass':_0x33a24d['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0};_0x20e312['_stencilCommand']['renderState']=_0x54c45c['fromCache']({'depthMask':![],'colorMask':{'red':![],'green':![],'blue':![],'alpha':![]},'depthTest':{'enabled':!![],'func':_0x23285a['GREATER']},'stencilTest':_0x768846,'stencilMask':0x1}),_0x20e312['_stencilCommand']['uniformMap']={'uColor':function(){return _0x59c5da['WHITE'];}},_0x20e312['_colorCommand']=new _0x372442({'primitiveType':_0x407851['TRIANGLES'],'modelMatrix':_0x20e312['_invertViewMatrix'],'boundingVolume':_0x20e312['_boundingSphere'],'pass':_0x1b8d7b['OPAQUE'],'owner':_0x20e312,'cull':!![]}),_0x20e312['_colorCommand']['vertexArray']=new _0xb01a31({'context':_0x54c1fd,'attributes':_0x4d63c9,'indexBuffer':_0x3944a3});const _0x2bc61b=new _0x1658af({'name':'ViewShedAnalysisVS','sources':[_0xdf14cf]});_0x20e312['_colorCommand']['shaderProgram']=_0x1076ae['fromCache']({'context':_0x54c1fd,'vertexShaderSource':_0x2bc61b,'fragmentShaderSource':_0x16f125,'attributeLocations':_0x4c61dc}),_0x768846={'enabled':!![],'frontFunction':_0x7e2474['NOT_EQUAL'],'frontOperation':{'fail':_0x33a24d['KEEP'],'zFail':_0x33a24d['KEEP'],'zPass':_0x33a24d['DECREMENT_WRAP']},'backFunction':_0x7e2474['NOT_EQUAL'],'backOperation':{'fail':_0x33a24d['KEEP'],'zFail':_0x33a24d['KEEP'],'zPass':_0x33a24d['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0},_0x20e312['_colorCommand']['renderState']=_0x54c45c['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':![]},'depthMask':![],'stencilTest':_0x768846,'blending':_0x21f082['ALPHA_BLEND']}),_0x20e312['_colorCommand']['uniformMap']={'uRenderTextureMatrix':function(){return _0x20e312['_renderTextureMatrix'];},'uTexture1_size':function(){const _0x5b5d2b=_0x20e312['_cameraDepthBuffer']['depthTexture'],_0x2ca5ad=new _0x54e1be(_0x5b5d2b['width'],_0x5b5d2b['height']);return _0x2ca5ad;},'uTexture1':function(){return _0x20e312['_cameraDepthBuffer']['depthTexture'];},'uDiffuseTexture':function(){return _0x20e312['_texture'];},'uBrightness':function(){return _0x20e312['_brightness'];},'uContrast':function(){return _0x20e312['_contrast'];},'uHue':function(){return _0x20e312['_hue'];},'uSaturation':function(){return _0x20e312['_saturation'];},'uOneOverGamma':function(){return 0x1/_0x20e312['_gamma'];},'uFeatheringScale':function(){return _0x20e312['_featheringScale'];},'uV3AffineX':function(){return _0x20e312['_v3AffineX'];},'uV3AffineY':function(){return _0x20e312['_v3AffineY'];}};}function _0x1e7267(_0x261bd0,_0x571e59,_0x493cd4){if(_0x3256d0['distance'](_0x261bd0['positionWC'],_0x571e59['center'])>_0x493cd4)return!![];const _0x84c728=_0x261bd0['frustum']['computeCullingVolume'](_0x261bd0['positionWC'],_0x261bd0['directionWC'],_0x261bd0['upWC']),_0x1ece16=_0x84c728['computeVisibility'](_0x571e59);return _0x1ece16===_0x22e220['OUTSIDE'];}_0x4fb36d['prototype']['update']=function(_0x879999){const _0x55c20f=_0x879999['context'],_0x47989d=_0x879999['commandList'],_0x45b089=_0x879999['camera'];if(_0x879999['fbo']||!this['_visible']||_0x45b089['bReflect'])return;if(_0x573053(this['_boundingSphereFromXML'])){if(_0x1e7267(_0x45b089,this['_boundingSphereFromXML'],this['_visibleDistanceMax']))return;}if(this['_boundingSphere']['radius']!==0x0&&!this['_update']){if(_0x1e7267(_0x45b089,this['_boundingSphere'],this['_visibleDistanceMax']))return;}_0x366b5e['multiply'](this['_viewProjMatrix'],_0x45b089['inverseViewMatrix'],this['_renderTextureMatrix']);_0x573053(this['_video'])&&(this['_video']['readyState']>=0x2&&(!_0x573053(this['_texture'])?this['_texture']=new _0x3780c3({'context':_0x55c20f,'source':this['_video']}):this['_texture']['copyFrom'](this['_video'])));if(!_0x573053(this['_texture']))return;const _0x215aa3=this['scene'];this['_update']&&(!_0x573053(this['_cameraDepthBuffer'])&&(this['_cameraDepthBuffer']=new _0x3014cd(_0x55c20f)),this['_update']=![],_0x52f349(this),_0x2117ff(this,_0x55c20f,_0x879999),_0x9188e1(this,_0x55c20f,_0x879999));if(_0x573053(this['_cameraDepthBuffer']['depthTexture'])){_0x573053(this['_stencilCommand'])&&_0x47989d['push'](this['_stencilCommand']);_0x573053(this['_colorCommand'])&&_0x47989d['push'](this['_colorCommand']);if(_0x573053(this['_lineCommand'])&&this['_hintLineVisible']){}}},_0x4fb36d['prototype']['setImage']=function(_0x281ca3){if(!_0x573053(_0x281ca3))throw new _0x11c1e1('options\x20is\x20required.');if(!_0x573053(_0x281ca3['url'])&&!_0x573053(_0x281ca3['video'])&&!_0x573053(_0x281ca3['image']))throw new _0x11c1e1('options.url\x20or\x20options.video\x20or\x20options.image\x20are\x20required.');if(_0x573053(_0x281ca3['url'])){const _0x14ddf7=_0x1e5906['createIfNeeded'](_0x281ca3['url']),_0x2bf9a1=this;_0x14ddf7['fetchImage']()['then'](_0x3e986d=>{_0x573053(_0x2bf9a1['_texture'])&&_0x2bf9a1['_texture']['destroy'](),_0x2bf9a1['_texture']=new _0x3780c3({'context':_0x2bf9a1['scene']['_context'],'source':_0x3e986d});});}else _0x573053(_0x281ca3['image'])?!_0x573053(this['_texture'])?this['_texture']=new _0x3780c3({'context':this['scene']['_context'],'source':_0x281ca3['image']}):this['_texture']['copyFrom'](_0x281ca3['image']):this['_video']=_0x281ca3['video'];},_0x4fb36d['prototype']['setDistDirByPoint']=function(_0x458f5c){if(_0x458f5c[0x0]===this['_viewPosition'][0x0]&&_0x458f5c[0x1]===this['_viewPosition'][0x1]&&_0x458f5c[0x2]===this['_viewPosition'][0x2])throw new _0x11c1e1('the\x20position\x20is\x20[longitude,\x20latitude\x20,height]\x20and\x20is\x20not\x20equals\x20viewPosition');const _0x4e1e96=this['scene']['camera'],_0x32dcc6=_0x4e1e96['_projection'];let _0x1fe737,_0x4ab4fb;if(this['scene']['mode']===_0x4350e5['SCENE3D'])_0x1fe737=_0x3256d0['fromDegreesArrayHeights'](_0x458f5c)[0x0],_0x4ab4fb=_0x3256d0['fromDegreesArrayHeights'](this['_viewPosition'])[0x0];else{const _0x1cc9df=_0x5087ae['fromDegrees'](_0x458f5c[0x0],_0x458f5c[0x1],_0x458f5c[0x2]);_0x1fe737=_0x32dcc6['project'](_0x1cc9df,new _0x3256d0());const _0x4bea85=_0x5087ae['fromDegrees'](this['_viewPosition'][0x0],this['_viewPosition'][0x1],this['_viewPosition'][0x2]);_0x4ab4fb=_0x32dcc6['project'](_0x4bea85,new _0x3256d0());}const _0x25b7d5=new _0x3256d0();_0x3256d0['subtract'](_0x1fe737,_0x4ab4fb,_0x25b7d5);const _0x538c40=_0x3256d0['magnitude'](_0x25b7d5);_0x3256d0['normalize'](_0x25b7d5,_0x25b7d5),this['distance']=_0x538c40;const _0x54c0cf=_0x4e1e96['heading'],_0x2ad036=_0x4e1e96['pitch'],_0xb1fd0c=_0x4e1e96['roll'],_0xc3a95c=new _0x3256d0();_0x3256d0['clone'](_0x4e1e96['position'],_0xc3a95c);const _0x57c4ad=_0x25b7d5['clone']();let _0x59994c=_0x4ab4fb['clone']();_0x59994c=_0x3256d0['normalize'](_0x59994c,_0x59994c);Math['abs'](_0x3256d0['dot'](_0x59994c,_0x57c4ad))>=0x1&&(Math['abs'](_0x3256d0['dot'](_0x57c4ad,_0x3256d0['UNIT_Y']))<0x1?_0x59994c=_0x3256d0['clone'](_0x3256d0['UNIT_Y'],_0x59994c):_0x59994c=_0x3256d0['clone'](_0x3256d0['UNIT_Z'],_0x59994c));let _0x232376=new _0x3256d0();_0x3256d0['cross'](_0x59994c,_0x57c4ad,_0x232376),_0x232376=_0x3256d0['normalize'](_0x232376,_0x232376),_0x3256d0['cross'](_0x57c4ad,_0x232376,_0x59994c),_0x59994c=_0x3256d0['normalize'](_0x59994c,_0x59994c),_0x4e1e96['setView']({'destination':_0x4ab4fb,'orientation':{'direction':_0x57c4ad,'up':_0x59994c},'convert':![]}),this['direction']=_0x4e1e96['heading']*_0x13b42f['DEGREES_PER_RADIAN'],this['pitch']=_0x4e1e96['pitch']*_0x13b42f['DEGREES_PER_RADIAN'],_0x4e1e96['setView']({'destination':_0xc3a95c,'orientation':{'heading':_0x54c0cf,'pitch':_0x2ad036,'roll':_0xb1fd0c},'convert':![]});},_0x4fb36d['prototype']['setInfo']=function(_0x4c2f6c){if(!_0x573053(_0x4c2f6c))throw new _0x11c1e1('No\x20url\x20provided.');const _0x1855b2=this,_0x5cee11=_0x1e5906['createIfNeeded'](_0x4c2f6c);return _0x5cee11['fetchXML']()['then'](function(_0x1871fa){const _0x5afaba=_0x1871fa['firstChild'],_0x31a356=_0x4e6a50(_0x5afaba);_0x1855b2['direction']=_0x31a356['heading'],_0x1855b2['pitch']=_0x362342(_0x31a356['pitch'],_0x1855b2['pitch']),_0x1855b2['_roll']=_0x362342(_0x31a356['roll'],_0x1855b2['_roll']),_0x1855b2['horizontalFov']=_0x31a356['horizontalFov'],_0x1855b2['verticalFov']=_0x31a356['verticalFov'],_0x3256d0['clone'](_0x31a356['matrixU'],_0x1855b2['_v3AffineX']),_0x3256d0['clone'](_0x31a356['matrixV'],_0x1855b2['_v3AffineY']),_0x1855b2['distance']=_0x31a356['distance'],_0x1855b2['viewPosition']=_0x31a356['viewPosition'],_0x1855b2['_boundingSphereFromXML']=_0x31a356['boundingSphere'];},_0x12d545=>{console['error'](_0x12d545);});};function _0x4e6a50(_0x178eb1){const _0x552e6a=_0xc9c04e['queryStringValue'](_0x178eb1,'VideoName'),_0x9c2250=_0xc9c04e['queryFirstNode'](_0x178eb1,'Fov'),_0x5bd600=_0xc9c04e['queryNumericValue'](_0x9c2250,'Horizontal'),_0x3be638=_0xc9c04e['queryNumericValue'](_0x9c2250,'Vertical'),_0x434c69=_0xc9c04e['queryNumericValue'](_0x178eb1,'Distance'),_0x4b29f3=_0xc9c04e['queryNumericValue'](_0x178eb1,'Heading'),_0x41b805=_0xc9c04e['queryNumericValue'](_0x178eb1,'Pitch'),_0x2fd26b=_0xc9c04e['queryNumericValue'](_0x178eb1,'Roll'),_0x2a5ff8=_0xc9c04e['queryFirstNode'](_0x178eb1,'ViewPosition'),_0x176ba7=[0x0,0x0,0x0];_0x176ba7[0x0]=_0xc9c04e['queryNumericValue'](_0x2a5ff8,'X'),_0x176ba7[0x1]=_0xc9c04e['queryNumericValue'](_0x2a5ff8,'Y'),_0x176ba7[0x2]=_0xc9c04e['queryNumericValue'](_0x2a5ff8,'Z');const _0xe3f649=_0xc9c04e['queryFirstNode'](_0x178eb1,'Matrix'),_0x25070a=_0xc9c04e['queryStringValue'](_0xe3f649,'U'),_0x572648=_0xc9c04e['queryStringValue'](_0xe3f649,'V'),_0x204a6e=_0xc9c04e['queryStringValue'](_0xe3f649,'W'),_0xbbee3a=_0x25070a['split'](','),_0x159432=new _0x3256d0(parseFloat(_0xbbee3a[0x0]),parseFloat(_0xbbee3a[0x1]),parseFloat(_0xbbee3a[0x2])),_0x36e788=_0x572648['split'](','),_0x247696=new _0x3256d0(parseFloat(_0x36e788[0x0]),parseFloat(_0x36e788[0x1]),parseFloat(_0x36e788[0x2])),_0x338abf=_0xc9c04e['queryFirstNode'](_0x178eb1,'Bounds');let _0x1bcd3a;if(_0x338abf){const _0x5a706a=_0x13b42f['toRadians'](_0xc9c04e['queryNumericValue'](_0x338abf,'Left')),_0x3b5e39=_0x13b42f['toRadians'](_0xc9c04e['queryNumericValue'](_0x338abf,'Top')),_0x1d5cee=_0x13b42f['toRadians'](_0xc9c04e['queryNumericValue'](_0x338abf,'Right')),_0x4fccb9=_0x13b42f['toRadians'](_0xc9c04e['queryNumericValue'](_0x338abf,'Bottom')),_0x2fb7c9=new _0x13be09(_0x5a706a,_0x4fccb9,_0x1d5cee,_0x3b5e39);let _0x316a4d=_0x434c69*Math['cos'](_0x13b42f['toRadians'](_0x41b805));_0x316a4d=_0x41b805<0x0?-_0x316a4d:_0x316a4d;const _0x1e91e0=_0x176ba7[0x2]+_0x316a4d;_0x1bcd3a=_0xd905a3['fromRectangle3D'](_0x2fb7c9,undefined,_0x1e91e0);}return{'videoName':_0x552e6a,'viewPosition':_0x176ba7,'heading':_0x4b29f3,'pitch':_0x41b805,'roll':_0x2fd26b,'horizontalFov':_0x5bd600,'verticalFov':_0x3be638,'matrixU':_0x159432,'matrixV':_0x247696,'distance':_0x434c69,'boundingSphere':_0x1bcd3a};}function _0x5f5586(_0x1b5fd8,_0x532dbd){let _0x15a2a1=document['getElementById']('projection-image');!_0x573053(_0x15a2a1)&&(_0x15a2a1=document['createElement']('div'),_0x15a2a1['setAttribute']('id','projection-image'),document['body']['appendChild'](_0x15a2a1));const _0x2d60d2=document['createElement']('video');return _0x2d60d2['style']='visibility:hidden;position:absolute;top:0px;left:0px;',_0x2d60d2['setAttribute']('width','320'),_0x2d60d2['setAttribute']('height','240'),_0x2d60d2['setAttribute']('autoplay','autoplay'),_0x2d60d2['setAttribute']('loop','loop'),_0x2d60d2['setAttribute']('crossorigin','crossorigin'),_0x2d60d2['setAttribute']('src',_0x1b5fd8),_0x2d60d2['setAttribute']('id','projection-image-'+_0x532dbd),_0x15a2a1['appendChild'](_0x2d60d2),_0x2d60d2;}_0x4fb36d['fromInfo']=function(_0x2e49f7,_0x4730b4,_0x5ab288){if(!_0x573053(_0x2e49f7))throw new _0x11c1e1('No\x20scene\x20provided.');if(!_0x573053(_0x4730b4))throw new _0x11c1e1('No\x20url\x20provided.');const _0x8c2b26=_0x1e5906['createIfNeeded'](_0x4730b4);return _0x8c2b26['fetchXML']()['then'](function(_0x559f82){const _0x3f2374={},_0x3cc6c5=_0x559f82['firstChild'];for(let _0x2d76c7=0x0,_0x36e08a=_0x3cc6c5['children']['length'];_0x2d76c7<_0x36e08a;_0x2d76c7++){const _0x464f90=_0x3cc6c5['children'][_0x2d76c7],_0x1149ba=_0x4e6a50(_0x464f90);let _0x2f2444=_0x1149ba['videoName'];_0x573053(_0x5ab288)?_0x2f2444=_0x2a0756(_0x5ab288)+_0x1149ba['videoName']:_0x2f2444=_0x4730b4['slice'](0x0,_0x4730b4['lastIndexOf']('/')+0x1)+_0x1149ba['videoName'];const _0x441507=new _0x4fb36d(_0x2e49f7),_0x423401=_0x5f5586(_0x2f2444,_0x441507['_guid']);_0x441507['viewPosition']=_0x1149ba['viewPosition'],_0x441507['direction']=_0x1149ba['heading'],_0x441507['pitch']=_0x1149ba['pitch'],_0x441507['horizontalFov']=_0x1149ba['horizontalFov'],_0x441507['verticalFov']=_0x1149ba['verticalFov'],_0x3256d0['clone'](_0x1149ba['matrixU'],_0x441507['_v3AffineX']),_0x3256d0['clone'](_0x1149ba['matrixV'],_0x441507['_v3AffineY']),_0x441507['distance']=_0x1149ba['distance'],_0x441507['setImage']({'video':_0x423401}),_0x441507['_boundingSphere']=XML=_0x1149ba['boundingSphere'],_0x423401['addEventListener']('loadeddata',function(_0x440e23){_0x440e23['build']();}['bind'](_0x423401,_0x441507)),_0x3f2374[_0x1149ba['videoName']]=_0x441507;}return _0x3f2374;},_0x5178fb=>{console['error'](_0x5178fb);});},_0x4fb36d['prototype']['build']=function(){if(this['isBuild'])return;this['isBuild']=!![],this['scene']['primitives']['add'](this),this['removeListenerFunc']=this['scene']['preUpdate']['addEventListener'](_0x133d1b=>{_0x573053(this['_cameraDepthBuffer'])&&this['_cameraDepthBuffer']['renderToTexture'](_0x133d1b);},this);},_0x4fb36d['prototype']['clear']=function(){if(!this['isBuild'])return;this['isBuild']=![],this['removeListenerFunc'](),this['scene']['primitives']['remove'](this);},_0x4fb36d['prototype']['destroy']=function(){const _0x16b1df=document['getElementById']('projection-image-'+this['_guid']);if(_0x16b1df){const _0x20cd79=_0x16b1df['parentNode'];_0x20cd79['removeChild'](_0x16b1df),_0x20cd79['children']['length']===0x0&&_0x20cd79['parentNode']['removeChild'](_0x20cd79);}return this['_cameraDepthBuffer']=this['_cameraDepthBuffer']&&this['_cameraDepthBuffer']['destroy'](),_0x52f349(this),this['_texture']=this['_texture']&&!this['_texture']['isDestroyed']()&&this['_texture']['destroy'](),this['scene']['primitives']['remove'](this),_0x4c4454(this);};export default _0x4fb36d;