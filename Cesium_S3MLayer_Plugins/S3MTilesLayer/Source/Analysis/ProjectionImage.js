const _0x51641a=(function(){let _0x371ecc=!![];return function(_0x5c8947,_0x2756f4){const _0xc28c43=_0x371ecc?function(){if(_0x2756f4){const _0x75664c=_0x2756f4['apply'](_0x5c8947,arguments);return _0x2756f4=null,_0x75664c;}}:function(){};return _0x371ecc=![],_0xc28c43;};}()),_0x252f5=_0x51641a(this,function(){return _0x252f5['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x252f5)['search']('(((.+)+)+)+$');});_0x252f5();import _0x23330d from'./DepthFramebuffer.js';import _0x516654 from'./Shaders/NoLightNoTextureVS.js';import _0x22dccc from'./Shaders/NoLightNoTextureFS.js';import _0x208f1c from'./Shaders/ViewShedAnalysisVS.js';import _0x1c2156 from'./Shaders/ProjectionImageFS.js';import _0x1db32f from'./XMLParser.js';const _0x14a5e6=Cesium['BoundingSphere'],_0xcef6b5=Cesium['Cartesian2'],_0x2da033=Cesium['Cartesian3'],_0x5e85b2=Cesium['Cartesian4'],_0x479f8b=Cesium['Color'],_0x58a872=Cesium['ComponentDatatype'],_0x5bbaa2=Cesium['defined'],_0x5a1e0a=Cesium['defaultValue'],_0x2c99a9=Cesium['destroyObject'],_0x175b04=Cesium['DeveloperError'],_0x11f538=Cesium['IndexDatatype'],_0x4fdddb=Cesium['Math'],_0x60bd0b=Cesium['Matrix4'],_0x2daea9=Cesium['PrimitiveType'],_0x2f773c=Cesium['Check'],_0x3cf04c=Cesium['appendForwardSlash'],_0x5a5cae=Cesium['Rectangle'],_0x43629c=Cesium['Intersect'],_0x5b1872=Cesium['Cartographic'],_0x4cc7d2=Cesium['Pass'],_0x4fe357=Cesium['Buffer'],_0x128ec3=Cesium['BufferUsage'],_0x494354=Cesium['DrawCommand'],_0x103658=Cesium['RenderState'],_0x22b797=Cesium['Texture'],_0x21b168=Cesium['ShaderProgram'],_0x240c09=Cesium['VertexArray'],_0x5ddb8d=Cesium['ShaderSource'],_0x551860=Cesium['BlendingState'],_0x4ca158=Cesium['SceneMode'],_0x1ccf4f=Cesium['StencilOperation'],_0x4ee866=Cesium['StencilFunction'],_0x26a9f7=Cesium['DepthFunction'],_0x7f9cdf=Cesium['Resource'];function _0x563a2e(_0x42a79d){if(!_0x5bbaa2(_0x42a79d))throw new _0x175b04('scene\x20are\x20required.');if(!_0x42a79d['context']['depthTexture'])throw new _0x175b04('the\x20depth\x20buffer\x20is\x20not\x20supported.');this['scene']=_0x42a79d,this['_cameraDepthBuffer']=undefined,this['_lineCommand']=undefined,this['_stencilCommand']=undefined,this['_colorCommand']=undefined,this['_boundingSphere']=new _0x14a5e6(),this['_viewPosition']=[0x0,0x0,0x0],this['_direction']=0x0,this['_pitch']=0x0,this['_roll']=0x0,this['_horizontalFov']=0x5a,this['_verticalFov']=0x3c,this['_distance']=0xc8,this['_hintLineColor']=new _0x479f8b(0x1,0x1,0x1,0x1),this['_hintLineVisible']=!![],this['_texture']=undefined,this['_segmentCount']=0x14,this['_invertViewMatrix']=new _0x60bd0b(),this['_viewProjMatrix']=new _0x60bd0b(),this['_renderTextureMatrix']=new _0x60bd0b(),this['_update']=!![],this['_video']=undefined,this['_brightness']=0x1,this['_contrast']=0x1,this['_hue']=0x0,this['_saturation']=0x1,this['_gamma']=0x1,this['_featheringScale']=0x0,this['_v3AffineX']=new _0x2da033(0x1,0x0,0x0),this['_v3AffineY']=new _0x2da033(0x0,0x1,0x0),this['_visible']=!![],this['_visibleDistanceMax']=0x1f4,this['isBuild']=![];}Object['defineProperties'](_0x563a2e['prototype'],{'viewPosition':{'get':function(){return this['_viewPosition'];},'set':function(_0xeff078){this['_viewPosition']=_0xeff078,this['_update']=!![];}},'direction':{'get':function(){return this['_direction'];},'set':function(_0x41d031){this['_direction']=_0x41d031,this['_update']=!![];}},'pitch':{'get':function(){return this['_pitch'];},'set':function(_0x5ae1bc){this['_pitch']=_0x5ae1bc,this['_update']=!![];}},'roll':{'get':function(){return this['_roll'];},'set':function(_0x31abf0){this['_roll']=_0x31abf0,this['_update']=!![];}},'horizontalFov':{'get':function(){return this['_horizontalFov'];},'set':function(_0x529a5c){this['_horizontalFov']=_0x529a5c,this['_update']=!![];}},'verticalFov':{'get':function(){return this['_verticalFov'];},'set':function(_0x5b742a){this['_verticalFov']=_0x5b742a,this['_update']=!![];}},'distance':{'get':function(){return this['_distance'];},'set':function(_0x294163){if(_0x294163<=0x0)throw new _0x175b04('the\x20distance\x20is\x20greater\x20than\x200.0');this['_distance']=_0x294163,this['_update']=!![];}},'featheringScale':{'get':function(){return this['_featheringScale'];},'set':function(_0x4c1bb7){if(_0x4c1bb7<0x0||_0x4c1bb7>0x1)throw new _0x175b04('the\x20distance\x20is\x20greater\x20than\x200.0\x20an\x20less\x20than\x201.0');this['_featheringScale']=_0x4c1bb7;}},'hintLineColor':{'get':function(){return this['_hintLineColor'];},'set':function(_0x2841b6){if(!_0x5bbaa2(_0x2841b6))return;this['_hintLineColor']=_0x479f8b['clone'](_0x2841b6,this['_hintLineColor']);}},'hintLineVisible':{'get':function(){return this['_hintLineVisible'];},'set':function(_0x221cf7){this['_hintLineVisible']=_0x221cf7;}},'brightness':{'get':function(){return this['_brightness'];},'set':function(_0x2e9bad){_0x2f773c['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.brightness',_0x2e9bad,0x0),this['_brightness']=_0x2e9bad;}},'contrast':{'get':function(){return this['_contrast'];},'set':function(_0x4c884c){_0x2f773c['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.contrast',_0x4c884c,0x0),this['_contrast']=_0x4c884c;}},'hue':{'get':function(){return this['_hue'];},'set':function(_0x246b0b){_0x2f773c['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.hue',_0x246b0b,0x0),this['_hue']=_0x246b0b;}},'saturation':{'get':function(){return this['_saturation'];},'set':function(_0x1f8110){_0x2f773c['typeOf']['number']['greaterThanOrEquals']('ProjectionImage.saturation',_0x1f8110,0x0),this['_saturation']=_0x1f8110;}},'gamma':{'get':function(){return this['_gamma'];},'set':function(_0x3e48a1){_0x2f773c['typeOf']['number']['greaterThan']('ProjectionImage.gamma',_0x3e48a1,0x0),this['_gamma']=_0x3e48a1;}},'visible':{'get':function(){return this['_visible'];},'set':function(_0x401d26){_0x2f773c['typeOf']['bool']('ProjectionImage.visible',_0x401d26),this['_visible']=_0x401d26;}},'visibleDistanceMax':{'get':function(){return this['_visibleDistanceMax'];},'set':function(_0x41dc46){_0x2f773c['typeOf']['number']('ProjectionImage.visibleDistance',_0x41dc46),this['_visibleDistanceMax']=_0x41dc46;}}});function _0x19dc2d(_0x367fd7){_0x5bbaa2(_0x367fd7['_stencilCommand'])&&(_0x367fd7['_stencilCommand']['vertexArray']=_0x367fd7['_stencilCommand']['vertexArray']&&_0x367fd7['_stencilCommand']['vertexArray']['destroy'](),_0x367fd7['_stencilCommand']['shaderProgram']=_0x367fd7['_stencilCommand']['shaderProgram']&&_0x367fd7['_stencilCommand']['shaderProgram']['destroy'](),_0x367fd7['_stencilCommand']=undefined),_0x5bbaa2(_0x367fd7['_colorCommand'])&&(_0x367fd7['_colorCommand']['vertexArray']=_0x367fd7['_colorCommand']['vertexArray']&&_0x367fd7['_colorCommand']['vertexArray']['destroy'](),_0x367fd7['_colorCommand']['shaderProgram']=_0x367fd7['_colorCommand']['shaderProgram']&&_0x367fd7['_colorCommand']['shaderProgram']['destroy'](),_0x367fd7['_colorCommand']=undefined),_0x5bbaa2(_0x367fd7['_lineCommand'])&&(_0x367fd7['_lineCommand']['vertexArray']=_0x367fd7['_lineCommand']['vertexArray']&&_0x367fd7['_lineCommand']['vertexArray']['destroy'](),_0x367fd7['_lineCommand']['shaderProgram']=_0x367fd7['_lineCommand']['shaderProgram']&&_0x367fd7['_lineCommand']['shaderProgram']['destroy'](),_0x367fd7['_lineCommand']=undefined);}function _0x586456(_0x1843f2,_0x264c1b,_0x3b72b2){const _0x262d69=_0x1843f2['_horizontalFov']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x1793a8=_0x1843f2['_verticalFov']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x29fcbe=Math['tan'](_0x262d69*0.5),_0x5efbbf=Math['tan'](_0x1793a8*0.5),_0x11c4a6=_0x29fcbe/_0x5efbbf,_0x55a378=_0x1843f2['_distance']*0.001,_0x273afe=Math['max'](_0x1843f2['_distance'],0xa),_0xc67a3d=_0x1843f2['_direction']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x4b3df2=_0x1843f2['_pitch']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x1e0932=_0x1843f2['_roll']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x459257=_0x2da033['fromDegreesArrayHeights'](_0x1843f2['_viewPosition'])[0x0],_0x356c3d=_0x3b72b2['camera'],_0x12a283=_0x356c3d['frustum']['aspectRatio'],_0x44c735=_0x356c3d['frustum']['fov'],_0x265240=_0x356c3d['frustum']['near'],_0x6f58a7=_0x356c3d['frustum']['far'],_0x3a93f1=new _0x2da033(),_0x2f6b28=_0x356c3d['heading'],_0x2cd868=_0x356c3d['pitch'],_0x1d7ab0=_0x356c3d['roll'];_0x2da033['clone'](_0x356c3d['position'],_0x3a93f1),_0x1843f2['_cameraDepthBuffer']['isUpdate']=!![];const _0x39fd3b=_0x3b72b2['useLogDepth'];_0x1843f2['_cameraDepthBuffer']['beginFunc']=function(){_0x3b72b2['useLogDepth']=![],_0x2da033['clone'](_0x356c3d['position'],_0x3a93f1),_0x356c3d['frustum']['aspectRatio']=_0x11c4a6,_0x356c3d['frustum']['fov']=_0x11c4a6>=0x1?_0x262d69:_0x1793a8,_0x356c3d['frustum']['near']=0x1,_0x356c3d['frustum']['far']=_0x273afe,_0x39fd3b&&(_0x356c3d['frustum']['near']=0.1,_0x356c3d['frustum']['far']=0x5f5e100),_0x356c3d['setView']({'destination':_0x459257,'orientation':{'heading':_0xc67a3d,'pitch':_0x4b3df2,'roll':_0x1e0932}}),_0x60bd0b['multiply'](_0x356c3d['frustum']['projectionMatrix'],_0x356c3d['viewMatrix'],_0x1843f2['_viewProjMatrix']),_0x60bd0b['clone'](_0x356c3d['inverseViewMatrix'],_0x1843f2['_invertViewMatrix']),_0x2da033['clone'](_0x2da033['ZERO'],_0x1843f2['_boundingSphere']['center']),_0x1843f2['_boundingSphere']['radius']=_0x1843f2['_distance'],_0x14a5e6['transform'](_0x1843f2['_boundingSphere'],_0x1843f2['_invertViewMatrix'],_0x1843f2['_boundingSphere']);},_0x1843f2['_cameraDepthBuffer']['endFunc']=function(){_0x356c3d['setView']({'destination':_0x3a93f1,'orientation':{'heading':_0x2f6b28,'pitch':_0x2cd868,'roll':_0x1d7ab0},'convert':![]}),_0x356c3d['frustum']['aspectRatio']=_0x12a283,_0x356c3d['frustum']['fov']=_0x44c735,_0x356c3d['frustum']['near']=_0x265240,_0x356c3d['frustum']['far']=_0x6f58a7,_0x3b72b2['useLogDepth']=_0x39fd3b,_0x1843f2['_cameraDepthBuffer']['isUpdate']=![];};}function _0xbe78b7(_0xa09141,_0x16132b,_0x126514){const _0x4cbd71=(_0xa09141['_segmentCount']+0x1)*(_0xa09141['_segmentCount']+0x1)+0x1,_0x362113=_0x58a872['createTypedArray'](_0x58a872['FLOAT'],_0x4cbd71*0x3);let _0x2ed7a5=0x3;const _0x3f6787=_0xa09141['_horizontalFov']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x13b6a7=_0xa09141['_verticalFov']*_0x4fdddb['RADIANS_PER_DEGREE'],_0x50e378=Math['tan'](_0x3f6787*0.5),_0x47c912=Math['tan'](_0x13b6a7*0.5),_0x3864ec=_0xa09141['_distance']*_0x50e378,_0x4bac99=_0xa09141['_distance']*_0x47c912,_0x460ee7=Math['PI']-_0x3f6787*0.5;let _0x22e85e=0x0,_0x364f33=0x0,_0x29a0c9=_0x3f6787/_0xa09141['_segmentCount'];for(let _0x18f807=0x0;_0x18f807<_0xa09141['_segmentCount']+0x1;_0x18f807++){_0x22e85e=_0x460ee7+_0x18f807*_0x29a0c9;const _0x58e733=_0x4bac99/(_0xa09141['_distance']/Math['cos'](_0x22e85e)),_0x5a0fbd=Math['atan'](_0x58e733),_0x3bfd0d=-_0x5a0fbd,_0x11349c=_0x5a0fbd*0x2/_0xa09141['_segmentCount'];for(let _0x523275=0x0;_0x523275<_0xa09141['_segmentCount']+0x1;_0x523275++){_0x364f33=_0x3bfd0d+_0x523275*_0x11349c,_0x362113[_0x2ed7a5++]=_0xa09141['_distance']*Math['cos'](_0x364f33)*Math['sin'](_0x22e85e),_0x362113[_0x2ed7a5++]=_0xa09141['_distance']*Math['sin'](_0x364f33),_0x362113[_0x2ed7a5++]=_0xa09141['_distance']*Math['cos'](_0x364f33)*Math['cos'](_0x22e85e);}}const _0x27b1e5=(0x4+_0xa09141['_segmentCount']*0x5+_0xa09141['_segmentCount']*0x2*0x3)*0x2,_0x45e67e=_0xa09141['_segmentCount']*_0xa09141['_segmentCount']*0x3*0x2+_0xa09141['_segmentCount']*0x3*0x4,_0x3bed8a=_0x58a872['createTypedArray'](_0x58a872['UNSIGNED_SHORT'],_0x27b1e5),_0x25bc53=_0x58a872['createTypedArray'](_0x58a872['UNSIGNED_SHORT'],_0x45e67e);let _0xa7c334=0x0;const _0x5691d4=0x1;for(let _0x59de71=0x0;_0x59de71<_0xa09141['_segmentCount'];_0x59de71++){for(let _0x2ab089=0x0;_0x2ab089<_0xa09141['_segmentCount'];_0x2ab089++){_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+_0x2ab089*(_0xa09141['_segmentCount']+0x1),_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+0x1+_0x2ab089*(_0xa09141['_segmentCount']+0x1),_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+(_0x2ab089+0x1)*(_0xa09141['_segmentCount']+0x1),_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+0x1+_0x2ab089*(_0xa09141['_segmentCount']+0x1),_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+0x1+(_0x2ab089+0x1)*(_0xa09141['_segmentCount']+0x1),_0x25bc53[_0xa7c334++]=_0x5691d4+_0x59de71+(_0x2ab089+0x1)*(_0xa09141['_segmentCount']+0x1);}}for(let _0x3e146c=0x0;_0x3e146c<_0xa09141['_segmentCount'];_0x3e146c++){_0x25bc53[_0xa7c334++]=_0x3e146c+0x1+_0x5691d4,_0x25bc53[_0xa7c334++]=_0x3e146c+_0x5691d4,_0x25bc53[_0xa7c334++]=0x0,_0x25bc53[_0xa7c334++]=0x0,_0x25bc53[_0xa7c334++]=_0x3e146c+_0xa09141['_segmentCount']*(_0xa09141['_segmentCount']+0x1)+_0x5691d4,_0x25bc53[_0xa7c334++]=_0x3e146c+0x1+_0xa09141['_segmentCount']*(_0xa09141['_segmentCount']+0x1)+_0x5691d4;}for(let _0x3f9c6c=0x0;_0x3f9c6c<_0xa09141['_segmentCount'];_0x3f9c6c++){_0x25bc53[_0xa7c334++]=0x0,_0x25bc53[_0xa7c334++]=_0x3f9c6c*(_0xa09141['_segmentCount']+0x1)+_0x5691d4,_0x25bc53[_0xa7c334++]=(_0x3f9c6c+0x1)*(_0xa09141['_segmentCount']+0x1)+_0x5691d4,_0x25bc53[_0xa7c334++]=_0xa09141['_segmentCount']+(_0x3f9c6c+0x1)*(_0xa09141['_segmentCount']+0x1)+_0x5691d4,_0x25bc53[_0xa7c334++]=_0xa09141['_segmentCount']+_0x3f9c6c*(_0xa09141['_segmentCount']+0x1)+_0x5691d4,_0x25bc53[_0xa7c334++]=0x0;}_0xa7c334=0x0,_0x3bed8a[_0xa7c334++]=0x0,_0x3bed8a[_0xa7c334++]=0x1,_0x3bed8a[_0xa7c334++]=0x0,_0x3bed8a[_0xa7c334++]=_0xa09141['_segmentCount']+0x1,_0x3bed8a[_0xa7c334++]=0x0,_0x3bed8a[_0xa7c334++]=_0xa09141['_segmentCount']*(_0xa09141['_segmentCount']+0x1)+0x1,_0x3bed8a[_0xa7c334++]=0x0,_0x3bed8a[_0xa7c334++]=(_0xa09141['_segmentCount']+0x1)*(_0xa09141['_segmentCount']+0x1);for(let _0x54b97e=0x0;_0x54b97e<0x5;_0x54b97e++){for(let _0x32ad63=0x0;_0x32ad63<_0xa09141['_segmentCount'];_0x32ad63++){_0x3bed8a[_0xa7c334++]=0x1+_0x32ad63+(_0xa09141['_segmentCount']+0x1)*0x5*_0x54b97e,_0x3bed8a[_0xa7c334++]=0x1+(_0x32ad63+0x1)+(_0xa09141['_segmentCount']+0x1)*0x5*_0x54b97e;}}for(let _0x395f00=0x0;_0x395f00<0x5;_0x395f00++){for(let _0x430cc9=0x0;_0x430cc9<_0xa09141['_segmentCount'];_0x430cc9++){_0x3bed8a[_0xa7c334++]=0x1+(_0xa09141['_segmentCount']+0x1)*_0x430cc9+_0x395f00*0x5,_0x3bed8a[_0xa7c334++]=0x1+(_0xa09141['_segmentCount']+0x1)*(_0x430cc9+0x1)+_0x395f00*0x5;}}const _0x125cfc=_0x4fe357['createVertexBuffer']({'context':_0x16132b,'typedArray':_0x362113,'usage':_0x128ec3['STATIC_DRAW']}),_0x307e33=[],_0x2a4768={};_0x2a4768['aPosition']=0x0,_0x307e33['push']({'index':_0x2a4768['aPosition'],'vertexBuffer':_0x125cfc,'componentsPerAttribute':0x3,'componentDatatype':_0x58a872['FLOAT'],'offsetInBytes':0x0,'strideInBytes':0x3*0x4,'normalize':![]});const _0x593e34=_0x4fe357['createIndexBuffer']({'context':_0x16132b,'typedArray':_0x3bed8a,'usage':_0x128ec3['STATIC_DRAW'],'indexDatatype':_0x11f538['UNSIGNED_SHORT']}),_0x1ed29a=_0x4fe357['createIndexBuffer']({'context':_0x16132b,'typedArray':_0x25bc53,'usage':_0x128ec3['STATIC_DRAW'],'indexDatatype':_0x11f538['UNSIGNED_SHORT']});_0xa09141['_lineCommand']=new _0x494354({'primitiveType':_0x2daea9['LINES'],'modelMatrix':_0xa09141['_invertViewMatrix'],'boundingVolume':_0xa09141['_boundingSphere'],'pass':_0x4cc7d2['OPAQUE'],'owner':_0xa09141,'cull':!![]}),_0xa09141['_lineCommand']['vertexArray']=new _0x240c09({'context':_0x16132b,'attributes':_0x307e33,'indexBuffer':_0x593e34}),_0xa09141['_lineCommand']['shaderProgram']=_0x21b168['fromCache']({'context':_0x16132b,'vertexShaderSource':_0x516654,'fragmentShaderSource':_0x22dccc,'attributeLocations':_0x2a4768}),_0xa09141['_lineCommand']['renderState']=_0x103658['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![]}});const _0x231e01=[];for(let _0x3004ef=0x0;_0x3004ef<0x6;_0x3004ef++){_0x231e01[_0x3004ef]=new _0x5e85b2(0x0,0x0,0x0,0x0);}_0xa09141['_lineCommand']['uniformMap']={'uDiffuseColor':function(){return _0xa09141['_hintLineColor'];},'clip_mode':function(){return 0x0;},'clip_planes':function(){return _0x231e01;},'clip_line_color':function(){return _0x5e85b2['UNIT_W'];}},_0xa09141['_stencilCommand']=new _0x494354({'primitiveType':_0x2daea9['TRIANGLES'],'modelMatrix':_0xa09141['_invertViewMatrix'],'boundingVolume':_0xa09141['_boundingSphere'],'pass':_0x4cc7d2['OPAQUE'],'owner':_0xa09141,'cull':!![]}),_0xa09141['_stencilCommand']['vertexArray']=new _0x240c09({'context':_0x16132b,'attributes':_0x307e33,'indexBuffer':_0x1ed29a}),_0xa09141['_stencilCommand']['shaderProgram']=_0x21b168['fromCache']({'context':_0x16132b,'vertexShaderSource':_0x516654,'fragmentShaderSource':_0x22dccc,'attributeLocations':_0x2a4768});let _0x565579={'enabled':!![],'frontFunction':_0x4ee866['ALWAYS'],'frontOperation':{'fail':_0x1ccf4f['KEEP'],'zFail':_0x1ccf4f['KEEP'],'zPass':_0x1ccf4f['INCREMENT_WRAP']},'backFunction':_0x4ee866['ALWAYS'],'backOperation':{'fail':_0x1ccf4f['KEEP'],'zFail':_0x1ccf4f['KEEP'],'zPass':_0x1ccf4f['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0};_0xa09141['_stencilCommand']['renderState']=_0x103658['fromCache']({'depthMask':![],'colorMask':{'red':![],'green':![],'blue':![],'alpha':![]},'depthTest':{'enabled':!![],'func':_0x26a9f7['GREATER']},'stencilTest':_0x565579,'stencilMask':0x1}),_0xa09141['_stencilCommand']['uniformMap']={'uColor':function(){return _0x479f8b['WHITE'];}},_0xa09141['_colorCommand']=new _0x494354({'primitiveType':_0x2daea9['TRIANGLES'],'modelMatrix':_0xa09141['_invertViewMatrix'],'boundingVolume':_0xa09141['_boundingSphere'],'pass':_0x4cc7d2['OPAQUE'],'owner':_0xa09141,'cull':!![]}),_0xa09141['_colorCommand']['vertexArray']=new _0x240c09({'context':_0x16132b,'attributes':_0x307e33,'indexBuffer':_0x1ed29a});const _0x12d091=new _0x5ddb8d({'name':'ViewShedAnalysisVS','sources':[_0x208f1c]});_0xa09141['_colorCommand']['shaderProgram']=_0x21b168['fromCache']({'context':_0x16132b,'vertexShaderSource':_0x12d091,'fragmentShaderSource':_0x1c2156,'attributeLocations':_0x2a4768}),_0x565579={'enabled':!![],'frontFunction':_0x4ee866['NOT_EQUAL'],'frontOperation':{'fail':_0x1ccf4f['KEEP'],'zFail':_0x1ccf4f['KEEP'],'zPass':_0x1ccf4f['DECREMENT_WRAP']},'backFunction':_0x4ee866['NOT_EQUAL'],'backOperation':{'fail':_0x1ccf4f['KEEP'],'zFail':_0x1ccf4f['KEEP'],'zPass':_0x1ccf4f['DECREMENT_WRAP']},'reference':0x0,'mask':~0x0},_0xa09141['_colorCommand']['renderState']=_0x103658['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':![]},'depthMask':![],'stencilTest':_0x565579,'blending':_0x551860['ALPHA_BLEND']}),_0xa09141['_colorCommand']['uniformMap']={'uRenderTextureMatrix':function(){return _0xa09141['_renderTextureMatrix'];},'uTexture1_size':function(){const _0x2338f0=_0xa09141['_cameraDepthBuffer']['depthTexture'],_0x3d8c7b=new _0xcef6b5(_0x2338f0['width'],_0x2338f0['height']);return _0x3d8c7b;},'uTexture1':function(){return _0xa09141['_cameraDepthBuffer']['depthTexture'];},'uDiffuseTexture':function(){return _0xa09141['_texture'];},'uBrightness':function(){return _0xa09141['_brightness'];},'uContrast':function(){return _0xa09141['_contrast'];},'uHue':function(){return _0xa09141['_hue'];},'uSaturation':function(){return _0xa09141['_saturation'];},'uOneOverGamma':function(){return 0x1/_0xa09141['_gamma'];},'uFeatheringScale':function(){return _0xa09141['_featheringScale'];},'uV3AffineX':function(){return _0xa09141['_v3AffineX'];},'uV3AffineY':function(){return _0xa09141['_v3AffineY'];}};}function _0x496986(_0xebd171,_0x1d2307,_0x3cfba5){if(_0x2da033['distance'](_0xebd171['positionWC'],_0x1d2307['center'])>_0x3cfba5)return!![];const _0x21a09c=_0xebd171['frustum']['computeCullingVolume'](_0xebd171['positionWC'],_0xebd171['directionWC'],_0xebd171['upWC']),_0x56c34b=_0x21a09c['computeVisibility'](_0x1d2307);return _0x56c34b===_0x43629c['OUTSIDE'];}_0x563a2e['prototype']['update']=function(_0x45f12a){const _0x7a2e66=_0x45f12a['context'],_0x5a1520=_0x45f12a['commandList'],_0x5d8721=_0x45f12a['camera'];if(_0x45f12a['fbo']||!this['_visible']||_0x5d8721['bReflect'])return;if(_0x5bbaa2(this['_boundingSphereFromXML'])){if(_0x496986(_0x5d8721,this['_boundingSphereFromXML'],this['_visibleDistanceMax']))return;}if(this['_boundingSphere']['radius']!==0x0&&!this['_update']){if(_0x496986(_0x5d8721,this['_boundingSphere'],this['_visibleDistanceMax']))return;}_0x60bd0b['multiply'](this['_viewProjMatrix'],_0x5d8721['inverseViewMatrix'],this['_renderTextureMatrix']);_0x5bbaa2(this['_video'])&&(this['_video']['readyState']>=0x2&&(!_0x5bbaa2(this['_texture'])?this['_texture']=new _0x22b797({'context':_0x7a2e66,'source':this['_video']}):this['_texture']['copyFrom'](this['_video'])));if(!_0x5bbaa2(this['_texture']))return;const _0xc76b78=this['scene'];this['_update']&&(!_0x5bbaa2(this['_cameraDepthBuffer'])&&(this['_cameraDepthBuffer']=new _0x23330d(_0x7a2e66)),this['_update']=![],_0x19dc2d(this),_0x586456(this,_0x7a2e66,_0x45f12a),_0xbe78b7(this,_0x7a2e66,_0x45f12a));if(_0x5bbaa2(this['_cameraDepthBuffer']['depthTexture'])){_0x5bbaa2(this['_stencilCommand'])&&_0x5a1520['push'](this['_stencilCommand']);_0x5bbaa2(this['_colorCommand'])&&_0x5a1520['push'](this['_colorCommand']);if(_0x5bbaa2(this['_lineCommand'])&&this['_hintLineVisible']){}}},_0x563a2e['prototype']['setImage']=function(_0x5def05){if(!_0x5bbaa2(_0x5def05))throw new _0x175b04('options\x20is\x20required.');if(!_0x5bbaa2(_0x5def05['url'])&&!_0x5bbaa2(_0x5def05['video'])&&!_0x5bbaa2(_0x5def05['image']))throw new _0x175b04('options.url\x20or\x20options.video\x20or\x20options.image\x20are\x20required.');if(_0x5bbaa2(_0x5def05['url'])){const _0x19deba=_0x7f9cdf['createIfNeeded'](_0x5def05['url']),_0x3be164=this;_0x19deba['fetchImage']()['then'](_0x10631b=>{_0x5bbaa2(_0x3be164['_texture'])&&_0x3be164['_texture']['destroy'](),_0x3be164['_texture']=new _0x22b797({'context':_0x3be164['scene']['_context'],'source':_0x10631b});});}else _0x5bbaa2(_0x5def05['image'])?!_0x5bbaa2(this['_texture'])?this['_texture']=new _0x22b797({'context':this['scene']['_context'],'source':_0x5def05['image']}):this['_texture']['copyFrom'](_0x5def05['image']):this['_video']=_0x5def05['video'];},_0x563a2e['prototype']['setDistDirByPoint']=function(_0x330526){if(_0x330526[0x0]===this['_viewPosition'][0x0]&&_0x330526[0x1]===this['_viewPosition'][0x1]&&_0x330526[0x2]===this['_viewPosition'][0x2])throw new _0x175b04('the\x20position\x20is\x20[longitude,\x20latitude\x20,height]\x20and\x20is\x20not\x20equals\x20viewPosition');const _0x50fb3a=this['scene']['camera'],_0x38d634=_0x50fb3a['_projection'];let _0x1af52b,_0x4db626;if(this['scene']['mode']===_0x4ca158['SCENE3D'])_0x1af52b=_0x2da033['fromDegreesArrayHeights'](_0x330526)[0x0],_0x4db626=_0x2da033['fromDegreesArrayHeights'](this['_viewPosition'])[0x0];else{const _0x1ceed7=_0x5b1872['fromDegrees'](_0x330526[0x0],_0x330526[0x1],_0x330526[0x2]);_0x1af52b=_0x38d634['project'](_0x1ceed7,new _0x2da033());const _0x2e0596=_0x5b1872['fromDegrees'](this['_viewPosition'][0x0],this['_viewPosition'][0x1],this['_viewPosition'][0x2]);_0x4db626=_0x38d634['project'](_0x2e0596,new _0x2da033());}const _0x2ad8a8=new _0x2da033();_0x2da033['subtract'](_0x1af52b,_0x4db626,_0x2ad8a8);const _0x3b6703=_0x2da033['magnitude'](_0x2ad8a8);_0x2da033['normalize'](_0x2ad8a8,_0x2ad8a8),this['distance']=_0x3b6703;const _0x250d9d=_0x50fb3a['heading'],_0x4437ab=_0x50fb3a['pitch'],_0x1b6d3a=_0x50fb3a['roll'],_0x1a57b4=new _0x2da033();_0x2da033['clone'](_0x50fb3a['position'],_0x1a57b4);const _0x2f5ea0=_0x2ad8a8['clone']();let _0x2fd5b7=_0x4db626['clone']();_0x2fd5b7=_0x2da033['normalize'](_0x2fd5b7,_0x2fd5b7);Math['abs'](_0x2da033['dot'](_0x2fd5b7,_0x2f5ea0))>=0x1&&(Math['abs'](_0x2da033['dot'](_0x2f5ea0,_0x2da033['UNIT_Y']))<0x1?_0x2fd5b7=_0x2da033['clone'](_0x2da033['UNIT_Y'],_0x2fd5b7):_0x2fd5b7=_0x2da033['clone'](_0x2da033['UNIT_Z'],_0x2fd5b7));let _0x10a692=new _0x2da033();_0x2da033['cross'](_0x2fd5b7,_0x2f5ea0,_0x10a692),_0x10a692=_0x2da033['normalize'](_0x10a692,_0x10a692),_0x2da033['cross'](_0x2f5ea0,_0x10a692,_0x2fd5b7),_0x2fd5b7=_0x2da033['normalize'](_0x2fd5b7,_0x2fd5b7),_0x50fb3a['setView']({'destination':_0x4db626,'orientation':{'direction':_0x2f5ea0,'up':_0x2fd5b7},'convert':![]}),this['direction']=_0x50fb3a['heading']*_0x4fdddb['DEGREES_PER_RADIAN'],this['pitch']=_0x50fb3a['pitch']*_0x4fdddb['DEGREES_PER_RADIAN'],_0x50fb3a['setView']({'destination':_0x1a57b4,'orientation':{'heading':_0x250d9d,'pitch':_0x4437ab,'roll':_0x1b6d3a},'convert':![]});},_0x563a2e['prototype']['setInfo']=function(_0x116843){if(!_0x5bbaa2(_0x116843))throw new _0x175b04('No\x20url\x20provided.');const _0x292d38=this,_0x50cb76=_0x7f9cdf['createIfNeeded'](_0x116843);return _0x50cb76['fetchXML']()['then'](function(_0x5b6642){const _0x39077a=_0x5b6642['firstChild'],_0x93fa58=_0x59579a(_0x39077a);_0x292d38['direction']=_0x93fa58['heading'],_0x292d38['pitch']=_0x5a1e0a(_0x93fa58['pitch'],_0x292d38['pitch']),_0x292d38['_roll']=_0x5a1e0a(_0x93fa58['roll'],_0x292d38['_roll']),_0x292d38['horizontalFov']=_0x93fa58['horizontalFov'],_0x292d38['verticalFov']=_0x93fa58['verticalFov'],_0x2da033['clone'](_0x93fa58['matrixU'],_0x292d38['_v3AffineX']),_0x2da033['clone'](_0x93fa58['matrixV'],_0x292d38['_v3AffineY']),_0x292d38['distance']=_0x93fa58['distance'],_0x292d38['viewPosition']=_0x93fa58['viewPosition'],_0x292d38['_boundingSphereFromXML']=_0x93fa58['boundingSphere'];},_0x447710=>{console['error'](_0x447710);});};function _0x59579a(_0x3d34ef){const _0x29f532=_0x1db32f['queryStringValue'](_0x3d34ef,'VideoName'),_0xcdec4d=_0x1db32f['queryFirstNode'](_0x3d34ef,'Fov'),_0x1a06ee=_0x1db32f['queryNumericValue'](_0xcdec4d,'Horizontal'),_0x3e14d4=_0x1db32f['queryNumericValue'](_0xcdec4d,'Vertical'),_0x47f563=_0x1db32f['queryNumericValue'](_0x3d34ef,'Distance'),_0x71f1ae=_0x1db32f['queryNumericValue'](_0x3d34ef,'Heading'),_0x302a72=_0x1db32f['queryNumericValue'](_0x3d34ef,'Pitch'),_0x55087a=_0x1db32f['queryNumericValue'](_0x3d34ef,'Roll'),_0xf705be=_0x1db32f['queryFirstNode'](_0x3d34ef,'ViewPosition'),_0x9b159d=[0x0,0x0,0x0];_0x9b159d[0x0]=_0x1db32f['queryNumericValue'](_0xf705be,'X'),_0x9b159d[0x1]=_0x1db32f['queryNumericValue'](_0xf705be,'Y'),_0x9b159d[0x2]=_0x1db32f['queryNumericValue'](_0xf705be,'Z');const _0x1a607d=_0x1db32f['queryFirstNode'](_0x3d34ef,'Matrix'),_0x55af3b=_0x1db32f['queryStringValue'](_0x1a607d,'U'),_0x4760e8=_0x1db32f['queryStringValue'](_0x1a607d,'V'),_0x51dfcf=_0x1db32f['queryStringValue'](_0x1a607d,'W'),_0x538d36=_0x55af3b['split'](','),_0x4eddfd=new _0x2da033(parseFloat(_0x538d36[0x0]),parseFloat(_0x538d36[0x1]),parseFloat(_0x538d36[0x2])),_0x462df0=_0x4760e8['split'](','),_0x25668b=new _0x2da033(parseFloat(_0x462df0[0x0]),parseFloat(_0x462df0[0x1]),parseFloat(_0x462df0[0x2])),_0x20b7cd=_0x1db32f['queryFirstNode'](_0x3d34ef,'Bounds');let _0x114407;if(_0x20b7cd){const _0x132a8f=_0x4fdddb['toRadians'](_0x1db32f['queryNumericValue'](_0x20b7cd,'Left')),_0x410f5b=_0x4fdddb['toRadians'](_0x1db32f['queryNumericValue'](_0x20b7cd,'Top')),_0x4c7c79=_0x4fdddb['toRadians'](_0x1db32f['queryNumericValue'](_0x20b7cd,'Right')),_0x51e69a=_0x4fdddb['toRadians'](_0x1db32f['queryNumericValue'](_0x20b7cd,'Bottom')),_0xb2f04c=new _0x5a5cae(_0x132a8f,_0x51e69a,_0x4c7c79,_0x410f5b);let _0x1385a6=_0x47f563*Math['cos'](_0x4fdddb['toRadians'](_0x302a72));_0x1385a6=_0x302a72<0x0?-_0x1385a6:_0x1385a6;const _0x3e9f13=_0x9b159d[0x2]+_0x1385a6;_0x114407=_0x14a5e6['fromRectangle3D'](_0xb2f04c,undefined,_0x3e9f13);}return{'videoName':_0x29f532,'viewPosition':_0x9b159d,'heading':_0x71f1ae,'pitch':_0x302a72,'roll':_0x55087a,'horizontalFov':_0x1a06ee,'verticalFov':_0x3e14d4,'matrixU':_0x4eddfd,'matrixV':_0x25668b,'distance':_0x47f563,'boundingSphere':_0x114407};}function _0x1e334d(_0x4ac695,_0x42ed16){let _0x59050a=document['getElementById']('projection-image');!_0x5bbaa2(_0x59050a)&&(_0x59050a=document['createElement']('div'),_0x59050a['setAttribute']('id','projection-image'),document['body']['appendChild'](_0x59050a));const _0x132074=document['createElement']('video');return _0x132074['style']='visibility:hidden;position:absolute;top:0px;left:0px;',_0x132074['setAttribute']('width','320'),_0x132074['setAttribute']('height','240'),_0x132074['setAttribute']('autoplay','autoplay'),_0x132074['setAttribute']('loop','loop'),_0x132074['setAttribute']('crossorigin','crossorigin'),_0x132074['setAttribute']('src',_0x4ac695),_0x132074['setAttribute']('id','projection-image-'+_0x42ed16),_0x59050a['appendChild'](_0x132074),_0x132074;}_0x563a2e['fromInfo']=function(_0x3f041c,_0x3b24e9,_0x5f420d){if(!_0x5bbaa2(_0x3f041c))throw new _0x175b04('No\x20scene\x20provided.');if(!_0x5bbaa2(_0x3b24e9))throw new _0x175b04('No\x20url\x20provided.');const _0x50770f=_0x7f9cdf['createIfNeeded'](_0x3b24e9);return _0x50770f['fetchXML']()['then'](function(_0x466134){const _0xe5aacc={},_0x220b80=_0x466134['firstChild'];for(let _0x3acb84=0x0,_0x2ec07c=_0x220b80['children']['length'];_0x3acb84<_0x2ec07c;_0x3acb84++){const _0x2c118f=_0x220b80['children'][_0x3acb84],_0xe5d516=_0x59579a(_0x2c118f);let _0x382489=_0xe5d516['videoName'];_0x5bbaa2(_0x5f420d)?_0x382489=_0x3cf04c(_0x5f420d)+_0xe5d516['videoName']:_0x382489=_0x3b24e9['slice'](0x0,_0x3b24e9['lastIndexOf']('/')+0x1)+_0xe5d516['videoName'];const _0x4edf47=new _0x563a2e(_0x3f041c),_0x47f9ae=_0x1e334d(_0x382489,_0x4edf47['_guid']);_0x4edf47['viewPosition']=_0xe5d516['viewPosition'],_0x4edf47['direction']=_0xe5d516['heading'],_0x4edf47['pitch']=_0xe5d516['pitch'],_0x4edf47['horizontalFov']=_0xe5d516['horizontalFov'],_0x4edf47['verticalFov']=_0xe5d516['verticalFov'],_0x2da033['clone'](_0xe5d516['matrixU'],_0x4edf47['_v3AffineX']),_0x2da033['clone'](_0xe5d516['matrixV'],_0x4edf47['_v3AffineY']),_0x4edf47['distance']=_0xe5d516['distance'],_0x4edf47['setImage']({'video':_0x47f9ae}),_0x4edf47['_boundingSphere']=XML=_0xe5d516['boundingSphere'],_0x47f9ae['addEventListener']('loadeddata',function(_0x29392d){_0x29392d['build']();}['bind'](_0x47f9ae,_0x4edf47)),_0xe5aacc[_0xe5d516['videoName']]=_0x4edf47;}return _0xe5aacc;},_0x442dfe=>{console['error'](_0x442dfe);});},_0x563a2e['prototype']['build']=function(){if(this['isBuild'])return;this['isBuild']=!![],this['scene']['primitives']['add'](this),this['removeListenerFunc']=this['scene']['preUpdate']['addEventListener'](_0x1d6dd4=>{_0x5bbaa2(this['_cameraDepthBuffer'])&&this['_cameraDepthBuffer']['renderToTexture'](_0x1d6dd4);},this);},_0x563a2e['prototype']['clear']=function(){if(!this['isBuild'])return;this['isBuild']=![],this['removeListenerFunc'](),this['scene']['primitives']['remove'](this);},_0x563a2e['prototype']['destroy']=function(){const _0x3b58a6=document['getElementById']('projection-image-'+this['_guid']);if(_0x3b58a6){const _0x2efdc7=_0x3b58a6['parentNode'];_0x2efdc7['removeChild'](_0x3b58a6),_0x2efdc7['children']['length']===0x0&&_0x2efdc7['parentNode']['removeChild'](_0x2efdc7);}return this['_cameraDepthBuffer']=this['_cameraDepthBuffer']&&this['_cameraDepthBuffer']['destroy'](),_0x19dc2d(this),this['_texture']=this['_texture']&&!this['_texture']['isDestroyed']()&&this['_texture']['destroy'](),this['scene']['primitives']['remove'](this),_0x2c99a9(this);};export default _0x563a2e;