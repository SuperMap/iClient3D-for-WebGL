const _0x5cad07=(function(){let _0x582df3=!![];return function(_0x16ed89,_0x540877){const _0x849984=_0x582df3?function(){if(_0x540877){const _0x305647=_0x540877['apply'](_0x16ed89,arguments);return _0x540877=null,_0x305647;}}:function(){};return _0x582df3=![],_0x849984;};}()),_0x1e0e52=_0x5cad07(this,function(){return _0x1e0e52['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x1e0e52)['search']('(((.+)+)+)+$');});_0x1e0e52();import _0x49c73a from'../Shaders/S3MTilesVS.js';import _0x5613fa from'../Shaders/S3MTilesFS.js';import _0xafd75a from'./RenderEntity.js';import _0x2ddd08 from'../S3MEdgeProcessor.js';import _0x4a542f from'../Shaders/ModelEdgeVp.js';import _0x40f22f from'../Shaders/ModelEdgeFp.js';import _0x12dc22 from'../Enum/FillStyle.js';import _0x4e1347 from'../SubTextureUploadJob.js';import _0x18d26d from'../Enum/AlphaMode.js';import _0xde0f98 from'../getComUniformMap.js';const _0x20e460=Cesium['defined'];function _0x2f81ae(_0xb0cb70){_0xafd75a['call'](this,_0xb0cb70),this['vs']=_0x49c73a,this['fs']=_0x5613fa,this['edgeVA']=undefined,this['edgeSP']=undefined,this['regularEdgeCommand']=undefined,this['silhouetteEdgeCommand']=undefined,this['useLineColor']=![];}_0x2f81ae['prototype']=Object['create'](_0xafd75a['prototype']),_0x2f81ae['prototype']['constructor']=_0xafd75a;function _0x1d81bf(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND'],'stencilTest':{'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'mask':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK'],'reference':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK']}});}function _0x1efbf8(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND']});}let _0x4eb686=new Cesium['Cartesian4'](),_0x60874=new Cesium['Cartesian4'](),_0x51b5c1=new Cesium['Cartesian4'](),_0x467131=new Cesium['Cartesian4'](),_0x3ec9e3=new Cesium['Color'](),_0x1faeaa=new Cesium['Color']();function _0x18a73b(_0x174812,_0x33f743,_0x1a37e6){var _0x53832b=_0x1a37e6['materialPass']||{};let _0x2046aa={'uGeoMatrix':function(){return _0x1a37e6['geoMatrix'];},'uTexMatrix':function(){return _0x174812['texMatrix'];},'uFillForeColor':function(){if(_0x1a37e6['useLineColor'])return _0x33f743['style3D']['lineColor'];return _0x33f743['style3D']['fillForeColor'];},'uDiffuseColor':function(){return _0x174812['diffuseColor'];},'uAmbientColor':function(){return _0x174812['ambientColor'];},'uInverseGeoMatrix':function(){return _0x1a37e6['invGeoMatrix'];},'uTexture':function(){let _0x5c7839=_0x174812['textures'][0x0];if(_0x5c7839['isTexBlock'])return _0x5c7839['renderable']&&_0x5c7839['ready']?_0x5c7839:_0x174812['ancestorTexture']?_0x174812['ancestorTexture']:_0x5c7839;return _0x174812['textures'][0x0];},'uTexture2':function(){return _0x174812['textures'][0x1];},'uTexAtlasDim':function(){let _0x4ead52=_0x174812['textures'][0x0]['renderable']?_0x174812['textures'][0x0]:_0x174812['ancestorTexture']?_0x174812['ancestorTexture']:_0x174812['textures'][0x0];_0x467131['x']=_0x4ead52['width'],_0x467131['y']=_0x4ead52['height'];if(_0x174812['textures'][0x1]){let _0x1dd808=_0x174812['textures'][0x1]['renderable']?_0x174812['textures'][0x1]:_0x174812['ancestorTextureBake']?_0x174812['ancestorTextureBake']:_0x174812['textures'][0x1];_0x467131['z']=_0x1dd808['width'],_0x467131['w']=_0x1dd808['height'];}return _0x467131;},'batchTextureAtlas':function(){return _0x174812['batchTable']['_texture'];},'batchTextureAtlasStep':function(){return _0x174812['batchTable']['_textureStep'];},'batchTextureAtlasSec':function(){return _0x174812['batchTableBake']['_texture'];},'batchTextureAtlasStepSec':function(){return _0x174812['batchTableBake']['_textureStep'];},'uTexture0Width':function(){return _0x174812['textures'][0x0]['width'];},'uTexture1Width':function(){return _0x174812['textures'][0x1]['width'];},'uBaseColorTextureIndex':function(){if(_0x53832b['_baseColorTextureIndex']>-0x1)return _0x53832b['_baseColorTextureIndex'];return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTextureIndex'];},'uBaseColorFactor':function(){return _0x53832b['_baseColor']||_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['baseColor'];},'uMetallicFactor':function(){return _0x53832b['_metallicFactor']||_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['metallicFactor'];},'uRoughnessFactor':function(){return Cesium['defaultValue'](_0x53832b['_roughnessFactor'],_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['roughnessFactor']);},'uEmissiveFactor':function(){return _0x53832b['_emissiveFactor']||_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveFactor'];},'uEmissionTexture':function(){if(_0x20e460(_0x53832b['emissiveTexture']))return _0x53832b['emissiveTexture'];var _0x52594e=_0x53832b['_emissiveTextureIndex'];if(_0x52594e>-0x1&&_0x20e460(_0x53832b['_textures'][_0x52594e]))return _0x53832b['_textures'][_0x52594e];return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveTexture'];},'uMetallicRoughnessTexture':function(){if(_0x20e460(_0x53832b['_metallicRoughnessTextureIndex'])&&_0x53832b['_metallicRoughnessTextureIndex']>-0x1){if(_0x20e460(_0x53832b['metallicRoughnessTexture']))return _0x53832b['metallicRoughnessTexture'];return _0x53832b['_textures'][_0x53832b['_metallicRoughnessTextureIndex']];}return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['metallicRoughnessTexture'];},'uNormalTexture':function(){if(_0x20e460(_0x53832b['_normalTextureIndex'])&&_0x53832b['_normalTextureIndex']>-0x1){if(_0x53832b['normalTexture'])return _0x53832b['normalTexture'];return _0x53832b['_textures'][_0x53832b['_normalTextureIndex']];}return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['normalTexture'];},'uNormalTextureScale':function(){if(_0x20e460(_0x53832b['_normalTextureScale']))return _0x53832b['_normalTextureScale'];return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['normalTextureScale'];},'uOcclusionTexture':function(){if(_0x20e460(_0x53832b['_occlusionTextureIndex'])&&_0x53832b['_occlusionTextureIndex']>-0x1){if(_0x53832b['occlusionTexture'])return _0x53832b['occlusionTexture'];return _0x53832b['_textures'][_0x53832b['_occlusionTextureIndex']];}return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['occlusionTexture'];},'uIndexOfRefraction':function(){if(_0x20e460(_0x53832b['_indexOfRefraction'])&&_0x53832b['_indexOfRefraction']>0x0)return _0x53832b['_indexOfRefraction'];return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['indexOfRefraction'];},'uTransmissionFactor':function(){if(_0x20e460(_0x53832b['_transmissionFactor'])&&_0x53832b['_transmissionFactor']>0x0)return _0x53832b['_transmissionFactor'];if(_0x20e460(_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['volume'])&&_0x20e460(_0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor']))return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor'];return 0x1;},'uBaseTexture':function(){if(_0x20e460(_0x53832b['_baseColorTextureIndex'])&&_0x53832b['_baseColorTextureIndex']>-0x1)return _0x53832b['baseColorTexture'];return _0x33f743['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTexture'];},'decodePositionMin':function(){const _0x3311ea=_0x1a37e6['vertexPackage']['minVerticesValue'];return _0x3311ea;},'decodePositionNormConstant':function(){return _0x1a37e6['vertexPackage']['vertCompressConstant'];}};Object['assign'](_0x2046aa,_0xde0f98(_0x33f743));let _0x3f0166=_0x1a37e6['vertexPackage']['minTexCoordValue'];return _0x3f0166&&_0x3f0166['length']>0x0&&(_0x2046aa['decodeTexCoord0vNormConstant']=function(){return _0x1a37e6['vertexPackage']['texCoordCompressConstant'][0x0];},_0x2046aa['decodeTexCoord1vNormConstant']=function(){return _0x1a37e6['vertexPackage']['texCoordCompressConstant'][0x1];},_0x2046aa['decodeTexCoord0Min']=function(){return _0x1a37e6['vertexPackage']['minTexCoordValue'][0x0];},_0x2046aa['decodeTexCoord1Min']=function(){return _0x1a37e6['vertexPackage']['minTexCoordValue'][0x1];}),_0x2046aa;}_0x2f81ae['prototype']['createOneEdgeCommand']=function(_0x5bd359,_0x115d5e,_0x96553e,_0x5c63ed,_0x209740){if(!_0x96553e['attributes']||_0x96553e['attributes']['length']==0x0||!_0x96553e['instanceCount']||_0x96553e['instanceCount']===0x0)return null;let _0x1f3aaf=new Cesium['DrawCommand']({'primitiveType':Cesium['PrimitiveType']['TRIANGLES'],'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pass':Cesium['Pass']['CESIUM_3D_TILE'],'owner':this,'cull':!![]});this['edgeVA']=new Cesium['VertexArray']({'context':_0x5bd359,'attributes':_0x96553e['attributes'],'indexBuffer':_0x5c63ed}),_0x1f3aaf['vertexArray']=this['edgeVA'],_0x1f3aaf['instanceCount']=_0x96553e['instanceCount'];let _0x194a32,_0x29c091;_0x194a32=new Cesium['ShaderSource']({'sources':[_0x4a542f]}),_0x29c091=new Cesium['ShaderSource']({'sources':[_0x40f22f]});!_0x209740&&(_0x194a32['defines']['push']('SILHOUETTE'),_0x29c091['defines']['push']('SILHOUETTE'));_0x194a32['defines']['push']('ANTIALIASING'),_0x29c091['defines']['push']('ANTIALIASING'),_0x194a32['defines']['push']('POLYGON_OFFSET'),_0x29c091['defines']['push']('POLYGON_OFFSET');_0x115d5e['swipeEnabled']&&_0x29c091['defines']['push'](ProgramDefines['APPLY_SWIPE']);_0x115d5e['_enableClip']&&_0x29c091['defines']['push']('CLIP');_0x115d5e['_enableClipPlane']&&_0x29c091['defines']['push']('CLIPPLANE');_0x115d5e['_hasExcavation']&&(_0x194a32['defines']['push'](ProgramDefines['EXCAVATION']),_0x29c091['defines']['push'](ProgramDefines['EXCAVATION']));let _0x51f1b9=0x0;_0x194a32['defines']['push']('MODE\x20'+_0x51f1b9),_0x29c091['defines']['push']('MODE\x20'+_0x51f1b9),this['edgeSP']=Cesium['ShaderProgram']['fromCache']({'context':_0x5bd359,'vertexShaderSource':_0x194a32,'fragmentShaderSource':_0x29c091,'attributeLocations':_0x96553e['attributeLocations']}),_0x1f3aaf['shaderProgram']=this['edgeSP'],_0x1f3aaf['renderState']=Cesium['RenderState']['fromCache']({'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'cull':{'enabled':!![]},'blending':Cesium['BlendingState']['ALPHA_BLEND']});let _0x2fa738={'uLineColor':function(){return _0x115d5e['style3D']['lineColor'];},'uLineWidth':function(){return _0x115d5e['style3D']['lineWidth'];},'uDistanceFalloffFactor':function(){return _0x115d5e['_edgeDistanceFalloffFactor'];},'u_polygonOffset':function(){return new Cesium['Cartesian2'](-0x5,-0x5);}};return _0x1f3aaf['uniformMap']=Cesium['combine'](_0x2fa738,this['colorCommand']['uniformMap']),_0x1f3aaf['edgeTotalLength']=_0x96553e['edgeLength'],_0x1f3aaf['edgeCount']=_0x96553e['instanceCount'],_0x1f3aaf;},_0x2f81ae['prototype']['createCommand']=function(){if(Cesium['defined'](this['colorCommand'])||this['vertexBufferToCreate']['length']!==0x0||this['indexBufferToCreate']['length']!==0x0||this['shaderProgramToCreate']['length']!==0x0)return;let _0x22d3c7=this['layer'],_0x3e945f=_0x22d3c7['context'],_0x3b546e=this['vertexPackage'],_0x3b085e=this['arrIndexPackage'],_0x149e9a=_0x3b546e['vertexAttributes'];if(_0x3b085e['length']<0x1)return;let _0x3e29d1=_0x3b085e[0x0],_0x2a7679=this['material'];this['vertexArray']=new Cesium['VertexArray']({'context':_0x3e945f,'attributes':_0x149e9a,'indexBuffer':_0x3e29d1['indexBuffer']});let _0x56307b=Cesium['PrimitiveType']['TRIANGLES'];switch(_0x3e29d1['primitiveType']){case 0x1:_0x56307b=Cesium['PrimitiveType']['POINTS'];break;case 0x2:_0x56307b=Cesium['PrimitiveType']['LINES'];break;case 0x4:_0x56307b=Cesium['PrimitiveType']['TRIANGLES'];break;default:break;}this['useLineColor']=_0x56307b===Cesium['PrimitiveType']['LINES'];let _0x4e1326=![];if(_0x2a7679['alphaMode']===_0x18d26d['MASK']||_0x2a7679['alphaMode']===_0x18d26d['BLEND'])_0x4e1326=!![];else _0x22d3c7['_isTransparencyOptimization']&&_0x2a7679['bTransparentSorting']&&(_0x4e1326=!![]);this['colorCommand']=new Cesium['DrawCommand']({'primitiveType':_0x56307b,'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pickId':this['pickColorIdentifier'],'vertexArray':this['vertexArray'],'shaderProgram':this['shaderProgram'],'pass':_0x4e1326?Cesium['Pass']['TRANSLUCENT']:Cesium['Pass']['CESIUM_3D_TILE'],'renderState':_0x2a7679['bTransparentSorting']?_0x1efbf8():_0x1d81bf(),'instanceCount':_0x3b546e['instanceCount']});let _0x2f6023=_0x18a73b(_0x2a7679,_0x22d3c7,this);this['batchTable']&&(_0x2f6023=this['batchTable']['getUniformMapCallback']()(_0x2f6023)),_0x2a7679['batchTable']&&(_0x2f6023=_0x2a7679['batchTable']['getUniformMapCallback']()(_0x2f6023)),this['colorCommand']['uniformMap']=_0x2f6023,this['vs']=undefined,this['fs']=undefined,this['ready']=!![];},_0x2f81ae['prototype']['createWireFrame']=function(_0x3ce199){if(!this['colorCommand']||!this['edgeGeometry']||this['regularEdgeCommand'])return;let _0x5a1370=this['layer']['context'],_0x4c300d=this['edgeGeometry'];_0x2ddd08['createRegularEdgeAttributes'](_0x5a1370,_0x4c300d['regular']),_0x2ddd08['createSilhouetteEdgeAttributes'](_0x5a1370,_0x4c300d['silhouette']);let _0xc20c2=_0x2ddd08['createIndexBuffer'](_0x5a1370);this['regularEdgeCommand']=this['createOneEdgeCommand'](_0x5a1370,this['layer'],_0x4c300d['regular'],_0xc20c2,!![]),this['silhouetteEdgeCommand']=this['createOneEdgeCommand'](_0x5a1370,this['layer'],_0x4c300d['silhouette'],_0xc20c2,![]);};let _0x4d6579=new _0x4e1347();_0x2f81ae['prototype']['updateMaterialBatchTable']=function(_0x45550c){this['material']['initTexture'](),this['material']['requestSubTextures'](_0x45550c,this['layer']);let _0x4ca055=this['material']['subTexturesToUpload'];while(_0x4ca055['length']){let _0x5f5c37=_0x4ca055['peek'](),_0xd907f0=_0x5f5c37['texture'],_0x2145cf=_0x5f5c37['subTextureInfo'];_0x4d6579['set'](_0x45550c['context'],this,_0xd907f0,_0x2145cf);if(!_0x45550c['jobScheduler']['execute'](_0x4d6579,Cesium['JobType']['TEXTURE']))break;_0x4ca055['dequeue']();}_0x4ca055['length']===0x0&&this['material']['enableTextureRenderable'](),this['material']['batchTable']['update'](_0x45550c);},_0x2f81ae['prototype']['transformResource']=function(_0x382333,_0xfa98f4){if(this['ready'])return;this['createBatchTable'](_0x382333),this['createPickIds'](),this['createBuffers'](_0x382333),this['createShaderProgram'](_0x382333),this['createCommand'](_0x382333),this['createWireFrame'](_0x382333),this['initLayerSetting'](_0xfa98f4);},_0x2f81ae['prototype']['update']=function(_0x425474,_0x560b27){this['batchTableDirty']&&(this['updateBatchTableAttributes'](),this['batchTableDirty']=![]),this['batchTable']&&this['batchTable']['update'](_0x425474),this['material']['batchTable']&&this['updateMaterialBatchTable'](_0x425474),_0x560b27['style3D']['fillStyle']!==_0x12dc22['WireFrame']&&_0x425474['commandList']['push'](this['colorCommand']),_0x560b27['style3D']['fillStyle']!==_0x12dc22['Fill']&&(this['regularEdgeCommand']&&(_0x425474['commandList']['push'](this['regularEdgeCommand']),_0x560b27['_addRenderedEdge'](this['regularEdgeCommand']['edgeTotalLength'],this['regularEdgeCommand']['edgeCount'])),this['silhouetteEdgeCommand']&&(_0x425474['commandList']['push'](this['silhouetteEdgeCommand']),_0x560b27['_addRenderedEdge'](this['silhouetteEdgeCommand']['edgeTotalLength'],this['silhouetteEdgeCommand']['edgeCount'])));},_0x2f81ae['prototype']['isDestroyed']=function(){return![];},_0x2f81ae['prototype']['destroy']=function(){return this['shaderProgram']=this['shaderProgram']&&!this['shaderProgram']['isDestroyed']()&&this['shaderProgram']['destroy'](),this['vertexArray']=this['vertexArray']&&!this['vertexArray']['isDestroyed']()&&this['vertexArray']['destroy'](),this['material']=this['material']&&!this['material']['isDestroyed']()&&this['material']['destroy'](),this['batchTable']=this['batchTable']&&!this['batchTable']['isDestroyed']()&&this['batchTable']['destroy'](),this['edgeVA']=this['edgeVA']&&!this['edgeVA']['isDestroyed']()&&this['edgeVA']['destroy'](),this['edgeSP']=this['edgeSP']&&!this['edgeSP']['isDestroyed']()&&this['edgeSP']['destroy'](),this['colorCommand']=undefined,this['vertexPackage']=null,this['arrIndexPackage']=null,this['modelMatrix']=undefined,this['pickInfo']=undefined,this['selectionInfoMap']=undefined,this['vs']=undefined,this['fs']=undefined,Cesium['destroyObject'](this);};export default _0x2f81ae;