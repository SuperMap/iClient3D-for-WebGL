const _0x51028d=(function(){let _0xaad5f=!![];return function(_0x274443,_0x5512ac){const _0x37e9f0=_0xaad5f?function(){if(_0x5512ac){const _0x28ae1c=_0x5512ac['apply'](_0x274443,arguments);return _0x5512ac=null,_0x28ae1c;}}:function(){};return _0xaad5f=![],_0x37e9f0;};}()),_0x12f37f=_0x51028d(this,function(){return _0x12f37f['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x12f37f)['search']('(((.+)+)+)+$');});_0x12f37f();import _0x4be63d from'../Shaders/S3MTilesVS.js';import _0xaf943f from'../Shaders/S3MTilesFS.js';import _0x116886 from'./RenderEntity.js';import _0x2c02f1 from'../S3MEdgeProcessor.js';import _0x10d5d6 from'../Shaders/ModelEdgeVp.js';import _0x4f0ae2 from'../Shaders/ModelEdgeFp.js';import _0x526ba0 from'../Enum/FillStyle.js';import _0x11b51a from'../SubTextureUploadJob.js';import _0x43d628 from'../Enum/AlphaMode.js';import _0x3534ef from'../getComUniformMap.js';const _0x5680e6=Cesium['defined'];function _0x44a39a(_0x4eaa66){_0x116886['call'](this,_0x4eaa66),this['vs']=_0x4be63d,this['fs']=_0xaf943f,this['edgeVA']=undefined,this['edgeSP']=undefined,this['regularEdgeCommand']=undefined,this['silhouetteEdgeCommand']=undefined,this['useLineColor']=![];}_0x44a39a['prototype']=Object['create'](_0x116886['prototype']),_0x44a39a['prototype']['constructor']=_0x116886;function _0x165fcb(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND'],'stencilTest':{'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'mask':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK'],'reference':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK']}});}function _0x55994f(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND']});}let _0x23b8d9=new Cesium['Cartesian4'](),_0x20d17e=new Cesium['Cartesian4'](),_0x433d8a=new Cesium['Cartesian4'](),_0x37b7b4=new Cesium['Cartesian4'](),_0x4efedc=new Cesium['Color'](),_0x3036ce=new Cesium['Color']();function _0x1608c0(_0x5a772d,_0x23a90c,_0x84a876){var _0x19d3d3=_0x84a876['materialPass']||{};let _0x17568c={'uGeoMatrix':function(){return _0x84a876['geoMatrix'];},'uTexMatrix':function(){return _0x5a772d['texMatrix'];},'uFillForeColor':function(){if(_0x84a876['useLineColor'])return _0x23a90c['style3D']['lineColor'];return _0x23a90c['style3D']['fillForeColor'];},'uDiffuseColor':function(){return _0x5a772d['diffuseColor'];},'uAmbientColor':function(){return _0x5a772d['ambientColor'];},'uInverseGeoMatrix':function(){return _0x84a876['invGeoMatrix'];},'uTexture':function(){let _0x3080dd=_0x5a772d['textures'][0x0];if(_0x3080dd['isTexBlock'])return _0x3080dd['renderable']&&_0x3080dd['ready']?_0x3080dd:_0x5a772d['ancestorTexture']?_0x5a772d['ancestorTexture']:_0x3080dd;return _0x5a772d['textures'][0x0];},'uTexture2':function(){return _0x5a772d['textures'][0x1];},'uTexAtlasDim':function(){let _0x43b4dd=_0x5a772d['textures'][0x0]['renderable']?_0x5a772d['textures'][0x0]:_0x5a772d['ancestorTexture']?_0x5a772d['ancestorTexture']:_0x5a772d['textures'][0x0];_0x37b7b4['x']=_0x43b4dd['width'],_0x37b7b4['y']=_0x43b4dd['height'];if(_0x5a772d['textures'][0x1]){let _0x594a78=_0x5a772d['textures'][0x1]['renderable']?_0x5a772d['textures'][0x1]:_0x5a772d['ancestorTextureBake']?_0x5a772d['ancestorTextureBake']:_0x5a772d['textures'][0x1];_0x37b7b4['z']=_0x594a78['width'],_0x37b7b4['w']=_0x594a78['height'];}return _0x37b7b4;},'batchTextureAtlas':function(){return _0x5a772d['batchTable']['_texture'];},'batchTextureAtlasStep':function(){return _0x5a772d['batchTable']['_textureStep'];},'batchTextureAtlasSec':function(){return _0x5a772d['batchTableBake']['_texture'];},'batchTextureAtlasStepSec':function(){return _0x5a772d['batchTableBake']['_textureStep'];},'uTexture0Width':function(){return _0x5a772d['textures'][0x0]['width'];},'uTexture1Width':function(){return _0x5a772d['textures'][0x1]['width'];},'uBaseColorTextureIndex':function(){if(_0x19d3d3['_baseColorTextureIndex']>-0x1)return _0x19d3d3['_baseColorTextureIndex'];return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTextureIndex'];},'uBaseColorFactor':function(){return _0x19d3d3['_baseColor']||_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['baseColor'];},'uMetallicFactor':function(){return _0x19d3d3['_metallicFactor']||_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['metallicFactor'];},'uRoughnessFactor':function(){return Cesium['defaultValue'](_0x19d3d3['_roughnessFactor'],_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['roughnessFactor']);},'uEmissiveFactor':function(){return _0x19d3d3['_emissiveFactor']||_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveFactor'];},'uEmissionTexture':function(){if(_0x5680e6(_0x19d3d3['emissiveTexture']))return _0x19d3d3['emissiveTexture'];var _0x44b39b=_0x19d3d3['_emissiveTextureIndex'];if(_0x44b39b>-0x1&&_0x5680e6(_0x19d3d3['_textures'][_0x44b39b]))return _0x19d3d3['_textures'][_0x44b39b];return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveTexture'];},'uMetallicRoughnessTexture':function(){if(_0x5680e6(_0x19d3d3['_metallicRoughnessTextureIndex'])&&_0x19d3d3['_metallicRoughnessTextureIndex']>-0x1){if(_0x5680e6(_0x19d3d3['metallicRoughnessTexture']))return _0x19d3d3['metallicRoughnessTexture'];return _0x19d3d3['_textures'][_0x19d3d3['_metallicRoughnessTextureIndex']];}return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['metallicRoughnessTexture'];},'uNormalTexture':function(){if(_0x5680e6(_0x19d3d3['_normalTextureIndex'])&&_0x19d3d3['_normalTextureIndex']>-0x1){if(_0x19d3d3['normalTexture'])return _0x19d3d3['normalTexture'];return _0x19d3d3['_textures'][_0x19d3d3['_normalTextureIndex']];}return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['normalTexture'];},'uNormalTextureScale':function(){if(_0x5680e6(_0x19d3d3['_normalTextureScale']))return _0x19d3d3['_normalTextureScale'];return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['normalTextureScale'];},'uOcclusionTexture':function(){if(_0x5680e6(_0x19d3d3['_occlusionTextureIndex'])&&_0x19d3d3['_occlusionTextureIndex']>-0x1){if(_0x19d3d3['occlusionTexture'])return _0x19d3d3['occlusionTexture'];return _0x19d3d3['_textures'][_0x19d3d3['_occlusionTextureIndex']];}return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['occlusionTexture'];},'uIndexOfRefraction':function(){if(_0x5680e6(_0x19d3d3['_indexOfRefraction'])&&_0x19d3d3['_indexOfRefraction']>0x0)return _0x19d3d3['_indexOfRefraction'];return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['indexOfRefraction'];},'uTransmissionFactor':function(){if(_0x5680e6(_0x19d3d3['_transmissionFactor'])&&_0x19d3d3['_transmissionFactor']>0x0)return _0x19d3d3['_transmissionFactor'];if(_0x5680e6(_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['volume'])&&_0x5680e6(_0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor']))return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor'];return 0x1;},'uBaseTexture':function(){if(_0x5680e6(_0x19d3d3['_baseColorTextureIndex'])&&_0x19d3d3['_baseColorTextureIndex']>-0x1)return _0x19d3d3['baseColorTexture'];return _0x23a90c['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTexture'];},'decodePositionMin':function(){const _0x64a2a9=_0x84a876['vertexPackage']['minVerticesValue'];return _0x64a2a9;},'decodePositionNormConstant':function(){return _0x84a876['vertexPackage']['vertCompressConstant'];}};Object['assign'](_0x17568c,_0x3534ef(_0x23a90c));let _0xee69d1=_0x84a876['vertexPackage']['minTexCoordValue'];return _0xee69d1&&_0xee69d1['length']>0x0&&(_0x17568c['decodeTexCoord0vNormConstant']=function(){return _0x84a876['vertexPackage']['texCoordCompressConstant'][0x0];},_0x17568c['decodeTexCoord1vNormConstant']=function(){return _0x84a876['vertexPackage']['texCoordCompressConstant'][0x1];},_0x17568c['decodeTexCoord0Min']=function(){return _0x84a876['vertexPackage']['minTexCoordValue'][0x0];}),_0x17568c;}_0x44a39a['prototype']['createOneEdgeCommand']=function(_0x5c2f9a,_0x2b7246,_0x1baf64,_0x32f7ef,_0x5f277c){if(!_0x1baf64['attributes']||_0x1baf64['attributes']['length']==0x0||!_0x1baf64['instanceCount']||_0x1baf64['instanceCount']===0x0)return null;let _0x50a14c=new Cesium['DrawCommand']({'primitiveType':Cesium['PrimitiveType']['TRIANGLES'],'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pass':Cesium['Pass']['CESIUM_3D_TILE'],'owner':this,'cull':!![]});this['edgeVA']=new Cesium['VertexArray']({'context':_0x5c2f9a,'attributes':_0x1baf64['attributes'],'indexBuffer':_0x32f7ef}),_0x50a14c['vertexArray']=this['edgeVA'],_0x50a14c['instanceCount']=_0x1baf64['instanceCount'];let _0x407273,_0x3fead1;_0x407273=new Cesium['ShaderSource']({'sources':[_0x10d5d6]}),_0x3fead1=new Cesium['ShaderSource']({'sources':[_0x4f0ae2]});!_0x5f277c&&(_0x407273['defines']['push']('SILHOUETTE'),_0x3fead1['defines']['push']('SILHOUETTE'));_0x407273['defines']['push']('ANTIALIASING'),_0x3fead1['defines']['push']('ANTIALIASING'),_0x407273['defines']['push']('POLYGON_OFFSET'),_0x3fead1['defines']['push']('POLYGON_OFFSET');_0x2b7246['swipeEnabled']&&_0x3fead1['defines']['push'](ProgramDefines['APPLY_SWIPE']);_0x2b7246['_enableClip']&&_0x3fead1['defines']['push']('CLIP');_0x2b7246['_enableClipPlane']&&_0x3fead1['defines']['push']('CLIPPLANE');_0x2b7246['_hasExcavation']&&(_0x407273['defines']['push'](ProgramDefines['EXCAVATION']),_0x3fead1['defines']['push'](ProgramDefines['EXCAVATION']));let _0x261bff=0x0;_0x407273['defines']['push']('MODE\x20'+_0x261bff),_0x3fead1['defines']['push']('MODE\x20'+_0x261bff),this['edgeSP']=Cesium['ShaderProgram']['fromCache']({'context':_0x5c2f9a,'vertexShaderSource':_0x407273,'fragmentShaderSource':_0x3fead1,'attributeLocations':_0x1baf64['attributeLocations']}),_0x50a14c['shaderProgram']=this['edgeSP'],_0x50a14c['renderState']=Cesium['RenderState']['fromCache']({'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'cull':{'enabled':!![]},'blending':Cesium['BlendingState']['ALPHA_BLEND']});let _0x2e4688={'uLineColor':function(){return _0x2b7246['style3D']['lineColor'];},'uLineWidth':function(){return _0x2b7246['style3D']['lineWidth'];},'uDistanceFalloffFactor':function(){return _0x2b7246['_edgeDistanceFalloffFactor'];},'u_polygonOffset':function(){return new Cesium['Cartesian2'](-0x5,-0x5);}};return _0x50a14c['uniformMap']=Cesium['combine'](_0x2e4688,this['colorCommand']['uniformMap']),_0x50a14c['edgeTotalLength']=_0x1baf64['edgeLength'],_0x50a14c['edgeCount']=_0x1baf64['instanceCount'],_0x50a14c;},_0x44a39a['prototype']['createCommand']=function(){if(Cesium['defined'](this['colorCommand'])||this['vertexBufferToCreate']['length']!==0x0||this['indexBufferToCreate']['length']!==0x0||this['shaderProgramToCreate']['length']!==0x0)return;let _0x4c6bf1=this['layer'],_0x565eff=_0x4c6bf1['context'],_0x17a841=this['vertexPackage'],_0x2b527f=this['arrIndexPackage'],_0x2073fb=_0x17a841['vertexAttributes'];if(_0x2b527f['length']<0x1)return;let _0x440858=_0x2b527f[0x0],_0x30d618=this['material'];this['vertexArray']=new Cesium['VertexArray']({'context':_0x565eff,'attributes':_0x2073fb,'indexBuffer':_0x440858['indexBuffer']});let _0x38cadb=Cesium['PrimitiveType']['TRIANGLES'];switch(_0x440858['primitiveType']){case 0x1:_0x38cadb=Cesium['PrimitiveType']['POINTS'];break;case 0x2:_0x38cadb=Cesium['PrimitiveType']['LINES'];break;case 0x4:_0x38cadb=Cesium['PrimitiveType']['TRIANGLES'];break;default:break;}this['useLineColor']=_0x38cadb===Cesium['PrimitiveType']['LINES'];let _0x5cc165=![];if(_0x30d618['alphaMode']===_0x43d628['MASK']||_0x30d618['alphaMode']===_0x43d628['BLEND'])_0x5cc165=!![];else _0x4c6bf1['_isTransparencyOptimization']&&_0x30d618['bTransparentSorting']&&(_0x5cc165=!![]);this['colorCommand']=new Cesium['DrawCommand']({'primitiveType':_0x38cadb,'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pickId':this['pickColorIdentifier'],'vertexArray':this['vertexArray'],'shaderProgram':this['shaderProgram'],'pass':_0x5cc165?Cesium['Pass']['TRANSLUCENT']:Cesium['Pass']['CESIUM_3D_TILE'],'renderState':_0x30d618['bTransparentSorting']?_0x55994f():_0x165fcb(),'instanceCount':_0x17a841['instanceCount']});let _0x58c2ba=_0x1608c0(_0x30d618,_0x4c6bf1,this);this['batchTable']&&(_0x58c2ba=this['batchTable']['getUniformMapCallback']()(_0x58c2ba)),_0x30d618['batchTable']&&(_0x58c2ba=_0x30d618['batchTable']['getUniformMapCallback']()(_0x58c2ba)),this['colorCommand']['uniformMap']=_0x58c2ba,this['vs']=undefined,this['fs']=undefined,this['ready']=!![];},_0x44a39a['prototype']['createWireFrame']=function(_0x49fdf2){if(!this['colorCommand']||!this['edgeGeometry']||this['regularEdgeCommand'])return;let _0x2af9a1=this['layer']['context'],_0x4acce8=this['edgeGeometry'];_0x2c02f1['createRegularEdgeAttributes'](_0x2af9a1,_0x4acce8['regular']),_0x2c02f1['createSilhouetteEdgeAttributes'](_0x2af9a1,_0x4acce8['silhouette']);let _0x5e4e30=_0x2c02f1['createIndexBuffer'](_0x2af9a1);this['regularEdgeCommand']=this['createOneEdgeCommand'](_0x2af9a1,this['layer'],_0x4acce8['regular'],_0x5e4e30,!![]),this['silhouetteEdgeCommand']=this['createOneEdgeCommand'](_0x2af9a1,this['layer'],_0x4acce8['silhouette'],_0x5e4e30,![]);};let _0x18c164=new _0x11b51a();_0x44a39a['prototype']['updateMaterialBatchTable']=function(_0x23318a){this['material']['initTexture'](),this['material']['requestSubTextures'](_0x23318a,this['layer']);let _0x532358=this['material']['subTexturesToUpload'];while(_0x532358['length']){let _0x188fc3=_0x532358['peek'](),_0x5460b2=_0x188fc3['texture'],_0x9986c1=_0x188fc3['subTextureInfo'];_0x18c164['set'](_0x23318a['context'],this,_0x5460b2,_0x9986c1);if(!_0x23318a['jobScheduler']['execute'](_0x18c164,Cesium['JobType']['TEXTURE']))break;_0x532358['dequeue']();}_0x532358['length']===0x0&&this['material']['enableTextureRenderable'](),this['material']['batchTable']['update'](_0x23318a);},_0x44a39a['prototype']['transformResource']=function(_0x54d726,_0x253d92){if(this['ready'])return;this['createBatchTable'](_0x54d726),this['createPickIds'](),this['createBuffers'](_0x54d726),this['createShaderProgram'](_0x54d726),this['createCommand'](_0x54d726),this['createWireFrame'](_0x54d726),this['initLayerSetting'](_0x253d92);},_0x44a39a['prototype']['update']=function(_0x359b06,_0xe495e1){this['batchTableDirty']&&(this['updateBatchTableAttributes'](),this['batchTableDirty']=![]),this['batchTable']&&this['batchTable']['update'](_0x359b06),this['material']['batchTable']&&this['updateMaterialBatchTable'](_0x359b06),_0xe495e1['style3D']['fillStyle']!==_0x526ba0['WireFrame']&&_0x359b06['commandList']['push'](this['colorCommand']),_0xe495e1['style3D']['fillStyle']!==_0x526ba0['Fill']&&(this['regularEdgeCommand']&&(_0x359b06['commandList']['push'](this['regularEdgeCommand']),_0xe495e1['_addRenderedEdge'](this['regularEdgeCommand']['edgeTotalLength'],this['regularEdgeCommand']['edgeCount'])),this['silhouetteEdgeCommand']&&(_0x359b06['commandList']['push'](this['silhouetteEdgeCommand']),_0xe495e1['_addRenderedEdge'](this['silhouetteEdgeCommand']['edgeTotalLength'],this['silhouetteEdgeCommand']['edgeCount'])));},_0x44a39a['prototype']['isDestroyed']=function(){return![];},_0x44a39a['prototype']['destroy']=function(){return this['shaderProgram']=this['shaderProgram']&&!this['shaderProgram']['isDestroyed']()&&this['shaderProgram']['destroy'](),this['vertexArray']=this['vertexArray']&&!this['vertexArray']['isDestroyed']()&&this['vertexArray']['destroy'](),this['material']=this['material']&&!this['material']['isDestroyed']()&&this['material']['destroy'](),this['batchTable']=this['batchTable']&&!this['batchTable']['isDestroyed']()&&this['batchTable']['destroy'](),this['edgeVA']=this['edgeVA']&&!this['edgeVA']['isDestroyed']()&&this['edgeVA']['destroy'](),this['edgeSP']=this['edgeSP']&&!this['edgeSP']['isDestroyed']()&&this['edgeSP']['destroy'](),this['colorCommand']=undefined,this['vertexPackage']=null,this['arrIndexPackage']=null,this['modelMatrix']=undefined,this['pickInfo']=undefined,this['selectionInfoMap']=undefined,this['vs']=undefined,this['fs']=undefined,Cesium['destroyObject'](this);};export default _0x44a39a;