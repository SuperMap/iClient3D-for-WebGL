const _0x3fb55d=(function(){let _0x281db2=!![];return function(_0x1bd671,_0x4d955a){const _0x4d14ae=_0x281db2?function(){if(_0x4d955a){const _0x1fd153=_0x4d955a['apply'](_0x1bd671,arguments);return _0x4d955a=null,_0x1fd153;}}:function(){};return _0x281db2=![],_0x4d14ae;};}()),_0x8f982b=_0x3fb55d(this,function(){return _0x8f982b['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x8f982b)['search']('(((.+)+)+)+$');});_0x8f982b();import _0x499097 from'../Shaders/S3MTilesVS.js';import _0x5096ba from'../Shaders/S3MTilesFS.js';import _0x1b94df from'./RenderEntity.js';import _0x1e6526 from'../S3MEdgeProcessor.js';import _0x710df4 from'../Shaders/ModelEdgeVp.js';import _0x376e51 from'../Shaders/ModelEdgeFp.js';import _0x4af9d4 from'../Enum/FillStyle.js';import _0x126a10 from'../SubTextureUploadJob.js';import _0x150068 from'../Enum/AlphaMode.js';import _0x185fc3 from'../getComUniformMap.js';const _0x5eda2a=Cesium['defined'];function _0x2a6bbb(_0x39cf2b){_0x1b94df['call'](this,_0x39cf2b),this['vs']=_0x499097,this['fs']=_0x5096ba,this['edgeVA']=undefined,this['edgeSP']=undefined,this['regularEdgeCommand']=undefined,this['silhouetteEdgeCommand']=undefined,this['useLineColor']=![];}_0x2a6bbb['prototype']=Object['create'](_0x1b94df['prototype']),_0x2a6bbb['prototype']['constructor']=_0x1b94df;function _0xc20fec(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND'],'stencilTest':{'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'mask':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK'],'reference':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK']}});}function _0x5306f9(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND']});}let _0x4be1fb=new Cesium['Cartesian4'](),_0xdac179=new Cesium['Cartesian4'](),_0x351a61=new Cesium['Cartesian4'](),_0x8d075e=new Cesium['Cartesian4'](),_0x3254c4=new Cesium['Color'](),_0x395cf4=new Cesium['Color']();function _0xef4837(_0x54aec0,_0x229299,_0x2929f1){var _0xa29204=_0x2929f1['materialPass']||{};let _0x34cc27={'uGeoMatrix':function(){return _0x2929f1['geoMatrix'];},'uTexMatrix':function(){return _0x54aec0['texMatrix'];},'uFillForeColor':function(){if(_0x2929f1['useLineColor'])return _0x229299['style3D']['lineColor'];return _0x229299['style3D']['fillForeColor'];},'uDiffuseColor':function(){return _0x54aec0['diffuseColor'];},'uAmbientColor':function(){return _0x54aec0['ambientColor'];},'uInverseGeoMatrix':function(){return _0x2929f1['invGeoMatrix'];},'uTexture':function(){let _0x567a26=_0x54aec0['textures'][0x0];if(_0x567a26['isTexBlock'])return _0x567a26['renderable']&&_0x567a26['ready']?_0x567a26:_0x54aec0['ancestorTexture']?_0x54aec0['ancestorTexture']:_0x567a26;return _0x54aec0['textures'][0x0];},'uTexture2':function(){return _0x54aec0['textures'][0x1];},'uTexAtlasDim':function(){let _0xfe6a88=_0x54aec0['textures'][0x0]['renderable']?_0x54aec0['textures'][0x0]:_0x54aec0['ancestorTexture']?_0x54aec0['ancestorTexture']:_0x54aec0['textures'][0x0];_0x8d075e['x']=_0xfe6a88['width'],_0x8d075e['y']=_0xfe6a88['height'];if(_0x54aec0['textures'][0x1]){let _0x433648=_0x54aec0['textures'][0x1]['renderable']?_0x54aec0['textures'][0x1]:_0x54aec0['ancestorTextureBake']?_0x54aec0['ancestorTextureBake']:_0x54aec0['textures'][0x1];_0x8d075e['z']=_0x433648['width'],_0x8d075e['w']=_0x433648['height'];}return _0x8d075e;},'batchTextureAtlas':function(){return _0x54aec0['batchTable']['_texture'];},'batchTextureAtlasStep':function(){return _0x54aec0['batchTable']['_textureStep'];},'batchTextureAtlasSec':function(){return _0x54aec0['batchTableBake']['_texture'];},'batchTextureAtlasStepSec':function(){return _0x54aec0['batchTableBake']['_textureStep'];},'uTexture0Width':function(){return _0x54aec0['textures'][0x0]['width'];},'uTexture1Width':function(){return _0x54aec0['textures'][0x1]['width'];},'uBaseColorTextureIndex':function(){if(_0xa29204['_baseColorTextureIndex']>-0x1)return _0xa29204['_baseColorTextureIndex'];return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTextureIndex'];},'uBaseColorFactor':function(){return _0xa29204['_baseColor']||_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['baseColor'];},'uMetallicFactor':function(){return _0xa29204['_metallicFactor']||_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['metallicFactor'];},'uRoughnessFactor':function(){return Cesium['defaultValue'](_0xa29204['_roughnessFactor'],_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['roughnessFactor']);},'uEmissiveFactor':function(){return _0xa29204['_emissiveFactor']||_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveFactor'];},'uEmissionTexture':function(){if(_0x5eda2a(_0xa29204['emissiveTexture']))return _0xa29204['emissiveTexture'];var _0x5940f9=_0xa29204['_emissiveTextureIndex'];if(_0x5940f9>-0x1&&_0x5eda2a(_0xa29204['_textures'][_0x5940f9]))return _0xa29204['_textures'][_0x5940f9];return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveTexture'];},'uMetallicRoughnessTexture':function(){if(_0x5eda2a(_0xa29204['_metallicRoughnessTextureIndex'])&&_0xa29204['_metallicRoughnessTextureIndex']>-0x1){if(_0x5eda2a(_0xa29204['metallicRoughnessTexture']))return _0xa29204['metallicRoughnessTexture'];return _0xa29204['_textures'][_0xa29204['_metallicRoughnessTextureIndex']];}return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['metallicRoughnessTexture'];},'uNormalTexture':function(){if(_0x5eda2a(_0xa29204['_normalTextureIndex'])&&_0xa29204['_normalTextureIndex']>-0x1){if(_0xa29204['normalTexture'])return _0xa29204['normalTexture'];return _0xa29204['_textures'][_0xa29204['_normalTextureIndex']];}return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['normalTexture'];},'uNormalTextureScale':function(){if(_0x5eda2a(_0xa29204['_normalTextureScale']))return _0xa29204['_normalTextureScale'];return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['normalTextureScale'];},'uOcclusionTexture':function(){if(_0x5eda2a(_0xa29204['_occlusionTextureIndex'])&&_0xa29204['_occlusionTextureIndex']>-0x1){if(_0xa29204['occlusionTexture'])return _0xa29204['occlusionTexture'];return _0xa29204['_textures'][_0xa29204['_occlusionTextureIndex']];}return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['occlusionTexture'];},'uIndexOfRefraction':function(){if(_0x5eda2a(_0xa29204['_indexOfRefraction'])&&_0xa29204['_indexOfRefraction']>0x0)return _0xa29204['_indexOfRefraction'];return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['indexOfRefraction'];},'uTransmissionFactor':function(){if(_0x5eda2a(_0xa29204['_transmissionFactor'])&&_0xa29204['_transmissionFactor']>0x0)return _0xa29204['_transmissionFactor'];if(_0x5eda2a(_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['volume'])&&_0x5eda2a(_0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor']))return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor'];return 0x1;},'uBaseTexture':function(){if(_0x5eda2a(_0xa29204['_baseColorTextureIndex'])&&_0xa29204['_baseColorTextureIndex']>-0x1)return _0xa29204['baseColorTexture'];return _0x229299['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTexture'];},'decodePositionMin':function(){const _0x1ce8e6=_0x2929f1['vertexPackage']['minVerticesValue'];return _0x1ce8e6;},'decodePositionNormConstant':function(){return _0x2929f1['vertexPackage']['vertCompressConstant'];}};Object['assign'](_0x34cc27,_0x185fc3(_0x229299));let _0x14552b=_0x2929f1['vertexPackage']['minTexCoordValue'];return _0x14552b&&_0x14552b['length']>0x0&&(_0x34cc27['decodeTexCoord0vNormConstant']=function(){return _0x2929f1['vertexPackage']['texCoordCompressConstant'][0x0];},_0x34cc27['decodeTexCoord1vNormConstant']=function(){return _0x2929f1['vertexPackage']['texCoordCompressConstant'][0x1];},_0x34cc27['decodeTexCoord0Min']=function(){return _0x2929f1['vertexPackage']['minTexCoordValue'][0x0];}),_0x34cc27;}_0x2a6bbb['prototype']['createOneEdgeCommand']=function(_0x1440be,_0x2a672b,_0x4d9ce8,_0x177b17,_0x4085d4){if(!_0x4d9ce8['attributes']||_0x4d9ce8['attributes']['length']==0x0||!_0x4d9ce8['instanceCount']||_0x4d9ce8['instanceCount']===0x0)return null;let _0x78a91c=new Cesium['DrawCommand']({'primitiveType':Cesium['PrimitiveType']['TRIANGLES'],'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pass':Cesium['Pass']['CESIUM_3D_TILE'],'owner':this,'cull':!![]});this['edgeVA']=new Cesium['VertexArray']({'context':_0x1440be,'attributes':_0x4d9ce8['attributes'],'indexBuffer':_0x177b17}),_0x78a91c['vertexArray']=this['edgeVA'],_0x78a91c['instanceCount']=_0x4d9ce8['instanceCount'];let _0x34856c,_0x1c99ac;_0x34856c=new Cesium['ShaderSource']({'sources':[_0x710df4]}),_0x1c99ac=new Cesium['ShaderSource']({'sources':[_0x376e51]});!_0x4085d4&&(_0x34856c['defines']['push']('SILHOUETTE'),_0x1c99ac['defines']['push']('SILHOUETTE'));_0x34856c['defines']['push']('ANTIALIASING'),_0x1c99ac['defines']['push']('ANTIALIASING'),_0x34856c['defines']['push']('POLYGON_OFFSET'),_0x1c99ac['defines']['push']('POLYGON_OFFSET');_0x2a672b['swipeEnabled']&&_0x1c99ac['defines']['push'](ProgramDefines['APPLY_SWIPE']);_0x2a672b['_enableClip']&&_0x1c99ac['defines']['push']('CLIP');_0x2a672b['_enableClipPlane']&&_0x1c99ac['defines']['push']('CLIPPLANE');_0x2a672b['_hasExcavation']&&(_0x34856c['defines']['push'](ProgramDefines['EXCAVATION']),_0x1c99ac['defines']['push'](ProgramDefines['EXCAVATION']));let _0x13b5af=0x0;_0x34856c['defines']['push']('MODE\x20'+_0x13b5af),_0x1c99ac['defines']['push']('MODE\x20'+_0x13b5af),this['edgeSP']=Cesium['ShaderProgram']['fromCache']({'context':_0x1440be,'vertexShaderSource':_0x34856c,'fragmentShaderSource':_0x1c99ac,'attributeLocations':_0x4d9ce8['attributeLocations']}),_0x78a91c['shaderProgram']=this['edgeSP'],_0x78a91c['renderState']=Cesium['RenderState']['fromCache']({'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'cull':{'enabled':!![]},'blending':Cesium['BlendingState']['ALPHA_BLEND']});let _0x1a6dba={'uLineColor':function(){return _0x2a672b['style3D']['lineColor'];},'uLineWidth':function(){return _0x2a672b['style3D']['lineWidth'];},'uDistanceFalloffFactor':function(){return _0x2a672b['_edgeDistanceFalloffFactor'];},'u_polygonOffset':function(){return new Cesium['Cartesian2'](-0x5,-0x5);}};return _0x78a91c['uniformMap']=Cesium['combine'](_0x1a6dba,this['colorCommand']['uniformMap']),_0x78a91c['edgeTotalLength']=_0x4d9ce8['edgeLength'],_0x78a91c['edgeCount']=_0x4d9ce8['instanceCount'],_0x78a91c;},_0x2a6bbb['prototype']['createCommand']=function(){if(Cesium['defined'](this['colorCommand'])||this['vertexBufferToCreate']['length']!==0x0||this['indexBufferToCreate']['length']!==0x0||this['shaderProgramToCreate']['length']!==0x0)return;let _0x4917e2=this['layer'],_0x7c96db=_0x4917e2['context'],_0x43066e=this['vertexPackage'],_0x4b0985=this['arrIndexPackage'],_0x333351=_0x43066e['vertexAttributes'];if(_0x4b0985['length']<0x1)return;let _0x2c314c=_0x4b0985[0x0],_0x354e9b=this['material'];this['vertexArray']=new Cesium['VertexArray']({'context':_0x7c96db,'attributes':_0x333351,'indexBuffer':_0x2c314c['indexBuffer']});let _0x2e1ea5=Cesium['PrimitiveType']['TRIANGLES'];switch(_0x2c314c['primitiveType']){case 0x1:_0x2e1ea5=Cesium['PrimitiveType']['POINTS'];break;case 0x2:_0x2e1ea5=Cesium['PrimitiveType']['LINES'];break;case 0x4:_0x2e1ea5=Cesium['PrimitiveType']['TRIANGLES'];break;default:break;}this['useLineColor']=_0x2e1ea5===Cesium['PrimitiveType']['LINES'];let _0x2b4902=![];if(_0x354e9b['alphaMode']===_0x150068['MASK']||_0x354e9b['alphaMode']===_0x150068['BLEND'])_0x2b4902=!![];else _0x4917e2['_isTransparencyOptimization']&&_0x354e9b['bTransparentSorting']&&(_0x2b4902=!![]);this['colorCommand']=new Cesium['DrawCommand']({'primitiveType':_0x2e1ea5,'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pickId':this['pickColorIdentifier'],'vertexArray':this['vertexArray'],'shaderProgram':this['shaderProgram'],'pass':_0x2b4902?Cesium['Pass']['TRANSLUCENT']:Cesium['Pass']['CESIUM_3D_TILE'],'renderState':_0x354e9b['bTransparentSorting']?_0x5306f9():_0xc20fec(),'instanceCount':_0x43066e['instanceCount']});let _0x4a559c=_0xef4837(_0x354e9b,_0x4917e2,this);this['batchTable']&&(_0x4a559c=this['batchTable']['getUniformMapCallback']()(_0x4a559c)),_0x354e9b['batchTable']&&(_0x4a559c=_0x354e9b['batchTable']['getUniformMapCallback']()(_0x4a559c)),this['colorCommand']['uniformMap']=_0x4a559c,this['vs']=undefined,this['fs']=undefined,this['ready']=!![];},_0x2a6bbb['prototype']['createWireFrame']=function(_0xd28d12){if(!this['colorCommand']||!this['edgeGeometry']||this['regularEdgeCommand'])return;let _0x208fd0=this['layer']['context'],_0x1e6e40=this['edgeGeometry'];_0x1e6526['createRegularEdgeAttributes'](_0x208fd0,_0x1e6e40['regular']),_0x1e6526['createSilhouetteEdgeAttributes'](_0x208fd0,_0x1e6e40['silhouette']);let _0x3f628a=_0x1e6526['createIndexBuffer'](_0x208fd0);this['regularEdgeCommand']=this['createOneEdgeCommand'](_0x208fd0,this['layer'],_0x1e6e40['regular'],_0x3f628a,!![]),this['silhouetteEdgeCommand']=this['createOneEdgeCommand'](_0x208fd0,this['layer'],_0x1e6e40['silhouette'],_0x3f628a,![]);};let _0x39ebba=new _0x126a10();_0x2a6bbb['prototype']['updateMaterialBatchTable']=function(_0x58de4d){this['material']['initTexture'](),this['material']['requestSubTextures'](_0x58de4d,this['layer']);let _0x1a4a22=this['material']['subTexturesToUpload'];while(_0x1a4a22['length']){let _0x466b30=_0x1a4a22['peek'](),_0x170b2e=_0x466b30['texture'],_0x183eed=_0x466b30['subTextureInfo'];_0x39ebba['set'](_0x58de4d['context'],this,_0x170b2e,_0x183eed);if(!_0x58de4d['jobScheduler']['execute'](_0x39ebba,Cesium['JobType']['TEXTURE']))break;_0x1a4a22['dequeue']();}_0x1a4a22['length']===0x0&&this['material']['enableTextureRenderable'](),this['material']['batchTable']['update'](_0x58de4d);},_0x2a6bbb['prototype']['transformResource']=function(_0x47bd13,_0x28f9ff){if(this['ready'])return;this['createBatchTable'](_0x47bd13),this['createPickIds'](),this['createBuffers'](_0x47bd13),this['createShaderProgram'](_0x47bd13),this['createCommand'](_0x47bd13),this['createWireFrame'](_0x47bd13),this['initLayerSetting'](_0x28f9ff);},_0x2a6bbb['prototype']['update']=function(_0x138005,_0x565d2f){this['batchTableDirty']&&(this['updateBatchTableAttributes'](),this['batchTableDirty']=![]),this['batchTable']&&this['batchTable']['update'](_0x138005),this['material']['batchTable']&&this['updateMaterialBatchTable'](_0x138005),_0x565d2f['style3D']['fillStyle']!==_0x4af9d4['WireFrame']&&_0x138005['commandList']['push'](this['colorCommand']),_0x565d2f['style3D']['fillStyle']!==_0x4af9d4['Fill']&&(this['regularEdgeCommand']&&(_0x138005['commandList']['push'](this['regularEdgeCommand']),_0x565d2f['_addRenderedEdge'](this['regularEdgeCommand']['edgeTotalLength'],this['regularEdgeCommand']['edgeCount'])),this['silhouetteEdgeCommand']&&(_0x138005['commandList']['push'](this['silhouetteEdgeCommand']),_0x565d2f['_addRenderedEdge'](this['silhouetteEdgeCommand']['edgeTotalLength'],this['silhouetteEdgeCommand']['edgeCount'])));},_0x2a6bbb['prototype']['isDestroyed']=function(){return![];},_0x2a6bbb['prototype']['destroy']=function(){return this['shaderProgram']=this['shaderProgram']&&!this['shaderProgram']['isDestroyed']()&&this['shaderProgram']['destroy'](),this['vertexArray']=this['vertexArray']&&!this['vertexArray']['isDestroyed']()&&this['vertexArray']['destroy'](),this['material']=this['material']&&!this['material']['isDestroyed']()&&this['material']['destroy'](),this['batchTable']=this['batchTable']&&!this['batchTable']['isDestroyed']()&&this['batchTable']['destroy'](),this['edgeVA']=this['edgeVA']&&!this['edgeVA']['isDestroyed']()&&this['edgeVA']['destroy'](),this['edgeSP']=this['edgeSP']&&!this['edgeSP']['isDestroyed']()&&this['edgeSP']['destroy'](),this['colorCommand']=undefined,this['vertexPackage']=null,this['arrIndexPackage']=null,this['modelMatrix']=undefined,this['pickInfo']=undefined,this['selectionInfoMap']=undefined,this['vs']=undefined,this['fs']=undefined,Cesium['destroyObject'](this);};export default _0x2a6bbb;