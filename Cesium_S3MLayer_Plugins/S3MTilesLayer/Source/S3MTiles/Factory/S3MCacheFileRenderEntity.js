const _0x32ca6f=(function(){let _0x4bdbc1=!![];return function(_0x540854,_0x336c54){const _0x1692c6=_0x4bdbc1?function(){if(_0x336c54){const _0x3eeb44=_0x336c54['apply'](_0x540854,arguments);return _0x336c54=null,_0x3eeb44;}}:function(){};return _0x4bdbc1=![],_0x1692c6;};}()),_0x5c813e=_0x32ca6f(this,function(){return _0x5c813e['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x5c813e)['search']('(((.+)+)+)+$');});_0x5c813e();import _0x14e791 from'../Shaders/S3MTilesVS.js';import _0xf49bf9 from'../Shaders/S3MTilesFS.js';import _0x1df229 from'./RenderEntity.js';import _0x3dbc23 from'../S3MEdgeProcessor.js';import _0x49d9f8 from'../Shaders/ModelEdgeVp.js';import _0x3f2052 from'../Shaders/ModelEdgeFp.js';import _0x26f229 from'../Enum/FillStyle.js';import _0x35714b from'../SubTextureUploadJob.js';import _0x3099d2 from'../Enum/AlphaMode.js';import _0x2fe63b from'../getComUniformMap.js';const _0x1b9126=Cesium['defined'];function _0x3cb19f(_0x265797){_0x1df229['call'](this,_0x265797),this['vs']=_0x14e791,this['fs']=_0xf49bf9,this['edgeVA']=undefined,this['edgeSP']=undefined,this['regularEdgeCommand']=undefined,this['silhouetteEdgeCommand']=undefined,this['useLineColor']=![];}_0x3cb19f['prototype']=Object['create'](_0x1df229['prototype']),_0x3cb19f['prototype']['constructor']=_0x1df229;function _0x1adb70(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND'],'stencilTest':{'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium['StencilOperation']['KEEP'],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium['StencilOperation']['REPLACE']},'mask':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK'],'reference':Cesium['StencilConstants']['CESIUM_3D_TILE_MASK']}});}function _0x3929a5(){return Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'blending':Cesium['BlendingState']['ALPHA_BLEND']});}let _0xfb7284=new Cesium['Cartesian4'](),_0x4f1ac7=new Cesium['Cartesian4'](),_0x311047=new Cesium['Cartesian4'](),_0x5b50c2=new Cesium['Cartesian4'](),_0x5db19c=new Cesium['Color'](),_0x216da5=new Cesium['Color']();function _0x2fa9de(_0x2e504f,_0x985059,_0x28569b){var _0x2684b2=_0x28569b['materialPass']||{};let _0x42fbb2={'uGeoMatrix':function(){return _0x28569b['geoMatrix'];},'uTexMatrix':function(){return _0x2e504f['texMatrix'];},'uFillForeColor':function(){if(_0x28569b['useLineColor'])return _0x985059['style3D']['lineColor'];return _0x985059['style3D']['fillForeColor'];},'uDiffuseColor':function(){return _0x2e504f['diffuseColor'];},'uAmbientColor':function(){return _0x2e504f['ambientColor'];},'uInverseGeoMatrix':function(){return _0x28569b['invGeoMatrix'];},'uTexture':function(){let _0x548b0d=_0x2e504f['textures'][0x0];if(_0x548b0d['isTexBlock'])return _0x548b0d['renderable']&&_0x548b0d['ready']?_0x548b0d:_0x2e504f['ancestorTexture']?_0x2e504f['ancestorTexture']:_0x548b0d;return _0x2e504f['textures'][0x0];},'uTexture2':function(){return _0x2e504f['textures'][0x1];},'uTexAtlasDim':function(){let _0x51ece6=_0x2e504f['textures'][0x0]['renderable']?_0x2e504f['textures'][0x0]:_0x2e504f['ancestorTexture']?_0x2e504f['ancestorTexture']:_0x2e504f['textures'][0x0];_0x5b50c2['x']=_0x51ece6['width'],_0x5b50c2['y']=_0x51ece6['height'];if(_0x2e504f['textures'][0x1]){let _0x2288ae=_0x2e504f['textures'][0x1]['renderable']?_0x2e504f['textures'][0x1]:_0x2e504f['ancestorTextureBake']?_0x2e504f['ancestorTextureBake']:_0x2e504f['textures'][0x1];_0x5b50c2['z']=_0x2288ae['width'],_0x5b50c2['w']=_0x2288ae['height'];}return _0x5b50c2;},'batchTextureAtlas':function(){return _0x2e504f['batchTable']['_texture'];},'batchTextureAtlasStep':function(){return _0x2e504f['batchTable']['_textureStep'];},'batchTextureAtlasSec':function(){return _0x2e504f['batchTableBake']['_texture'];},'batchTextureAtlasStepSec':function(){return _0x2e504f['batchTableBake']['_textureStep'];},'uTexture0Width':function(){return _0x2e504f['textures'][0x0]['width'];},'uTexture1Width':function(){return _0x2e504f['textures'][0x1]['width'];},'uBaseColorTextureIndex':function(){if(_0x2684b2['_baseColorTextureIndex']>-0x1)return _0x2684b2['_baseColorTextureIndex'];return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTextureIndex'];},'uBaseColorFactor':function(){return _0x2684b2['_baseColor']||_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['baseColor'];},'uMetallicFactor':function(){return _0x2684b2['_metallicFactor']||_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['metallicFactor'];},'uRoughnessFactor':function(){return Cesium['defaultValue'](_0x2684b2['_roughnessFactor'],_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['roughnessFactor']);},'uEmissiveFactor':function(){return _0x2684b2['_emissiveFactor']||_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveFactor'];},'uEmissionTexture':function(){if(_0x1b9126(_0x2684b2['emissiveTexture']))return _0x2684b2['emissiveTexture'];var _0x4b6f34=_0x2684b2['_emissiveTextureIndex'];if(_0x4b6f34>-0x1&&_0x1b9126(_0x2684b2['_textures'][_0x4b6f34]))return _0x2684b2['_textures'][_0x4b6f34];return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['emissiveTexture'];},'uMetallicRoughnessTexture':function(){if(_0x1b9126(_0x2684b2['_metallicRoughnessTextureIndex'])&&_0x2684b2['_metallicRoughnessTextureIndex']>-0x1){if(_0x1b9126(_0x2684b2['metallicRoughnessTexture']))return _0x2684b2['metallicRoughnessTexture'];return _0x2684b2['_textures'][_0x2684b2['_metallicRoughnessTextureIndex']];}return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['metallicRoughnessTexture'];},'uNormalTexture':function(){if(_0x1b9126(_0x2684b2['_normalTextureIndex'])&&_0x2684b2['_normalTextureIndex']>-0x1){if(_0x2684b2['normalTexture'])return _0x2684b2['normalTexture'];return _0x2684b2['_textures'][_0x2684b2['_normalTextureIndex']];}return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['normalTexture'];},'uNormalTextureScale':function(){if(_0x1b9126(_0x2684b2['_normalTextureScale']))return _0x2684b2['_normalTextureScale'];return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['normalTextureScale'];},'uOcclusionTexture':function(){if(_0x1b9126(_0x2684b2['_occlusionTextureIndex'])&&_0x2684b2['_occlusionTextureIndex']>-0x1){if(_0x2684b2['occlusionTexture'])return _0x2684b2['occlusionTexture'];return _0x2684b2['_textures'][_0x2684b2['_occlusionTextureIndex']];}return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['occlusionTexture'];},'uIndexOfRefraction':function(){if(_0x1b9126(_0x2684b2['_indexOfRefraction'])&&_0x2684b2['_indexOfRefraction']>0x0)return _0x2684b2['_indexOfRefraction'];return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['indexOfRefraction'];},'uTransmissionFactor':function(){if(_0x1b9126(_0x2684b2['_transmissionFactor'])&&_0x2684b2['_transmissionFactor']>0x0)return _0x2684b2['_transmissionFactor'];if(_0x1b9126(_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['volume'])&&_0x1b9126(_0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor']))return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['volume']['transmissionFactor'];return 0x1;},'uBaseTexture':function(){if(_0x1b9126(_0x2684b2['_baseColorTextureIndex'])&&_0x2684b2['_baseColorTextureIndex']>-0x1)return _0x2684b2['baseColorTexture'];return _0x985059['_PBRMaterialParams']['pbrMetallicRoughness']['baseColorTexture'];},'decodePositionMin':function(){const _0x546f59=_0x28569b['vertexPackage']['minVerticesValue'];return _0x546f59;},'decodePositionNormConstant':function(){return _0x28569b['vertexPackage']['vertCompressConstant'];}};Object['assign'](_0x42fbb2,_0x2fe63b(_0x985059));let _0x5317ec=_0x28569b['vertexPackage']['minTexCoordValue'];return _0x5317ec&&_0x5317ec['length']>0x0&&(_0x42fbb2['decodeTexCoord0vNormConstant']=function(){return _0x28569b['vertexPackage']['texCoordCompressConstant'][0x0];},_0x42fbb2['decodeTexCoord1vNormConstant']=function(){return _0x28569b['vertexPackage']['texCoordCompressConstant'][0x1];},_0x42fbb2['decodeTexCoord0Min']=function(){return _0x28569b['vertexPackage']['minTexCoordValue'][0x0];}),_0x42fbb2;}_0x3cb19f['prototype']['createOneEdgeCommand']=function(_0x13a6ff,_0x5da473,_0x1611ab,_0x3db4d8,_0x3b9009){if(!_0x1611ab['attributes']||_0x1611ab['attributes']['length']==0x0||!_0x1611ab['instanceCount']||_0x1611ab['instanceCount']===0x0)return null;let _0x1a9df0=new Cesium['DrawCommand']({'primitiveType':Cesium['PrimitiveType']['TRIANGLES'],'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pass':Cesium['Pass']['CESIUM_3D_TILE'],'owner':this,'cull':!![]});this['edgeVA']=new Cesium['VertexArray']({'context':_0x13a6ff,'attributes':_0x1611ab['attributes'],'indexBuffer':_0x3db4d8}),_0x1a9df0['vertexArray']=this['edgeVA'],_0x1a9df0['instanceCount']=_0x1611ab['instanceCount'];let _0x4c7404,_0x31df99;_0x4c7404=new Cesium['ShaderSource']({'sources':[_0x49d9f8]}),_0x31df99=new Cesium['ShaderSource']({'sources':[_0x3f2052]});!_0x3b9009&&(_0x4c7404['defines']['push']('SILHOUETTE'),_0x31df99['defines']['push']('SILHOUETTE'));_0x4c7404['defines']['push']('ANTIALIASING'),_0x31df99['defines']['push']('ANTIALIASING'),_0x4c7404['defines']['push']('POLYGON_OFFSET'),_0x31df99['defines']['push']('POLYGON_OFFSET');_0x5da473['swipeEnabled']&&_0x31df99['defines']['push'](ProgramDefines['APPLY_SWIPE']);_0x5da473['_enableClip']&&_0x31df99['defines']['push']('CLIP');_0x5da473['_enableClipPlane']&&_0x31df99['defines']['push']('CLIPPLANE');_0x5da473['_hasExcavation']&&(_0x4c7404['defines']['push'](ProgramDefines['EXCAVATION']),_0x31df99['defines']['push'](ProgramDefines['EXCAVATION']));let _0x1a32ec=0x0;_0x4c7404['defines']['push']('MODE\x20'+_0x1a32ec),_0x31df99['defines']['push']('MODE\x20'+_0x1a32ec),this['edgeSP']=Cesium['ShaderProgram']['fromCache']({'context':_0x13a6ff,'vertexShaderSource':_0x4c7404,'fragmentShaderSource':_0x31df99,'attributeLocations':_0x1611ab['attributeLocations']}),_0x1a9df0['shaderProgram']=this['edgeSP'],_0x1a9df0['renderState']=Cesium['RenderState']['fromCache']({'depthTest':{'enabled':!![],'func':Cesium['DepthFunction']['LESS_OR_EQUAL']},'cull':{'enabled':!![]},'blending':Cesium['BlendingState']['ALPHA_BLEND']});let _0x4db0fd={'uLineColor':function(){return _0x5da473['style3D']['lineColor'];},'uLineWidth':function(){return _0x5da473['style3D']['lineWidth'];},'uDistanceFalloffFactor':function(){return _0x5da473['_edgeDistanceFalloffFactor'];},'u_polygonOffset':function(){return new Cesium['Cartesian2'](-0x5,-0x5);}};return _0x1a9df0['uniformMap']=Cesium['combine'](_0x4db0fd,this['colorCommand']['uniformMap']),_0x1a9df0['edgeTotalLength']=_0x1611ab['edgeLength'],_0x1a9df0['edgeCount']=_0x1611ab['instanceCount'],_0x1a9df0;},_0x3cb19f['prototype']['createCommand']=function(){if(Cesium['defined'](this['colorCommand'])||this['vertexBufferToCreate']['length']!==0x0||this['indexBufferToCreate']['length']!==0x0||this['shaderProgramToCreate']['length']!==0x0)return;let _0xec6a91=this['layer'],_0x44732e=_0xec6a91['context'],_0x23e382=this['vertexPackage'],_0x19bd35=this['arrIndexPackage'],_0x21bea8=_0x23e382['vertexAttributes'];if(_0x19bd35['length']<0x1)return;let _0x4826e8=_0x19bd35[0x0],_0x174a4a=this['material'];this['vertexArray']=new Cesium['VertexArray']({'context':_0x44732e,'attributes':_0x21bea8,'indexBuffer':_0x4826e8['indexBuffer']});let _0x195675=Cesium['PrimitiveType']['TRIANGLES'];switch(_0x4826e8['primitiveType']){case 0x1:_0x195675=Cesium['PrimitiveType']['POINTS'];break;case 0x2:_0x195675=Cesium['PrimitiveType']['LINES'];break;case 0x4:_0x195675=Cesium['PrimitiveType']['TRIANGLES'];break;default:break;}this['useLineColor']=_0x195675===Cesium['PrimitiveType']['LINES'];let _0x368006=![];if(_0x174a4a['alphaMode']===_0x3099d2['MASK']||_0x174a4a['alphaMode']===_0x3099d2['BLEND'])_0x368006=!![];else _0xec6a91['_isTransparencyOptimization']&&_0x174a4a['bTransparentSorting']&&(_0x368006=!![]);this['colorCommand']=new Cesium['DrawCommand']({'primitiveType':_0x195675,'modelMatrix':this['modelMatrix'],'boundingVolume':this['boundingVolume'],'pickId':this['pickColorIdentifier'],'vertexArray':this['vertexArray'],'shaderProgram':this['shaderProgram'],'pass':_0x368006?Cesium['Pass']['TRANSLUCENT']:Cesium['Pass']['CESIUM_3D_TILE'],'renderState':_0x174a4a['bTransparentSorting']?_0x3929a5():_0x1adb70(),'instanceCount':_0x23e382['instanceCount']});let _0x395012=_0x2fa9de(_0x174a4a,_0xec6a91,this);this['batchTable']&&(_0x395012=this['batchTable']['getUniformMapCallback']()(_0x395012)),_0x174a4a['batchTable']&&(_0x395012=_0x174a4a['batchTable']['getUniformMapCallback']()(_0x395012)),this['colorCommand']['uniformMap']=_0x395012,this['vs']=undefined,this['fs']=undefined,this['ready']=!![];},_0x3cb19f['prototype']['createWireFrame']=function(_0x35ebac){if(!this['colorCommand']||!this['edgeGeometry']||this['regularEdgeCommand'])return;let _0x3a71be=this['layer']['context'],_0xb1e169=this['edgeGeometry'];_0x3dbc23['createRegularEdgeAttributes'](_0x3a71be,_0xb1e169['regular']),_0x3dbc23['createSilhouetteEdgeAttributes'](_0x3a71be,_0xb1e169['silhouette']);let _0x4b1642=_0x3dbc23['createIndexBuffer'](_0x3a71be);this['regularEdgeCommand']=this['createOneEdgeCommand'](_0x3a71be,this['layer'],_0xb1e169['regular'],_0x4b1642,!![]),this['silhouetteEdgeCommand']=this['createOneEdgeCommand'](_0x3a71be,this['layer'],_0xb1e169['silhouette'],_0x4b1642,![]);};let _0x480d16=new _0x35714b();_0x3cb19f['prototype']['updateMaterialBatchTable']=function(_0x8a07cd){this['material']['initTexture'](),this['material']['requestSubTextures'](_0x8a07cd,this['layer']);let _0x4098b2=this['material']['subTexturesToUpload'];while(_0x4098b2['length']){let _0x1dcc4a=_0x4098b2['peek'](),_0x11d15a=_0x1dcc4a['texture'],_0x271333=_0x1dcc4a['subTextureInfo'];_0x480d16['set'](_0x8a07cd['context'],this,_0x11d15a,_0x271333);if(!_0x8a07cd['jobScheduler']['execute'](_0x480d16,Cesium['JobType']['TEXTURE']))break;_0x4098b2['dequeue']();}_0x4098b2['length']===0x0&&this['material']['enableTextureRenderable'](),this['material']['batchTable']['update'](_0x8a07cd);},_0x3cb19f['prototype']['transformResource']=function(_0x4339f4,_0x52c0b5){if(this['ready'])return;this['createBatchTable'](_0x4339f4),this['createPickIds'](),this['createBuffers'](_0x4339f4),this['createShaderProgram'](_0x4339f4),this['createCommand'](_0x4339f4),this['createWireFrame'](_0x4339f4),this['initLayerSetting'](_0x52c0b5);},_0x3cb19f['prototype']['update']=function(_0x317756,_0x380087){this['batchTableDirty']&&(this['updateBatchTableAttributes'](),this['batchTableDirty']=![]),this['batchTable']&&this['batchTable']['update'](_0x317756),this['material']['batchTable']&&this['updateMaterialBatchTable'](_0x317756),_0x380087['style3D']['fillStyle']!==_0x26f229['WireFrame']&&_0x317756['commandList']['push'](this['colorCommand']),_0x380087['style3D']['fillStyle']!==_0x26f229['Fill']&&(this['regularEdgeCommand']&&(_0x317756['commandList']['push'](this['regularEdgeCommand']),_0x380087['_addRenderedEdge'](this['regularEdgeCommand']['edgeTotalLength'],this['regularEdgeCommand']['edgeCount'])),this['silhouetteEdgeCommand']&&(_0x317756['commandList']['push'](this['silhouetteEdgeCommand']),_0x380087['_addRenderedEdge'](this['silhouetteEdgeCommand']['edgeTotalLength'],this['silhouetteEdgeCommand']['edgeCount'])));},_0x3cb19f['prototype']['isDestroyed']=function(){return![];},_0x3cb19f['prototype']['destroy']=function(){return this['shaderProgram']=this['shaderProgram']&&!this['shaderProgram']['isDestroyed']()&&this['shaderProgram']['destroy'](),this['vertexArray']=this['vertexArray']&&!this['vertexArray']['isDestroyed']()&&this['vertexArray']['destroy'](),this['material']=this['material']&&!this['material']['isDestroyed']()&&this['material']['destroy'](),this['batchTable']=this['batchTable']&&!this['batchTable']['isDestroyed']()&&this['batchTable']['destroy'](),this['edgeVA']=this['edgeVA']&&!this['edgeVA']['isDestroyed']()&&this['edgeVA']['destroy'](),this['edgeSP']=this['edgeSP']&&!this['edgeSP']['isDestroyed']()&&this['edgeSP']['destroy'](),this['colorCommand']=undefined,this['vertexPackage']=null,this['arrIndexPackage']=null,this['modelMatrix']=undefined,this['pickInfo']=undefined,this['selectionInfoMap']=undefined,this['vs']=undefined,this['fs']=undefined,Cesium['destroyObject'](this);};export default _0x3cb19f;