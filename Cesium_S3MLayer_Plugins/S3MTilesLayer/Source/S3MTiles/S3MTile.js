const _0x76d736=(function(){let _0x46e6f9=!![];return function(_0x38757b,_0x58a0b8){const _0x2a2766=_0x46e6f9?function(){if(_0x58a0b8){const _0x472416=_0x58a0b8['apply'](_0x38757b,arguments);return _0x58a0b8=null,_0x472416;}}:function(){};return _0x46e6f9=![],_0x2a2766;};}()),_0x5a5254=_0x76d736(this,function(){return _0x5a5254['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x5a5254)['search']('(((.+)+)+)+$');});_0x5a5254();import _0x3d5abb from'./Enum/ContentState.js';import _0xf36016 from'./S3ModelParser.js';import _0x1d605d from'./S3ModelOldParser.js';import _0x47fe9e from'./S3MBlockParser.js';import _0x4bdc38 from'./S3MContentParser.js';import _0x568e05 from'./S3MBlockContentParser.js';import _0x14e315 from'./Enum/RangeMode.js';import _0xee9f6b from'../ThirdParty/defer.js';import _0x2cff55 from'../Credential/Credential.js';import _0x3c311d from'./S3MPageLod.js';const _0x181afd=Cesium['defined'];function _0x1ccd4d(_0x4ceb45,_0x23380b,_0x2342b0,_0x40b7c1){this['layer']=_0x4ceb45,this['parent']=_0x23380b;let _0x5b8e36=_0x40b7c1['replace'](/\\/g,'/');this['fileExtension']=Cesium['getExtensionFromUri'](_0x40b7c1),this['relativePath']=_0x24b9c4(_0x5b8e36,_0x4ceb45),this['fileName']=_0x40b7c1,this['isLeafTile']=![],this['isRootTile']=![],this['boundingVolume']=this['createBoundingVolume'](_0x2342b0,_0x4ceb45['modelMatrix']);let _0x5603b0=Cesium['Resource']['createIfNeeded'](_0x4ceb45['_baseResource']);if(Cesium['defined'](_0x23380b))this['baseUri']=_0x23380b['baseUri'];else{let _0x4d8a5a=new Cesium['Resource'](_0x5b8e36);this['baseUri']=_0x4d8a5a['getBaseUri']();}this['contentResource']=_0x5603b0['getDerivedResource']({'url':this['relativePath']}),this['serverKey']=Cesium['RequestScheduler']['getServerKey'](this['contentResource']['getUrlComponent']()),this['request']=undefined,this['cacheNode']=undefined,this['distanceToCamera']=0x0,this['centerZDepth']=0x0,this['depth']=_0x23380b?_0x23380b['depth']+0x1:0x0,this['visibilityPlaneMask']=0x0,this['visible']=![],this['pageLods']=[],this['renderEntities']=[],this['contentState']=_0x3d5abb['UNLOADED'],this['touchedFrame']=0x0,this['requestedFrame']=0x0,this['processFrame']=0x0,this['updatedVisibilityFrame']=0x0,this['foveatedFactor']=0x0,this['priority']=0x0,this['rootName']=!_0x23380b?this['fileName']:_0x23380b['rootName'],this['blockKey']='',this['isAncestorBlock']=![],this['isChildBlock']=![],this['rootBatchIdMap']={},this['ancestorMap']={};}let _0xe2473d=new Cesium['Cartesian3']();function _0x3452d3(_0x48b69e,_0x16c26a){let _0x291b56=Cesium['Cartesian3']['clone'](_0x48b69e['center']),_0x443a48=_0x48b69e['radius'];_0x291b56=Cesium['Matrix4']['multiplyByPoint'](_0x16c26a,_0x291b56,_0x291b56);let _0x53aee1=Cesium['Matrix4']['getScale'](_0x16c26a,_0xe2473d),_0x8990ce=Cesium['Cartesian3']['maximumComponent'](_0x53aee1);return _0x443a48*=_0x8990ce,new Cesium['TileBoundingSphere'](_0x291b56,_0x443a48);}function _0x24b9c4(_0x1fd771,_0x15f005){_0x1fd771=_0x1fd771['replace'](/\+/g,'%2B');let _0xce48e2=_0x15f005['_basePath'],_0x445658=_0x15f005['_basePath']['indexOf']('realspace')>-0x1;if(!_0x445658)return _0x1fd771;let _0x2132c9=_0xce48e2['replace'](/(.*realspace)/,''),_0x388e36=_0xce48e2['replace'](/\/rest\/realspace/g,'')['replace'](_0x2132c9,'');return _0x388e36+='/rest/realspace'+_0x2132c9+'data/path/'+_0x1fd771['replace'](/^\.*/,'')['replace'](/^\//,'')['replace'](/\/$/,''),_0x181afd(_0x2cff55['CREDENTIAL'])&&(_0x181afd(_0x2cff55['CREDENTIAL']['_keymap'][_0xce48e2])?_0x388e36=_0x2cff55['addTokenWithKey'](_0xce48e2,_0x388e36):_0x388e36=_0x2cff55['addToken'](_0x388e36)),_0x388e36;}function _0x5c65ea(_0x4d7286,_0x546980){if(_0x4d7286['center']){const _0x1ae027=new Cesium['Matrix3'](),_0x43dbdb=new Cesium['Cartesian3'](_0x4d7286['center']['x'],_0x4d7286['center']['y'],_0x4d7286['center']['z']);Cesium['Matrix4']['multiplyByPoint'](_0x546980,_0x43dbdb,_0x43dbdb);const _0x583031=new Cesium['Cartesian4'](_0x4d7286['xExtent']['x'],_0x4d7286['xExtent']['y'],_0x4d7286['xExtent']['z'],0x0),_0x544cd4=new Cesium['Cartesian4'](_0x4d7286['yExtent']['x'],_0x4d7286['yExtent']['y'],_0x4d7286['yExtent']['z'],0x0),_0x279ab8=new Cesium['Cartesian4'](_0x4d7286['zExtent']['x'],_0x4d7286['zExtent']['y'],_0x4d7286['zExtent']['z'],0x0);return Cesium['Matrix4']['multiplyByVector'](_0x546980,_0x583031,_0x583031),Cesium['Matrix4']['multiplyByVector'](_0x546980,_0x544cd4,_0x544cd4),Cesium['Matrix4']['multiplyByVector'](_0x546980,_0x279ab8,_0x279ab8),Cesium['Matrix3']['setColumn'](_0x1ae027,0x0,_0x583031,_0x1ae027),Cesium['Matrix3']['setColumn'](_0x1ae027,0x1,_0x544cd4,_0x1ae027),Cesium['Matrix3']['setColumn'](_0x1ae027,0x2,_0x279ab8,_0x1ae027),new Cesium['TileOrientedBoundingBox'](_0x43dbdb,_0x1ae027);}const _0x4ead2b=[];_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['min']['x'],_0x4d7286['min']['y'],_0x4d7286['min']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['min']['x'],_0x4d7286['min']['y'],_0x4d7286['max']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['min']['x'],_0x4d7286['max']['y'],_0x4d7286['min']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['min']['x'],_0x4d7286['max']['y'],_0x4d7286['max']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['max']['x'],_0x4d7286['min']['y'],_0x4d7286['min']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['max']['x'],_0x4d7286['min']['y'],_0x4d7286['max']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['max']['x'],_0x4d7286['max']['y'],_0x4d7286['min']['z'])),_0x4ead2b['push'](new Cesium['Cartesian3'](_0x4d7286['max']['x'],_0x4d7286['max']['y'],_0x4d7286['max']['z']));for(let _0x52bdc1=0x0;_0x52bdc1<0x8;_0x52bdc1++){_0x4ead2b[_0x52bdc1]=Cesium['Matrix4']['multiplyByPoint'](_0x546980,_0x4ead2b[_0x52bdc1],_0x4ead2b[_0x52bdc1]);}const _0x3d16a=Cesium['OrientedBoundingBox']['fromPoints'](_0x4ead2b);return new Cesium['TileOrientedBoundingBox'](_0x3d16a['center'],_0x3d16a['halfAxes']);}_0x1ccd4d['prototype']['createBoundingVolume']=function(_0x2e5eae,_0xd54be6){if(Cesium['defined'](_0x2e5eae['sphere']))return _0x3452d3(_0x2e5eae['sphere'],_0xd54be6);if(Cesium['defined'](_0x2e5eae['box']))return _0x5c65ea(_0x2e5eae['box'],_0xd54be6);if(_0x2e5eae['boundingVolume'])return _0x2e5eae;return undefined;},_0x1ccd4d['prototype']['distanceToTile']=function(_0x559306){let _0x447b25=this['boundingVolume'];return _0x447b25['distanceToCamera'](_0x559306);};let _0x98e38a=new Cesium['Cartesian3']();_0x1ccd4d['prototype']['distanceToTileCenter']=function(_0x5b5cbf){const _0x567ebd=this['boundingVolume'],_0x27c793=_0x567ebd['boundingVolume'],_0x142548=Cesium['Cartesian3']['subtract'](_0x27c793['center'],_0x5b5cbf['camera']['positionWC'],_0x98e38a);return Cesium['Cartesian3']['dot'](_0x5b5cbf['camera']['directionWC'],_0x142548);},_0x1ccd4d['prototype']['visibility']=function(_0x33152d,_0x354687){let _0x11547b=this['boundingVolume'];return _0x33152d['cullingVolume']['computeVisibilityWithPlaneMask'](_0x11547b,_0x354687);};let _0x543b8e=new Cesium['Cartesian3']();function _0xb53c80(_0x12c1b6,_0x3e80a5){const _0x5d22d0=_0x3e80a5['camera'],_0xf06c6d=_0x12c1b6['boundingVolume'],_0x558fc=_0xf06c6d['boundingVolume'],_0xad9f87=_0x558fc['radius'],_0x3ac19a=Cesium['Cartesian3']['multiplyByScalar'](_0x5d22d0['directionWC'],_0x12c1b6['centerZDepth'],_0x543b8e),_0x319c66=Cesium['Cartesian3']['add'](_0x5d22d0['positionWC'],_0x3ac19a,_0x543b8e),_0x3b5607=Cesium['Cartesian3']['subtract'](_0x319c66,_0x558fc['center'],_0x543b8e),_0x9c1a33=Cesium['Cartesian3']['magnitude'](_0x3b5607),_0x169f99=_0x9c1a33>_0xad9f87;if(_0x169f99){const _0x434418=Cesium['Cartesian3']['normalize'](_0x3b5607,_0x543b8e),_0x984145=Cesium['Cartesian3']['multiplyByScalar'](_0x434418,_0xad9f87,_0x543b8e),_0x1279a1=Cesium['Cartesian3']['add'](_0x558fc['center'],_0x984145,_0x543b8e),_0xb7b90c=Cesium['Cartesian3']['subtract'](_0x1279a1,_0x5d22d0['positionWC'],_0x543b8e),_0x3565e3=Cesium['Cartesian3']['normalize'](_0xb7b90c,_0x543b8e);_0x12c1b6['foveatedFactor']=0x1-Math['abs'](Cesium['Cartesian3']['dot'](_0x5d22d0['directionWC'],_0x3565e3));}else _0x12c1b6['foveatedFactor']=0x0;}_0x1ccd4d['prototype']['updateVisibility']=function(_0x220563,_0x116d50){let _0x2eab52=this['parent'],_0x5d218c=Cesium['defined'](_0x2eab52)?_0x2eab52['visibilityPlaneMask']:Cesium['CullingVolume']['MASK_INDETERMINATE'];this['distanceToCamera']=this['distanceToTile'](_0x220563),this['centerZDepth']=this['distanceToTileCenter'](_0x220563),this['visibilityPlaneMask']=this['visibility'](_0x220563,_0x5d218c),this['visible']=this['visibilityPlaneMask']!==Cesium['CullingVolume']['MASK_OUTSIDE']&&this['distanceToCamera']>=_0x116d50['visibleDistanceMin']&&this['distanceToCamera']<=_0x116d50['visibleDistanceMax'],_0xb53c80(this,_0x220563);};function _0x456b56(_0x1ce990){return function(){return _0x1ce990['priority'];};}function _0x220e6c(_0x3e13c7){return function(_0x516047){_0x3e13c7['contentState']=_0x3d5abb['FAILED'],_0x3e13c7['contentReadyPromise']['reject'](_0x516047);};}function _0x24cbea(_0x2a23cd,_0x495d9d){let _0x5375d4=_0x2a23cd['layer'],_0x156926=_0x495d9d['length'];for(let _0x253378=0x0;_0x253378<_0x156926;_0x253378++){const _0x5f04f5=new _0x3c311d();let _0x28b010=_0x495d9d[_0x253378],_0x485168=_0x28b010['boundingVolume'],_0x570293=_0x28b010['childTile'];_0x5f04f5['fileName']=_0x2a23cd['baseUri']+_0x570293,_0x5f04f5['rangeData']=_0x28b010['rangeList'],_0x5f04f5['rangeMode']=_0x28b010['rangeMode'];if(_0x485168['obb'])_0x5f04f5['boundingVolume']=_0x5c65ea(_0x485168['obb'],_0x5375d4['modelMatrix']);else{if(_0x485168['box'])_0x5f04f5['boundingVolume']=_0x5c65ea(_0x485168['box'],_0x5375d4['modelMatrix']);else _0x485168['sphere']&&(_0x485168['isCalc']?_0x5f04f5['boundingVolume']=new Cesium['TileBoundingSphere'](_0x485168['sphere']['center'],_0x485168['sphere']['radius']):_0x5f04f5['boundingVolume']=_0x3452d3(_0x485168['sphere'],_0x5375d4['modelMatrix']));}_0x5f04f5['renderEntities']=_0x28b010['renderEntities'],_0x5f04f5['isLeafTile']=_0x28b010['isLeafTile'],_0x2a23cd['pageLods']['push'](_0x5f04f5);}}function _0x44d3ef(_0x2ad8c1,_0x23c07d,_0x5bd400){let _0x59fd78=_0x23c07d[_0x5bd400['fileName']];if(!_0x59fd78)return;_0x5bd400['blockKey']=_0x5bd400['fileName'],_0x5bd400['isAncestorBlock']=!![];let _0x92ab9e=_0x568e05['parse'](_0x2ad8c1,_0x5bd400,_0x59fd78);_0x24cbea(_0x5bd400,_0x92ab9e);let _0x535b58=[_0x5bd400];while(_0x535b58['length']){let _0x4debb1=_0x535b58['pop']();for(let _0x557482=0x0,_0x110492=_0x4debb1['pageLods']['length'];_0x557482<_0x110492;_0x557482++){const _0x26d627=_0x4debb1['pageLods'][_0x557482],_0x1b3dcb=_0x26d627['fileName'];if(_0x1b3dcb==='')continue;const _0x68e0a0=new _0x1ccd4d(_0x2ad8c1,_0x4debb1,_0x26d627['boundingVolume'],_0x1b3dcb);_0x68e0a0['rootBatchIdMap']=_0x181afd(_0x59fd78)?_0x59fd78['rootBatchIdMap']:_0x4debb1['rootBatchIdMap'],_0x68e0a0['ancestorMap']=_0x181afd(_0x59fd78)?_0x59fd78['ancestorMap']:_0x4debb1['ancestorMap'],_0x26d627['childTile']=_0x68e0a0,_0x59fd78=_0x23c07d[_0x1b3dcb];if(_0x181afd(_0x59fd78)){_0x68e0a0['blockKey']=_0x4debb1['blockKey'],_0x68e0a0['isChildBlock']=!![],_0x68e0a0['contentState']=_0x3d5abb['LOADED'];let _0x13f52e=_0x568e05['parse'](_0x2ad8c1,_0x68e0a0,_0x59fd78);_0x24cbea(_0x68e0a0,_0x13f52e),_0x535b58['push'](_0x68e0a0);}else _0x68e0a0['isAncestorBlock']=!![],_0x68e0a0['blockKey']=_0x1b3dcb;}}}function _0x5542ff(_0x422552,_0x3cb244,_0x5e1e54){_0x422552['_cache']['add'](_0x3cb244);if(_0x422552['_isS3MBlock']){let _0x40c8cb=_0x47fe9e['parseBuffer'](_0x5e1e54,_0x3cb244);_0x44d3ef(_0x422552,_0x40c8cb,_0x3cb244),_0x3cb244['contentState']=_0x3d5abb['LOADED'],_0x3cb244['contentReadyPromise']['resolve'](!![]);return;}let _0x32ec2d;if(_0x3cb244['fileExtension']==='s3mb')_0x32ec2d=_0xf36016['parseBuffer'](_0x5e1e54);else _0x3cb244['fileExtension']==='s3m'&&(_0x32ec2d=_0x1d605d['parseBuffer'](_0x5e1e54));if(!_0x32ec2d){_0x3cb244['contentState']=_0x3d5abb['FAILED'],_0x3cb244['contentReadyPromise']['reject']();return;}let _0x5910e8=_0x4bdc38['parse'](_0x422552,_0x32ec2d,_0x3cb244);_0x24cbea(_0x3cb244,_0x5910e8),_0x3cb244['contentState']=_0x3d5abb['LOADED'],_0x3cb244['contentReadyPromise']&&_0x3cb244['contentReadyPromise']['resolve'](_0x32ec2d);}_0x1ccd4d['prototype']['requestContent']=function(){let _0x3eb0cd=this,_0x3ddfe8=this['layer'];const _0x334dea=_0x3ddfe8['_subdomainConfig'];if(_0x3ddfe8['_isS3MBlock']&&_0x3ddfe8['_blockCache']['contains'](_0x3ddfe8['id'],this['blockKey'])){let _0x528138=_0x3ddfe8['_blockCache']['get'](_0x3ddfe8['id'],this['blockKey']);return this['contentReadyPromise']=_0xee9f6b(),_0x5542ff(_0x3ddfe8,this,_0x528138),!![];}let _0x293d00=this['contentResource']['clone'](),_0x5e351e=/({.*?})/g;if(Cesium['defined'](_0x334dea['subdomains'])){let _0x3aaeb9=_0x334dea['subdomains'],_0x31439e=_0x3aaeb9['length'],_0xe05060=_0x3aaeb9[parseInt(Math['random']()*_0x31439e)];_0x293d00['url']=_0x293d00['url']['replace'](_0x5e351e,function(_0x4ec695,_0x3d34ad){if(_0x3d34ad==='{s}')return _0xe05060;return _0x4ec695;});}let _0x3bfc97=new Cesium['Request']({'throttle':!![],'throttleByServer':!![],'type':Cesium['RequestType']['TILES3D'],'priorityFunction':_0x456b56(this),'serverKey':this['serverKey']});this['request']=_0x3bfc97,_0x293d00['request']=_0x3bfc97;let _0x1a6590=_0x293d00['fetchArrayBuffer']();if(!Cesium['defined'](_0x1a6590))return![];this['contentState']=_0x3d5abb['LOADING'],this['contentReadyPromise']=_0xee9f6b();let _0x1e9b66=_0x220e6c(this);return _0x1a6590['then'](function(_0x2ecdf6){if(_0x3eb0cd['isDestroyed']()){_0x1e9b66();return;}_0x5542ff(_0x3ddfe8,_0x3eb0cd,_0x2ecdf6);},_0x51a70a=>{if(_0x3bfc97['state']===Cesium['RequestState']['CANCELLED']){_0x3eb0cd['contentState']=_0x3d5abb['UNLOADED'];return;}_0x1e9b66(_0x51a70a);}),!![];};function _0x473576(_0x389366,_0xd4834e,_0x53de9c){return Math['max'](Cesium['Math']['normalize'](_0x389366,_0xd4834e,_0x53de9c)-Cesium['Math']['EPSILON7'],0x0);}function _0x5503f9(_0x1ba06b,_0x227375,_0x4ba8cf){let _0x580135=_0x1ba06b*Math['pow'](0xa,_0x227375),_0x222b7f=parseInt(_0x580135);return _0x222b7f*Math['pow'](0xa,_0x4ba8cf);}_0x1ccd4d['prototype']['updatePriority']=function(_0x2dae1f,_0x3b2c5d){let _0x56156e=_0x2dae1f['_minimumPriority'],_0x2350d3=_0x2dae1f['_maximumPriority'],_0x362901=0x4,_0x156e13=0x4,_0x291d1b=_0x473576(this['foveatedFactor'],_0x56156e['foveatedFactor'],_0x2350d3['foveatedFactor']),_0x16b641=_0x5503f9(_0x291d1b,_0x156e13,_0x362901);_0x362901=0x8;let _0xb75d06=_0x473576(this['pixel'],_0x56156e['pixel'],_0x2350d3['pixel']),_0x58a9d8=_0x5503f9(0x1-_0xb75d06,_0x156e13,_0x362901);_0x362901=0x0;let _0xf5560f=_0x473576(this['distanceToCamera'],_0x56156e['distance'],_0x2350d3['distance']),_0x40ebdb=_0x5503f9(_0xf5560f,_0x156e13,_0x362901);this['priority']=_0x16b641+_0x58a9d8+_0x40ebdb;},_0x1ccd4d['prototype']['transformResource']=function(_0x5f35a8,_0x150a74){const _0x442535=_0x5f35a8['context'];let _0x5494ac=!![];for(let _0x42998b=0x0,_0x1db782=this['pageLods']['length'];_0x42998b<_0x1db782;_0x42998b++){const _0x5e0361=this['pageLods'][_0x42998b];var _0x5a0884=!![];for(let _0x4d5e4d=0x0,_0x25afd5=_0x5e0361['renderEntities']['length'];_0x4d5e4d<_0x25afd5;_0x4d5e4d++){const _0x59106f=_0x5e0361['renderEntities'][_0x4d5e4d];if(!_0x59106f['ready']){_0x5494ac=![],_0x5a0884=![];try{_0x59106f['transformResource'](_0x5f35a8,_0x150a74);}catch(_0x2834ba){console['log'](_0x2834ba);}}}_0x5e0361['ready']=_0x5a0884;}_0x5494ac&&(this['contentState']=_0x3d5abb['READY']);},_0x1ccd4d['prototype']['update']=function(_0x157a37,_0x2242fc){},_0x1ccd4d['prototype']['free']=function(){this['contentState']=_0x3d5abb['UNLOADED'],this['request']=undefined,this['cacheNode']=undefined,this['contentReadyPromise']=undefined;for(let _0x198b82=0x0,_0x2ddd40=this['pageLods']['length'];_0x198b82<_0x2ddd40;_0x198b82++){const _0x337bcd=this['pageLods'][_0x198b82];_0x337bcd['destroy']();}this['pageLods']['length']=0x0;},_0x1ccd4d['prototype']['isDestroyed']=function(){return![];},_0x1ccd4d['prototype']['destroy']=function(){return this['free'](),Cesium['destroyObject'](this);};export default _0x1ccd4d;