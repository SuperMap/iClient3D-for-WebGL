const _0x3838ae=(function(){let _0x2d5217=!![];return function(_0x410313,_0x5d4d03){const _0x481c21=_0x2d5217?function(){if(_0x5d4d03){const _0x318e14=_0x5d4d03['apply'](_0x410313,arguments);return _0x5d4d03=null,_0x318e14;}}:function(){};return _0x2d5217=![],_0x481c21;};}()),_0x578905=_0x3838ae(this,function(){return _0x578905['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x578905)['search']('(((.+)+)+)+$');});_0x578905();import _0xf1fee1 from'./Enum/ContentState.js';import _0x7146ea from'./S3ModelParser.js';import _0x4a4bcc from'./S3ModelOldParser.js';import _0x8f322 from'./S3MBlockParser.js';import _0x227040 from'./S3MContentParser.js';import _0x540afc from'./S3MBlockContentParser.js';import _0x20b9a9 from'./Enum/RangeMode.js';import _0x8e526b from'../ThirdParty/defer.js';import _0x12196b from'../Credential/Credential.js';import _0x28a320 from'./S3MPageLod.js';const _0x4dbd95=Cesium['defined'];function _0x5f1c69(_0x3f8544,_0x10606e,_0x54ecb4,_0x2ef3ed){this['layer']=_0x3f8544,this['parent']=_0x10606e;let _0x1dbe00=_0x2ef3ed['replace'](/\\/g,'/');this['fileExtension']=Cesium['getExtensionFromUri'](_0x2ef3ed),this['relativePath']=_0x3925a5(_0x1dbe00,_0x3f8544),this['fileName']=_0x2ef3ed,this['isLeafTile']=![],this['isRootTile']=![],this['boundingVolume']=this['createBoundingVolume'](_0x54ecb4,_0x3f8544['modelMatrix']);let _0x10452c=Cesium['Resource']['createIfNeeded'](_0x3f8544['_baseResource']);if(Cesium['defined'](_0x10606e))this['baseUri']=_0x10606e['baseUri'];else{let _0x4f5b24=new Cesium['Resource'](_0x1dbe00);this['baseUri']=_0x4f5b24['getBaseUri']();}this['contentResource']=_0x10452c['getDerivedResource']({'url':this['relativePath']}),this['serverKey']=Cesium['RequestScheduler']['getServerKey'](this['contentResource']['getUrlComponent']()),this['request']=undefined,this['cacheNode']=undefined,this['distanceToCamera']=0x0,this['centerZDepth']=0x0,this['depth']=_0x10606e?_0x10606e['depth']+0x1:0x0,this['visibilityPlaneMask']=0x0,this['visible']=![],this['pageLods']=[],this['renderEntities']=[],this['contentState']=_0xf1fee1['UNLOADED'],this['touchedFrame']=0x0,this['requestedFrame']=0x0,this['processFrame']=0x0,this['updatedVisibilityFrame']=0x0,this['foveatedFactor']=0x0,this['priority']=0x0,this['rootName']=!_0x10606e?this['fileName']:_0x10606e['rootName'],this['blockKey']='',this['isAncestorBlock']=![],this['isChildBlock']=![],this['rootBatchIdMap']={},this['ancestorMap']={};}let _0x4def51=new Cesium['Cartesian3']();function _0x573c6a(_0x440943,_0x4ff030){let _0x577b47=Cesium['Cartesian3']['clone'](_0x440943['center']),_0x28498c=_0x440943['radius'];_0x577b47=Cesium['Matrix4']['multiplyByPoint'](_0x4ff030,_0x577b47,_0x577b47);let _0x214148=Cesium['Matrix4']['getScale'](_0x4ff030,_0x4def51),_0x148787=Cesium['Cartesian3']['maximumComponent'](_0x214148);return _0x28498c*=_0x148787,new Cesium['TileBoundingSphere'](_0x577b47,_0x28498c);}function _0x3925a5(_0x2af834,_0x4ab41e){_0x2af834=_0x2af834['replace'](/\+/g,'%2B');let _0x25bf82=_0x4ab41e['_basePath'],_0x53273d=_0x4ab41e['_basePath']['indexOf']('realspace')>-0x1;if(!_0x53273d)return _0x2af834;let _0x2d0460=_0x25bf82['replace'](/(.*realspace)/,''),_0x1779e6=_0x25bf82['replace'](/\/rest\/realspace/g,'')['replace'](_0x2d0460,'');return _0x1779e6+='/rest/realspace'+_0x2d0460+'data/path/'+_0x2af834['replace'](/^\.*/,'')['replace'](/^\//,'')['replace'](/\/$/,''),_0x4dbd95(_0x12196b['CREDENTIAL'])&&(_0x4dbd95(_0x12196b['CREDENTIAL']['_keymap'][_0x25bf82])?_0x1779e6=_0x12196b['addTokenWithKey'](_0x25bf82,_0x1779e6):_0x1779e6=_0x12196b['addToken'](_0x1779e6)),_0x1779e6;}function _0x1b4b42(_0x3d0027,_0x5c3a4a){if(_0x3d0027['center']){const _0x26ed66=new Cesium['Matrix3'](),_0x1d81f3=new Cesium['Cartesian3'](_0x3d0027['center']['x'],_0x3d0027['center']['y'],_0x3d0027['center']['z']);Cesium['Matrix4']['multiplyByPoint'](_0x5c3a4a,_0x1d81f3,_0x1d81f3);const _0xa09df1=new Cesium['Cartesian4'](_0x3d0027['xExtent']['x'],_0x3d0027['xExtent']['y'],_0x3d0027['xExtent']['z'],0x0),_0x43dd03=new Cesium['Cartesian4'](_0x3d0027['yExtent']['x'],_0x3d0027['yExtent']['y'],_0x3d0027['yExtent']['z'],0x0),_0x725e85=new Cesium['Cartesian4'](_0x3d0027['zExtent']['x'],_0x3d0027['zExtent']['y'],_0x3d0027['zExtent']['z'],0x0);return Cesium['Matrix4']['multiplyByVector'](_0x5c3a4a,_0xa09df1,_0xa09df1),Cesium['Matrix4']['multiplyByVector'](_0x5c3a4a,_0x43dd03,_0x43dd03),Cesium['Matrix4']['multiplyByVector'](_0x5c3a4a,_0x725e85,_0x725e85),Cesium['Matrix3']['setColumn'](_0x26ed66,0x0,_0xa09df1,_0x26ed66),Cesium['Matrix3']['setColumn'](_0x26ed66,0x1,_0x43dd03,_0x26ed66),Cesium['Matrix3']['setColumn'](_0x26ed66,0x2,_0x725e85,_0x26ed66),new Cesium['TileOrientedBoundingBox'](_0x1d81f3,_0x26ed66);}const _0xc07602=[];_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['min']['x'],_0x3d0027['min']['y'],_0x3d0027['min']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['min']['x'],_0x3d0027['min']['y'],_0x3d0027['max']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['min']['x'],_0x3d0027['max']['y'],_0x3d0027['min']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['min']['x'],_0x3d0027['max']['y'],_0x3d0027['max']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['max']['x'],_0x3d0027['min']['y'],_0x3d0027['min']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['max']['x'],_0x3d0027['min']['y'],_0x3d0027['max']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['max']['x'],_0x3d0027['max']['y'],_0x3d0027['min']['z'])),_0xc07602['push'](new Cesium['Cartesian3'](_0x3d0027['max']['x'],_0x3d0027['max']['y'],_0x3d0027['max']['z']));for(let _0x114490=0x0;_0x114490<0x8;_0x114490++){_0xc07602[_0x114490]=Cesium['Matrix4']['multiplyByPoint'](_0x5c3a4a,_0xc07602[_0x114490],_0xc07602[_0x114490]);}const _0x5400d1=Cesium['OrientedBoundingBox']['fromPoints'](_0xc07602);return new Cesium['TileOrientedBoundingBox'](_0x5400d1['center'],_0x5400d1['halfAxes']);}_0x5f1c69['prototype']['createBoundingVolume']=function(_0x2bced5,_0x31a023){if(Cesium['defined'](_0x2bced5['sphere']))return _0x573c6a(_0x2bced5['sphere'],_0x31a023);if(Cesium['defined'](_0x2bced5['box']))return _0x1b4b42(_0x2bced5['box'],_0x31a023);if(_0x2bced5['boundingVolume'])return _0x2bced5;return undefined;},_0x5f1c69['prototype']['distanceToTile']=function(_0x3c2524){let _0xd06713=this['boundingVolume'];return _0xd06713['distanceToCamera'](_0x3c2524);};let _0x454bd8=new Cesium['Cartesian3']();_0x5f1c69['prototype']['distanceToTileCenter']=function(_0x2a33c9){const _0xaa5921=this['boundingVolume'],_0x18422=_0xaa5921['boundingVolume'],_0x586ad9=Cesium['Cartesian3']['subtract'](_0x18422['center'],_0x2a33c9['camera']['positionWC'],_0x454bd8);return Cesium['Cartesian3']['dot'](_0x2a33c9['camera']['directionWC'],_0x586ad9);},_0x5f1c69['prototype']['visibility']=function(_0x1d7f3d,_0x15256c){let _0x4038e1=this['boundingVolume'];return _0x1d7f3d['cullingVolume']['computeVisibilityWithPlaneMask'](_0x4038e1,_0x15256c);};let _0x58e905=new Cesium['Cartesian3']();function _0x183088(_0x2a1f9b,_0x8a1ed0){const _0x2c0aa8=_0x8a1ed0['camera'],_0x91817d=_0x2a1f9b['boundingVolume'],_0x542439=_0x91817d['boundingVolume'],_0x5ed314=_0x542439['radius'],_0x235208=Cesium['Cartesian3']['multiplyByScalar'](_0x2c0aa8['directionWC'],_0x2a1f9b['centerZDepth'],_0x58e905),_0x35c511=Cesium['Cartesian3']['add'](_0x2c0aa8['positionWC'],_0x235208,_0x58e905),_0x2aa2d0=Cesium['Cartesian3']['subtract'](_0x35c511,_0x542439['center'],_0x58e905),_0x2bdd4a=Cesium['Cartesian3']['magnitude'](_0x2aa2d0),_0x50310e=_0x2bdd4a>_0x5ed314;if(_0x50310e){const _0x3966c3=Cesium['Cartesian3']['normalize'](_0x2aa2d0,_0x58e905),_0x154c9b=Cesium['Cartesian3']['multiplyByScalar'](_0x3966c3,_0x5ed314,_0x58e905),_0xe5ecbe=Cesium['Cartesian3']['add'](_0x542439['center'],_0x154c9b,_0x58e905),_0x2fa28e=Cesium['Cartesian3']['subtract'](_0xe5ecbe,_0x2c0aa8['positionWC'],_0x58e905),_0x136810=Cesium['Cartesian3']['normalize'](_0x2fa28e,_0x58e905);_0x2a1f9b['foveatedFactor']=0x1-Math['abs'](Cesium['Cartesian3']['dot'](_0x2c0aa8['directionWC'],_0x136810));}else _0x2a1f9b['foveatedFactor']=0x0;}_0x5f1c69['prototype']['updateVisibility']=function(_0x8eeb4f,_0x40a8e9){let _0x2cac07=this['parent'],_0x19a6e1=Cesium['defined'](_0x2cac07)?_0x2cac07['visibilityPlaneMask']:Cesium['CullingVolume']['MASK_INDETERMINATE'];this['distanceToCamera']=this['distanceToTile'](_0x8eeb4f),this['centerZDepth']=this['distanceToTileCenter'](_0x8eeb4f),this['visibilityPlaneMask']=this['visibility'](_0x8eeb4f,_0x19a6e1),this['visible']=this['visibilityPlaneMask']!==Cesium['CullingVolume']['MASK_OUTSIDE']&&this['distanceToCamera']>=_0x40a8e9['visibleDistanceMin']&&this['distanceToCamera']<=_0x40a8e9['visibleDistanceMax'],_0x183088(this,_0x8eeb4f);};function _0x246003(_0x1a8042){return function(){return _0x1a8042['priority'];};}function _0x1db1c8(_0x4a07a3){return function(_0x22788a){_0x4a07a3['contentState']=_0xf1fee1['FAILED'],_0x4a07a3['contentReadyPromise']['reject'](_0x22788a);};}function _0x2aa57a(_0x2d9ebb,_0x3cfa02){let _0x92a1f6=_0x2d9ebb['layer'],_0x59db22=_0x3cfa02['length'];for(let _0x266378=0x0;_0x266378<_0x59db22;_0x266378++){const _0x41c891=new _0x28a320();let _0x4c2851=_0x3cfa02[_0x266378],_0x1b5260=_0x4c2851['boundingVolume'],_0x2d2a31=_0x4c2851['childTile'];_0x41c891['fileName']=_0x2d9ebb['baseUri']+_0x2d2a31,_0x41c891['rangeData']=_0x4c2851['rangeList'],_0x41c891['rangeMode']=_0x4c2851['rangeMode'];if(_0x1b5260['obb'])_0x41c891['boundingVolume']=_0x1b4b42(_0x1b5260['obb'],_0x92a1f6['modelMatrix']);else{if(_0x1b5260['box'])_0x41c891['boundingVolume']=_0x1b4b42(_0x1b5260['box'],_0x92a1f6['modelMatrix']);else _0x1b5260['sphere']&&(_0x1b5260['isCalc']?_0x41c891['boundingVolume']=new Cesium['TileBoundingSphere'](_0x1b5260['sphere']['center'],_0x1b5260['sphere']['radius']):_0x41c891['boundingVolume']=_0x573c6a(_0x1b5260['sphere'],_0x92a1f6['modelMatrix']));}_0x41c891['renderEntities']=_0x4c2851['renderEntities'],_0x41c891['isLeafTile']=_0x4c2851['isLeafTile'],_0x2d9ebb['pageLods']['push'](_0x41c891);}}function _0x34171d(_0x5d75e5,_0x21f17f,_0xcb554f){let _0x278a65=_0x21f17f[_0xcb554f['fileName']];if(!_0x278a65)return;_0xcb554f['blockKey']=_0xcb554f['fileName'],_0xcb554f['isAncestorBlock']=!![];let _0x634aee=_0x540afc['parse'](_0x5d75e5,_0xcb554f,_0x278a65);_0x2aa57a(_0xcb554f,_0x634aee);let _0x55617b=[_0xcb554f];while(_0x55617b['length']){let _0x5e3a6c=_0x55617b['pop']();for(let _0x41cfbf=0x0,_0x558e69=_0x5e3a6c['pageLods']['length'];_0x41cfbf<_0x558e69;_0x41cfbf++){const _0x19fde1=_0x5e3a6c['pageLods'][_0x41cfbf],_0x508c9d=_0x19fde1['fileName'];if(_0x508c9d==='')continue;const _0x2bb6c4=new _0x5f1c69(_0x5d75e5,_0x5e3a6c,_0x19fde1['boundingVolume'],_0x508c9d);_0x2bb6c4['rootBatchIdMap']=_0x4dbd95(_0x278a65)?_0x278a65['rootBatchIdMap']:_0x5e3a6c['rootBatchIdMap'],_0x2bb6c4['ancestorMap']=_0x4dbd95(_0x278a65)?_0x278a65['ancestorMap']:_0x5e3a6c['ancestorMap'],_0x19fde1['childTile']=_0x2bb6c4,_0x278a65=_0x21f17f[_0x508c9d];if(_0x4dbd95(_0x278a65)){_0x2bb6c4['blockKey']=_0x5e3a6c['blockKey'],_0x2bb6c4['isChildBlock']=!![],_0x2bb6c4['contentState']=_0xf1fee1['LOADED'];let _0x420346=_0x540afc['parse'](_0x5d75e5,_0x2bb6c4,_0x278a65);_0x2aa57a(_0x2bb6c4,_0x420346),_0x55617b['push'](_0x2bb6c4);}else _0x2bb6c4['isAncestorBlock']=!![],_0x2bb6c4['blockKey']=_0x508c9d;}}}function _0x1c33ac(_0x3204de,_0x3dbc15,_0x4c4d18){_0x3204de['_cache']['add'](_0x3dbc15);if(_0x3204de['_isS3MBlock']){let _0x3004f6=_0x8f322['parseBuffer'](_0x4c4d18,_0x3dbc15);_0x34171d(_0x3204de,_0x3004f6,_0x3dbc15),_0x3dbc15['contentState']=_0xf1fee1['LOADED'],_0x3dbc15['contentReadyPromise']['resolve'](!![]);return;}let _0x34f04d;if(_0x3dbc15['fileExtension']==='s3mb')_0x34f04d=_0x7146ea['parseBuffer'](_0x4c4d18);else _0x3dbc15['fileExtension']==='s3m'&&(_0x34f04d=_0x4a4bcc['parseBuffer'](_0x4c4d18));if(!_0x34f04d){_0x3dbc15['contentState']=_0xf1fee1['FAILED'],_0x3dbc15['contentReadyPromise']['reject']();return;}let _0x521561=_0x227040['parse'](_0x3204de,_0x34f04d,_0x3dbc15);_0x2aa57a(_0x3dbc15,_0x521561),_0x3dbc15['contentState']=_0xf1fee1['LOADED'],_0x3dbc15['contentReadyPromise']&&_0x3dbc15['contentReadyPromise']['resolve'](_0x34f04d);}_0x5f1c69['prototype']['requestContent']=function(){let _0x15bf92=this,_0x10c716=this['layer'];const _0x30c368=_0x10c716['_subdomainConfig'];if(_0x10c716['_isS3MBlock']&&_0x10c716['_blockCache']['contains'](_0x10c716['id'],this['blockKey'])){let _0x32bd14=_0x10c716['_blockCache']['get'](_0x10c716['id'],this['blockKey']);return this['contentReadyPromise']=_0x8e526b(),_0x1c33ac(_0x10c716,this,_0x32bd14),!![];}let _0x28b8b2=this['contentResource']['clone'](),_0x522882=/({.*?})/g;if(Cesium['defined'](_0x30c368['subdomains'])){let _0x462829=_0x30c368['subdomains'],_0x170fc0=_0x462829['length'],_0x1bcb94=_0x462829[parseInt(Math['random']()*_0x170fc0)];_0x28b8b2['url']=_0x28b8b2['url']['replace'](_0x522882,function(_0x3401cb,_0x27247e){if(_0x27247e==='{s}')return _0x1bcb94;return _0x3401cb;});}let _0x5a2090=new Cesium['Request']({'throttle':!![],'throttleByServer':!![],'type':Cesium['RequestType']['TILES3D'],'priorityFunction':_0x246003(this),'serverKey':this['serverKey']});this['request']=_0x5a2090,_0x28b8b2['request']=_0x5a2090;let _0x203286=_0x28b8b2['fetchArrayBuffer']();if(!Cesium['defined'](_0x203286))return![];this['contentState']=_0xf1fee1['LOADING'],this['contentReadyPromise']=_0x8e526b();let _0x27e881=_0x1db1c8(this);return _0x203286['then'](function(_0x2915cb){if(_0x15bf92['isDestroyed']()){_0x27e881();return;}_0x1c33ac(_0x10c716,_0x15bf92,_0x2915cb);},_0x45ccfd=>{if(_0x5a2090['state']===Cesium['RequestState']['CANCELLED']){_0x15bf92['contentState']=_0xf1fee1['UNLOADED'];return;}_0x27e881(_0x45ccfd);}),!![];};function _0x2f5d86(_0x8ffd48,_0x52f5bb,_0x3a523b){return Math['max'](Cesium['Math']['normalize'](_0x8ffd48,_0x52f5bb,_0x3a523b)-Cesium['Math']['EPSILON7'],0x0);}function _0x5dd88e(_0x533a71,_0x83775c,_0xa80b49){let _0x31a16e=_0x533a71*Math['pow'](0xa,_0x83775c),_0x4318e5=parseInt(_0x31a16e);return _0x4318e5*Math['pow'](0xa,_0xa80b49);}_0x5f1c69['prototype']['updatePriority']=function(_0x23462f,_0x59691b){let _0x13d86e=_0x23462f['_minimumPriority'],_0x33a878=_0x23462f['_maximumPriority'],_0x560f9e=0x4,_0x37b126=0x4,_0x2a4cb5=_0x2f5d86(this['foveatedFactor'],_0x13d86e['foveatedFactor'],_0x33a878['foveatedFactor']),_0x3dd3b4=_0x5dd88e(_0x2a4cb5,_0x37b126,_0x560f9e);_0x560f9e=0x8;let _0x3a506a=_0x2f5d86(this['pixel'],_0x13d86e['pixel'],_0x33a878['pixel']),_0x32daf1=_0x5dd88e(0x1-_0x3a506a,_0x37b126,_0x560f9e);_0x560f9e=0x0;let _0x1a4992=_0x2f5d86(this['distanceToCamera'],_0x13d86e['distance'],_0x33a878['distance']),_0x296b82=_0x5dd88e(_0x1a4992,_0x37b126,_0x560f9e);this['priority']=_0x3dd3b4+_0x32daf1+_0x296b82;},_0x5f1c69['prototype']['transformResource']=function(_0x2fcc16,_0x1011a0){const _0x327828=_0x2fcc16['context'];let _0x31f540=!![];for(let _0x58941b=0x0,_0x3e4a3e=this['pageLods']['length'];_0x58941b<_0x3e4a3e;_0x58941b++){const _0x265812=this['pageLods'][_0x58941b];var _0x247203=!![];for(let _0xa4fa31=0x0,_0x4dbba0=_0x265812['renderEntities']['length'];_0xa4fa31<_0x4dbba0;_0xa4fa31++){const _0x4facab=_0x265812['renderEntities'][_0xa4fa31];if(!_0x4facab['ready']){_0x31f540=![],_0x247203=![];try{_0x4facab['transformResource'](_0x2fcc16,_0x1011a0);}catch(_0x16f506){console['log'](_0x16f506);}}}_0x265812['ready']=_0x247203;}_0x31f540&&(this['contentState']=_0xf1fee1['READY']);},_0x5f1c69['prototype']['update']=function(_0x2b6a24,_0x28fc35){},_0x5f1c69['prototype']['free']=function(){this['contentState']=_0xf1fee1['UNLOADED'],this['request']=undefined,this['cacheNode']=undefined,this['contentReadyPromise']=undefined;for(let _0x7d386d=0x0,_0x4af82c=this['pageLods']['length'];_0x7d386d<_0x4af82c;_0x7d386d++){const _0x3dbe06=this['pageLods'][_0x7d386d];_0x3dbe06['destroy']();}this['pageLods']['length']=0x0;},_0x5f1c69['prototype']['isDestroyed']=function(){return![];},_0x5f1c69['prototype']['destroy']=function(){return this['free'](),Cesium['destroyObject'](this);};export default _0x5f1c69;