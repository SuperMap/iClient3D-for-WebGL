const _0x3a975b=(function(){let _0x76ee6a=!![];return function(_0x34fc0b,_0x5b8d73){const _0x5296c8=_0x76ee6a?function(){if(_0x5b8d73){const _0x146b27=_0x5b8d73['apply'](_0x34fc0b,arguments);return _0x5b8d73=null,_0x146b27;}}:function(){};return _0x76ee6a=![],_0x5296c8;};}()),_0xcb7369=_0x3a975b(this,function(){return _0xcb7369['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0xcb7369)['search']('(((.+)+)+)+$');});_0xcb7369();import _0x81dd8 from'./Enum/ContentState.js';import _0x29547c from'./S3ModelParser.js';import _0x27f534 from'./S3ModelOldParser.js';import _0x5ee668 from'./S3MBlockParser.js';import _0x5cf1fc from'./S3MContentParser.js';import _0x57af1e from'./S3MBlockContentParser.js';import _0x44383f from'./Enum/RangeMode.js';import _0xc44e90 from'../ThirdParty/defer.js';import _0x57b40a from'../Credential/Credential.js';import _0x51ea9f from'./S3MPageLod.js';const _0x8dcda2=Cesium['defined'];function _0x414b17(_0x35a639,_0x162dc6,_0xdb91aa,_0x2fb91c){this['layer']=_0x35a639,this['parent']=_0x162dc6;let _0x42e6b2=_0x2fb91c['replace'](/\\/g,'/');this['fileExtension']=Cesium['getExtensionFromUri'](_0x2fb91c),this['relativePath']=_0x318e71(_0x42e6b2,_0x35a639),this['fileName']=_0x2fb91c,this['isLeafTile']=![],this['isRootTile']=![],this['boundingVolume']=this['createBoundingVolume'](_0xdb91aa,_0x35a639['modelMatrix']);let _0x2f84bb=Cesium['Resource']['createIfNeeded'](_0x35a639['_baseResource']);if(Cesium['defined'](_0x162dc6))this['baseUri']=_0x162dc6['baseUri'];else{let _0x3bb093=new Cesium['Resource'](_0x42e6b2);this['baseUri']=_0x3bb093['getBaseUri']();}this['contentResource']=_0x2f84bb['getDerivedResource']({'url':this['relativePath'],'headers':_0x35a639['customRequestHeaders']}),this['serverKey']=Cesium['RequestScheduler']['getServerKey'](this['contentResource']['getUrlComponent']()),this['request']=undefined,this['cacheNode']=undefined,this['distanceToCamera']=0x0,this['centerZDepth']=0x0,this['depth']=_0x162dc6?_0x162dc6['depth']+0x1:0x0,this['visibilityPlaneMask']=0x0,this['visible']=![],this['pageLods']=[],this['renderEntities']=[],this['contentState']=_0x81dd8['UNLOADED'],this['touchedFrame']=0x0,this['requestedFrame']=0x0,this['processFrame']=0x0,this['updatedVisibilityFrame']=0x0,this['foveatedFactor']=0x0,this['priority']=0x0,this['rootName']=!_0x162dc6?this['fileName']:_0x162dc6['rootName'],this['blockKey']='',this['isAncestorBlock']=![],this['isChildBlock']=![],this['rootBatchIdMap']={},this['ancestorMap']={};}let _0x44431f=new Cesium['Cartesian3']();function _0x1fbfec(_0x17ba67,_0x4dbbf5){let _0x879e89=Cesium['Cartesian3']['clone'](_0x17ba67['center']),_0x413a30=_0x17ba67['radius'];_0x879e89=Cesium['Matrix4']['multiplyByPoint'](_0x4dbbf5,_0x879e89,_0x879e89);let _0x15bece=Cesium['Matrix4']['getScale'](_0x4dbbf5,_0x44431f),_0x27530e=Cesium['Cartesian3']['maximumComponent'](_0x15bece);return _0x413a30*=_0x27530e,new Cesium['TileBoundingSphere'](_0x879e89,_0x413a30);}function _0x318e71(_0x338ff0,_0x588e17){_0x338ff0=_0x338ff0['replace'](/\+/g,'%2B');let _0x1aaef5=_0x588e17['_basePath'],_0x5f0feb=_0x588e17['_basePath']['indexOf']('realspace')>-0x1;if(!_0x5f0feb)return _0x338ff0;let _0x501818=_0x1aaef5['replace'](/(.*realspace)/,''),_0x2c6b7d=_0x1aaef5['replace'](/\/rest\/realspace/g,'')['replace'](_0x501818,'');return _0x2c6b7d+='/rest/realspace'+_0x501818+'data/path/'+_0x338ff0['replace'](/^\.*/,'')['replace'](/^\//,'')['replace'](/\/$/,''),_0x8dcda2(_0x57b40a['CREDENTIAL'])&&(_0x8dcda2(_0x57b40a['CREDENTIAL']['_keymap'][_0x1aaef5])?_0x2c6b7d=_0x57b40a['addTokenWithKey'](_0x1aaef5,_0x2c6b7d):_0x2c6b7d=_0x57b40a['addToken'](_0x2c6b7d)),_0x2c6b7d;}function _0x67cfcd(_0x4b8cad,_0x138ff5){if(_0x4b8cad['center']){const _0x160051=new Cesium['Matrix3'](),_0x4b4397=new Cesium['Cartesian3'](_0x4b8cad['center']['x'],_0x4b8cad['center']['y'],_0x4b8cad['center']['z']);Cesium['Matrix4']['multiplyByPoint'](_0x138ff5,_0x4b4397,_0x4b4397);const _0x5ccc66=new Cesium['Cartesian4'](_0x4b8cad['xExtent']['x'],_0x4b8cad['xExtent']['y'],_0x4b8cad['xExtent']['z'],0x0),_0x1bd324=new Cesium['Cartesian4'](_0x4b8cad['yExtent']['x'],_0x4b8cad['yExtent']['y'],_0x4b8cad['yExtent']['z'],0x0),_0x38c61e=new Cesium['Cartesian4'](_0x4b8cad['zExtent']['x'],_0x4b8cad['zExtent']['y'],_0x4b8cad['zExtent']['z'],0x0);return Cesium['Matrix4']['multiplyByVector'](_0x138ff5,_0x5ccc66,_0x5ccc66),Cesium['Matrix4']['multiplyByVector'](_0x138ff5,_0x1bd324,_0x1bd324),Cesium['Matrix4']['multiplyByVector'](_0x138ff5,_0x38c61e,_0x38c61e),Cesium['Matrix3']['setColumn'](_0x160051,0x0,_0x5ccc66,_0x160051),Cesium['Matrix3']['setColumn'](_0x160051,0x1,_0x1bd324,_0x160051),Cesium['Matrix3']['setColumn'](_0x160051,0x2,_0x38c61e,_0x160051),new Cesium['TileOrientedBoundingBox'](_0x4b4397,_0x160051);}const _0x47def4=[];_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['min']['x'],_0x4b8cad['min']['y'],_0x4b8cad['min']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['min']['x'],_0x4b8cad['min']['y'],_0x4b8cad['max']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['min']['x'],_0x4b8cad['max']['y'],_0x4b8cad['min']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['min']['x'],_0x4b8cad['max']['y'],_0x4b8cad['max']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['max']['x'],_0x4b8cad['min']['y'],_0x4b8cad['min']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['max']['x'],_0x4b8cad['min']['y'],_0x4b8cad['max']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['max']['x'],_0x4b8cad['max']['y'],_0x4b8cad['min']['z'])),_0x47def4['push'](new Cesium['Cartesian3'](_0x4b8cad['max']['x'],_0x4b8cad['max']['y'],_0x4b8cad['max']['z']));for(let _0x4b2dd3=0x0;_0x4b2dd3<0x8;_0x4b2dd3++){_0x47def4[_0x4b2dd3]=Cesium['Matrix4']['multiplyByPoint'](_0x138ff5,_0x47def4[_0x4b2dd3],_0x47def4[_0x4b2dd3]);}const _0x1d3a90=Cesium['OrientedBoundingBox']['fromPoints'](_0x47def4);return new Cesium['TileOrientedBoundingBox'](_0x1d3a90['center'],_0x1d3a90['halfAxes']);}_0x414b17['prototype']['createBoundingVolume']=function(_0x4d3017,_0x3c7e18){if(Cesium['defined'](_0x4d3017['sphere']))return _0x1fbfec(_0x4d3017['sphere'],_0x3c7e18);if(Cesium['defined'](_0x4d3017['box']))return _0x67cfcd(_0x4d3017['box'],_0x3c7e18);if(_0x4d3017['boundingVolume'])return _0x4d3017;return undefined;},_0x414b17['prototype']['distanceToTile']=function(_0x2d939d){let _0x1e8c5e=this['boundingVolume'];return _0x1e8c5e['distanceToCamera'](_0x2d939d);};let _0x3a4a95=new Cesium['Cartesian3']();_0x414b17['prototype']['distanceToTileCenter']=function(_0x48be68){const _0x582783=this['boundingVolume'],_0x50f0e6=_0x582783['boundingVolume'],_0x8795c6=Cesium['Cartesian3']['subtract'](_0x50f0e6['center'],_0x48be68['camera']['positionWC'],_0x3a4a95);return Cesium['Cartesian3']['dot'](_0x48be68['camera']['directionWC'],_0x8795c6);},_0x414b17['prototype']['visibility']=function(_0x5db219,_0x3cb902){let _0x702ee0=this['boundingVolume'];return _0x5db219['cullingVolume']['computeVisibilityWithPlaneMask'](_0x702ee0,_0x3cb902);};let _0x1e1f17=new Cesium['Cartesian3']();function _0x49b98f(_0x3769c6,_0x2122a8){const _0x2dc552=_0x2122a8['camera'],_0x512c3d=_0x3769c6['boundingVolume'],_0x28d3b6=_0x512c3d['boundingVolume'],_0x107714=_0x28d3b6['radius'],_0x53dfdc=Cesium['Cartesian3']['multiplyByScalar'](_0x2dc552['directionWC'],_0x3769c6['centerZDepth'],_0x1e1f17),_0xba06a4=Cesium['Cartesian3']['add'](_0x2dc552['positionWC'],_0x53dfdc,_0x1e1f17),_0x301fae=Cesium['Cartesian3']['subtract'](_0xba06a4,_0x28d3b6['center'],_0x1e1f17),_0x152548=Cesium['Cartesian3']['magnitude'](_0x301fae),_0x421d26=_0x152548>_0x107714;if(_0x421d26){const _0x3a9026=Cesium['Cartesian3']['normalize'](_0x301fae,_0x1e1f17),_0x49c9eb=Cesium['Cartesian3']['multiplyByScalar'](_0x3a9026,_0x107714,_0x1e1f17),_0xa4f454=Cesium['Cartesian3']['add'](_0x28d3b6['center'],_0x49c9eb,_0x1e1f17),_0x539974=Cesium['Cartesian3']['subtract'](_0xa4f454,_0x2dc552['positionWC'],_0x1e1f17),_0x3ab697=Cesium['Cartesian3']['normalize'](_0x539974,_0x1e1f17);_0x3769c6['foveatedFactor']=0x1-Math['abs'](Cesium['Cartesian3']['dot'](_0x2dc552['directionWC'],_0x3ab697));}else _0x3769c6['foveatedFactor']=0x0;}_0x414b17['prototype']['updateVisibility']=function(_0x4d1892,_0x5b749e){let _0x3e296d=this['parent'],_0x2692f6=Cesium['defined'](_0x3e296d)?_0x3e296d['visibilityPlaneMask']:Cesium['CullingVolume']['MASK_INDETERMINATE'];this['distanceToCamera']=this['distanceToTile'](_0x4d1892),this['centerZDepth']=this['distanceToTileCenter'](_0x4d1892),this['visibilityPlaneMask']=this['visibility'](_0x4d1892,_0x2692f6),this['visible']=this['visibilityPlaneMask']!==Cesium['CullingVolume']['MASK_OUTSIDE']&&this['distanceToCamera']>=_0x5b749e['visibleDistanceMin']&&this['distanceToCamera']<=_0x5b749e['visibleDistanceMax'],_0x49b98f(this,_0x4d1892);};function _0x28e091(_0x9476f4){return function(){return _0x9476f4['priority'];};}function _0x545747(_0x43daf9){return function(_0x1ea967){_0x43daf9['contentState']=_0x81dd8['FAILED'],_0x43daf9['contentReadyPromise']['reject'](_0x1ea967);};}function _0x53d37f(_0x324f28,_0x2bc82c){let _0x4a48a5=_0x324f28['layer'],_0x57ae92=_0x2bc82c['length'];for(let _0x1cd036=0x0;_0x1cd036<_0x57ae92;_0x1cd036++){const _0xc50a36=new _0x51ea9f();let _0x5d05a3=_0x2bc82c[_0x1cd036],_0x3f5251=_0x5d05a3['boundingVolume'],_0x2c2f13=_0x5d05a3['childTile'];_0xc50a36['fileName']=_0x324f28['baseUri']+_0x2c2f13,_0xc50a36['rangeData']=_0x5d05a3['rangeList'],_0xc50a36['rangeMode']=_0x5d05a3['rangeMode'];if(_0x3f5251['obb'])_0xc50a36['boundingVolume']=_0x67cfcd(_0x3f5251['obb'],_0x4a48a5['modelMatrix']);else{if(_0x3f5251['box'])_0xc50a36['boundingVolume']=_0x67cfcd(_0x3f5251['box'],_0x4a48a5['modelMatrix']);else _0x3f5251['sphere']&&(_0x3f5251['isCalc']?_0xc50a36['boundingVolume']=new Cesium['TileBoundingSphere'](_0x3f5251['sphere']['center'],_0x3f5251['sphere']['radius']):_0xc50a36['boundingVolume']=_0x1fbfec(_0x3f5251['sphere'],_0x4a48a5['modelMatrix']));}_0xc50a36['renderEntities']=_0x5d05a3['renderEntities'],_0xc50a36['isLeafTile']=_0x5d05a3['isLeafTile'],_0x324f28['pageLods']['push'](_0xc50a36);}}function _0x142cad(_0x6c73a0,_0x121b80,_0x11a31c){let _0x15b66c=_0x121b80[_0x11a31c['fileName']];if(!_0x15b66c)return;_0x11a31c['blockKey']=_0x11a31c['fileName'],_0x11a31c['isAncestorBlock']=!![];let _0x40862c=_0x57af1e['parse'](_0x6c73a0,_0x11a31c,_0x15b66c);_0x53d37f(_0x11a31c,_0x40862c);let _0x2a5770=[_0x11a31c];while(_0x2a5770['length']){let _0x4579c8=_0x2a5770['pop']();for(let _0x28203a=0x0,_0xd5a3c8=_0x4579c8['pageLods']['length'];_0x28203a<_0xd5a3c8;_0x28203a++){const _0x305d14=_0x4579c8['pageLods'][_0x28203a],_0x2997cf=_0x305d14['fileName'];if(_0x2997cf==='')continue;const _0x4f6b5c=new _0x414b17(_0x6c73a0,_0x4579c8,_0x305d14['boundingVolume'],_0x2997cf);_0x4f6b5c['rootBatchIdMap']=_0x8dcda2(_0x15b66c)?_0x15b66c['rootBatchIdMap']:_0x4579c8['rootBatchIdMap'],_0x4f6b5c['ancestorMap']=_0x8dcda2(_0x15b66c)?_0x15b66c['ancestorMap']:_0x4579c8['ancestorMap'],_0x305d14['childTile']=_0x4f6b5c,_0x15b66c=_0x121b80[_0x2997cf];if(_0x8dcda2(_0x15b66c)){_0x4f6b5c['blockKey']=_0x4579c8['blockKey'],_0x4f6b5c['isChildBlock']=!![],_0x4f6b5c['contentState']=_0x81dd8['LOADED'];let _0x23a425=_0x57af1e['parse'](_0x6c73a0,_0x4f6b5c,_0x15b66c);_0x53d37f(_0x4f6b5c,_0x23a425),_0x2a5770['push'](_0x4f6b5c);}else _0x4f6b5c['isAncestorBlock']=!![],_0x4f6b5c['blockKey']=_0x2997cf;}}}function _0xe9dca2(_0x37cefb,_0x4798ad,_0x10fb78){_0x37cefb['_cache']['add'](_0x4798ad);if(_0x37cefb['_isS3MBlock']){let _0x49749b=_0x5ee668['parseBuffer'](_0x10fb78,_0x4798ad);_0x142cad(_0x37cefb,_0x49749b,_0x4798ad),_0x4798ad['contentState']=_0x81dd8['LOADED'],_0x4798ad['contentReadyPromise']['resolve'](!![]);return;}let _0x2dd571;if(_0x4798ad['fileExtension']==='s3mb')_0x2dd571=_0x29547c['parseBuffer'](_0x10fb78);else _0x4798ad['fileExtension']==='s3m'&&(_0x2dd571=_0x27f534['parseBuffer'](_0x10fb78));if(!_0x2dd571){_0x4798ad['contentState']=_0x81dd8['FAILED'],_0x4798ad['contentReadyPromise']['reject']();return;}let _0x1b694b=_0x5cf1fc['parse'](_0x37cefb,_0x2dd571,_0x4798ad);_0x53d37f(_0x4798ad,_0x1b694b),_0x4798ad['contentState']=_0x81dd8['LOADED'],_0x4798ad['contentReadyPromise']&&_0x4798ad['contentReadyPromise']['resolve'](_0x2dd571);}_0x414b17['prototype']['requestContent']=function(){let _0x5f2a95=this,_0x188ffe=this['layer'];const _0x10976f=_0x188ffe['_subdomainConfig'];if(_0x188ffe['_isS3MBlock']&&_0x188ffe['_blockCache']['contains'](_0x188ffe['id'],this['blockKey'])){let _0x7988f7=_0x188ffe['_blockCache']['get'](_0x188ffe['id'],this['blockKey']);return this['contentReadyPromise']=_0xc44e90(),_0xe9dca2(_0x188ffe,this,_0x7988f7),!![];}let _0x12f906=this['contentResource']['clone'](),_0x2a4a40=/({.*?})/g;if(Cesium['defined'](_0x10976f['subdomains'])){let _0x12601c=_0x10976f['subdomains'],_0xbe86d4=_0x12601c['length'],_0x45190c=_0x12601c[parseInt(Math['random']()*_0xbe86d4)];_0x12f906['url']=_0x12f906['url']['replace'](_0x2a4a40,function(_0x1b5b13,_0x114fa6){if(_0x114fa6==='{s}')return _0x45190c;return _0x1b5b13;});}let _0x50dbd7=new Cesium['Request']({'throttle':!![],'throttleByServer':!![],'type':Cesium['RequestType']['TILES3D'],'priorityFunction':_0x28e091(this),'serverKey':this['serverKey']});this['request']=_0x50dbd7,_0x12f906['request']=_0x50dbd7;let _0x53d6ad=_0x12f906['fetchArrayBuffer']();if(!Cesium['defined'](_0x53d6ad))return![];this['contentState']=_0x81dd8['LOADING'],this['contentReadyPromise']=_0xc44e90();let _0x233ce3=_0x545747(this);return _0x53d6ad['then'](function(_0x5d2f4f){if(_0x5f2a95['isDestroyed']()){_0x233ce3();return;}_0xe9dca2(_0x188ffe,_0x5f2a95,_0x5d2f4f);},_0xc339f8=>{if(_0x50dbd7['state']===Cesium['RequestState']['CANCELLED']){_0x5f2a95['contentState']=_0x81dd8['UNLOADED'];return;}_0x233ce3(_0xc339f8);}),!![];};function _0x39f896(_0x47e130,_0x255c61,_0x1c57d5){return Math['max'](Cesium['Math']['normalize'](_0x47e130,_0x255c61,_0x1c57d5)-Cesium['Math']['EPSILON7'],0x0);}function _0x9266dd(_0x466019,_0x38806e,_0x58163a){let _0x52b98e=_0x466019*Math['pow'](0xa,_0x38806e),_0x28b5d0=parseInt(_0x52b98e);return _0x28b5d0*Math['pow'](0xa,_0x58163a);}_0x414b17['prototype']['updatePriority']=function(_0x26764d,_0x3d6df1){let _0x44987b=_0x26764d['_minimumPriority'],_0x301cfe=_0x26764d['_maximumPriority'],_0x11e6e0=0x4,_0x4af3b1=0x4,_0x17e9ad=_0x39f896(this['foveatedFactor'],_0x44987b['foveatedFactor'],_0x301cfe['foveatedFactor']),_0x503b47=_0x9266dd(_0x17e9ad,_0x4af3b1,_0x11e6e0);_0x11e6e0=0x8;let _0x471e92=_0x39f896(this['pixel'],_0x44987b['pixel'],_0x301cfe['pixel']),_0x510c56=_0x9266dd(0x1-_0x471e92,_0x4af3b1,_0x11e6e0);_0x11e6e0=0x0;let _0x598a00=_0x39f896(this['distanceToCamera'],_0x44987b['distance'],_0x301cfe['distance']),_0x53a32a=_0x9266dd(_0x598a00,_0x4af3b1,_0x11e6e0);this['priority']=_0x503b47+_0x510c56+_0x53a32a;},_0x414b17['prototype']['transformResource']=function(_0x52decb,_0x3c55cf){const _0xa6f4ed=_0x52decb['context'];let _0x170027=!![];for(let _0x29a139=0x0,_0x5e8f32=this['pageLods']['length'];_0x29a139<_0x5e8f32;_0x29a139++){const _0xd9e47e=this['pageLods'][_0x29a139];var _0x43098d=!![];for(let _0x1af00f=0x0,_0x4da8e9=_0xd9e47e['renderEntities']['length'];_0x1af00f<_0x4da8e9;_0x1af00f++){const _0x2a3af1=_0xd9e47e['renderEntities'][_0x1af00f];if(!_0x2a3af1['ready']){_0x170027=![],_0x43098d=![];try{_0x2a3af1['transformResource'](_0x52decb,_0x3c55cf);}catch(_0x431bbb){console['log'](_0x431bbb);}}}_0xd9e47e['ready']=_0x43098d;}_0x170027&&(this['contentState']=_0x81dd8['READY']);},_0x414b17['prototype']['update']=function(_0x33cbf4,_0x515fd7){},_0x414b17['prototype']['free']=function(){this['contentState']=_0x81dd8['UNLOADED'],this['request']=undefined,this['cacheNode']=undefined,this['contentReadyPromise']=undefined;for(let _0x395ca9=0x0,_0x2b1baf=this['pageLods']['length'];_0x395ca9<_0x2b1baf;_0x395ca9++){const _0x2321b8=this['pageLods'][_0x395ca9];_0x2321b8['destroy']();}this['pageLods']['length']=0x0;},_0x414b17['prototype']['isDestroyed']=function(){return![];},_0x414b17['prototype']['destroy']=function(){return this['free'](),Cesium['destroyObject'](this);};export default _0x414b17;