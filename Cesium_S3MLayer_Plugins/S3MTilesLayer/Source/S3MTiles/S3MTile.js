const _0x1645ed=(function(){let _0xcf3f9d=!![];return function(_0x4d6764,_0x18a30a){const _0x2fa982=_0xcf3f9d?function(){if(_0x18a30a){const _0x5561b1=_0x18a30a['apply'](_0x4d6764,arguments);return _0x18a30a=null,_0x5561b1;}}:function(){};return _0xcf3f9d=![],_0x2fa982;};}()),_0x245317=_0x1645ed(this,function(){return _0x245317['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](_0x245317)['search']('(((.+)+)+)+$');});_0x245317();import _0x122b7e from'./Enum/ContentState.js';import _0x54fd63 from'./S3ModelParser.js';import _0x540f57 from'./S3ModelOldParser.js';import _0x496d3b from'./S3MBlockParser.js';import _0x3d306e from'./S3MContentParser.js';import _0x4dcc3e from'./S3MBlockContentParser.js';import _0x18eda4 from'./Enum/RangeMode.js';import _0x5f48c8 from'../ThirdParty/defer.js';import _0x5479a9 from'../Credential/Credential.js';import _0x285776 from'./S3MPageLod.js';const _0x481ec8=Cesium['defined'];function _0x56c988(_0x448426,_0x72eec2,_0x2c6efe,_0x46ce8b){this['layer']=_0x448426,this['parent']=_0x72eec2;let _0x25d863=_0x46ce8b['replace'](/\\/g,'/');this['fileExtension']=Cesium['getExtensionFromUri'](_0x46ce8b),this['relativePath']=_0xe97bab(_0x25d863,_0x448426),this['fileName']=_0x46ce8b,this['isLeafTile']=![],this['isRootTile']=![],this['boundingVolume']=this['createBoundingVolume'](_0x2c6efe,_0x448426['modelMatrix']);let _0x2282a2=Cesium['Resource']['createIfNeeded'](_0x448426['_baseResource']);if(Cesium['defined'](_0x72eec2))this['baseUri']=_0x72eec2['baseUri'];else{let _0x20df37=new Cesium['Resource'](_0x25d863);this['baseUri']=_0x20df37['getBaseUri']();}this['contentResource']=_0x2282a2['getDerivedResource']({'url':this['relativePath'],'headers':_0x448426['customRequestHeaders']}),this['serverKey']=Cesium['RequestScheduler']['getServerKey'](this['contentResource']['getUrlComponent']()),this['request']=undefined,this['cacheNode']=undefined,this['distanceToCamera']=0x0,this['centerZDepth']=0x0,this['depth']=_0x72eec2?_0x72eec2['depth']+0x1:0x0,this['visibilityPlaneMask']=0x0,this['visible']=![],this['pageLods']=[],this['renderEntities']=[],this['contentState']=_0x122b7e['UNLOADED'],this['touchedFrame']=0x0,this['requestedFrame']=0x0,this['processFrame']=0x0,this['updatedVisibilityFrame']=0x0,this['foveatedFactor']=0x0,this['priority']=0x0,this['rootName']=!_0x72eec2?this['fileName']:_0x72eec2['rootName'],this['blockKey']='',this['isAncestorBlock']=![],this['isChildBlock']=![],this['rootBatchIdMap']={},this['ancestorMap']={};}let _0x45b63c=new Cesium['Cartesian3']();function _0x47d355(_0x365110,_0x28d83c){let _0x3df8b2=Cesium['Cartesian3']['clone'](_0x365110['center']),_0x2af0fc=_0x365110['radius'];_0x3df8b2=Cesium['Matrix4']['multiplyByPoint'](_0x28d83c,_0x3df8b2,_0x3df8b2);let _0x5e563c=Cesium['Matrix4']['getScale'](_0x28d83c,_0x45b63c),_0x200634=Cesium['Cartesian3']['maximumComponent'](_0x5e563c);return _0x2af0fc*=_0x200634,new Cesium['TileBoundingSphere'](_0x3df8b2,_0x2af0fc);}function _0xe97bab(_0x404be0,_0x3d5ce2){_0x404be0=_0x404be0['replace'](/\+/g,'%2B');let _0xa57e04=_0x3d5ce2['_basePath'],_0x141e3d=_0x3d5ce2['_basePath']['indexOf']('realspace')>-0x1;if(!_0x141e3d)return _0x404be0;let _0x3fdbb2=_0xa57e04['replace'](/(.*realspace)/,''),_0x23e071=_0xa57e04['replace'](/\/rest\/realspace/g,'')['replace'](_0x3fdbb2,'');return _0x23e071+='/rest/realspace'+_0x3fdbb2+'data/path/'+_0x404be0['replace'](/^\.*/,'')['replace'](/^\//,'')['replace'](/\/$/,''),_0x481ec8(_0x5479a9['CREDENTIAL'])&&(_0x481ec8(_0x5479a9['CREDENTIAL']['_keymap'][_0xa57e04])?_0x23e071=_0x5479a9['addTokenWithKey'](_0xa57e04,_0x23e071):_0x23e071=_0x5479a9['addToken'](_0x23e071)),_0x23e071;}function _0x2bd3aa(_0x54053a,_0xa579bc){if(_0x54053a['center']){const _0x2a38c7=new Cesium['Matrix3'](),_0x568bf4=new Cesium['Cartesian3'](_0x54053a['center']['x'],_0x54053a['center']['y'],_0x54053a['center']['z']);Cesium['Matrix4']['multiplyByPoint'](_0xa579bc,_0x568bf4,_0x568bf4);const _0x12833f=new Cesium['Cartesian4'](_0x54053a['xExtent']['x'],_0x54053a['xExtent']['y'],_0x54053a['xExtent']['z'],0x0),_0x4527c9=new Cesium['Cartesian4'](_0x54053a['yExtent']['x'],_0x54053a['yExtent']['y'],_0x54053a['yExtent']['z'],0x0),_0x3de098=new Cesium['Cartesian4'](_0x54053a['zExtent']['x'],_0x54053a['zExtent']['y'],_0x54053a['zExtent']['z'],0x0);return Cesium['Matrix4']['multiplyByVector'](_0xa579bc,_0x12833f,_0x12833f),Cesium['Matrix4']['multiplyByVector'](_0xa579bc,_0x4527c9,_0x4527c9),Cesium['Matrix4']['multiplyByVector'](_0xa579bc,_0x3de098,_0x3de098),Cesium['Matrix3']['setColumn'](_0x2a38c7,0x0,_0x12833f,_0x2a38c7),Cesium['Matrix3']['setColumn'](_0x2a38c7,0x1,_0x4527c9,_0x2a38c7),Cesium['Matrix3']['setColumn'](_0x2a38c7,0x2,_0x3de098,_0x2a38c7),new Cesium['TileOrientedBoundingBox'](_0x568bf4,_0x2a38c7);}const _0x11d5ee=[];_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['min']['x'],_0x54053a['min']['y'],_0x54053a['min']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['min']['x'],_0x54053a['min']['y'],_0x54053a['max']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['min']['x'],_0x54053a['max']['y'],_0x54053a['min']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['min']['x'],_0x54053a['max']['y'],_0x54053a['max']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['max']['x'],_0x54053a['min']['y'],_0x54053a['min']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['max']['x'],_0x54053a['min']['y'],_0x54053a['max']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['max']['x'],_0x54053a['max']['y'],_0x54053a['min']['z'])),_0x11d5ee['push'](new Cesium['Cartesian3'](_0x54053a['max']['x'],_0x54053a['max']['y'],_0x54053a['max']['z']));for(let _0x593dfc=0x0;_0x593dfc<0x8;_0x593dfc++){_0x11d5ee[_0x593dfc]=Cesium['Matrix4']['multiplyByPoint'](_0xa579bc,_0x11d5ee[_0x593dfc],_0x11d5ee[_0x593dfc]);}const _0x50c204=Cesium['OrientedBoundingBox']['fromPoints'](_0x11d5ee);return new Cesium['TileOrientedBoundingBox'](_0x50c204['center'],_0x50c204['halfAxes']);}_0x56c988['prototype']['createBoundingVolume']=function(_0x433a45,_0x4ef1b0){if(Cesium['defined'](_0x433a45['sphere']))return _0x47d355(_0x433a45['sphere'],_0x4ef1b0);if(Cesium['defined'](_0x433a45['box']))return _0x2bd3aa(_0x433a45['box'],_0x4ef1b0);if(_0x433a45['boundingVolume'])return _0x433a45;return undefined;},_0x56c988['prototype']['distanceToTile']=function(_0xcebd43){let _0x53a2c3=this['boundingVolume'];return _0x53a2c3['distanceToCamera'](_0xcebd43);};let _0x396a82=new Cesium['Cartesian3']();_0x56c988['prototype']['distanceToTileCenter']=function(_0x50dfc9){const _0x3a9288=this['boundingVolume'],_0xe28c80=_0x3a9288['boundingVolume'],_0x1a7e63=Cesium['Cartesian3']['subtract'](_0xe28c80['center'],_0x50dfc9['camera']['positionWC'],_0x396a82);return Cesium['Cartesian3']['dot'](_0x50dfc9['camera']['directionWC'],_0x1a7e63);},_0x56c988['prototype']['visibility']=function(_0x4282be,_0x19d7a6){let _0x5b9009=this['boundingVolume'];return _0x4282be['cullingVolume']['computeVisibilityWithPlaneMask'](_0x5b9009,_0x19d7a6);};let _0x28d3b1=new Cesium['Cartesian3']();function _0x191614(_0x7a4c17,_0x416cf9){const _0x58f8df=_0x416cf9['camera'],_0x5ada19=_0x7a4c17['boundingVolume'],_0x16a438=_0x5ada19['boundingVolume'],_0x481beb=_0x16a438['radius'],_0x49018f=Cesium['Cartesian3']['multiplyByScalar'](_0x58f8df['directionWC'],_0x7a4c17['centerZDepth'],_0x28d3b1),_0x2b40a1=Cesium['Cartesian3']['add'](_0x58f8df['positionWC'],_0x49018f,_0x28d3b1),_0x422204=Cesium['Cartesian3']['subtract'](_0x2b40a1,_0x16a438['center'],_0x28d3b1),_0xb571c7=Cesium['Cartesian3']['magnitude'](_0x422204),_0x2be5e3=_0xb571c7>_0x481beb;if(_0x2be5e3){const _0x400fc2=Cesium['Cartesian3']['normalize'](_0x422204,_0x28d3b1),_0x5b0964=Cesium['Cartesian3']['multiplyByScalar'](_0x400fc2,_0x481beb,_0x28d3b1),_0x14dcd6=Cesium['Cartesian3']['add'](_0x16a438['center'],_0x5b0964,_0x28d3b1),_0x31247e=Cesium['Cartesian3']['subtract'](_0x14dcd6,_0x58f8df['positionWC'],_0x28d3b1),_0x5c4bde=Cesium['Cartesian3']['normalize'](_0x31247e,_0x28d3b1);_0x7a4c17['foveatedFactor']=0x1-Math['abs'](Cesium['Cartesian3']['dot'](_0x58f8df['directionWC'],_0x5c4bde));}else _0x7a4c17['foveatedFactor']=0x0;}_0x56c988['prototype']['updateVisibility']=function(_0x509e2c,_0x217f2c){let _0x3e955a=this['parent'],_0x318b5a=Cesium['defined'](_0x3e955a)?_0x3e955a['visibilityPlaneMask']:Cesium['CullingVolume']['MASK_INDETERMINATE'];this['distanceToCamera']=this['distanceToTile'](_0x509e2c),this['centerZDepth']=this['distanceToTileCenter'](_0x509e2c),this['visibilityPlaneMask']=this['visibility'](_0x509e2c,_0x318b5a),this['visible']=this['visibilityPlaneMask']!==Cesium['CullingVolume']['MASK_OUTSIDE']&&this['distanceToCamera']>=_0x217f2c['visibleDistanceMin']&&this['distanceToCamera']<=_0x217f2c['visibleDistanceMax'],_0x191614(this,_0x509e2c);};function _0x16dd2f(_0x3df170){return function(){return _0x3df170['priority'];};}function _0x320b50(_0x5b87e8){return function(_0x280c0c){_0x5b87e8['contentState']=_0x122b7e['FAILED'],_0x5b87e8['contentReadyPromise']['reject'](_0x280c0c);};}function _0x171530(_0x3155f3,_0xe88020){let _0x4cf862=_0x3155f3['layer'],_0x2f21c8=_0xe88020['length'];for(let _0x4f1642=0x0;_0x4f1642<_0x2f21c8;_0x4f1642++){const _0x37fcb7=new _0x285776();let _0x14c22b=_0xe88020[_0x4f1642],_0x58f4f6=_0x14c22b['boundingVolume'],_0x5338e8=_0x14c22b['childTile'];_0x37fcb7['fileName']=_0x3155f3['baseUri']+_0x5338e8,_0x37fcb7['rangeData']=_0x14c22b['rangeList'],_0x37fcb7['rangeMode']=_0x14c22b['rangeMode'];if(_0x58f4f6['obb'])_0x37fcb7['boundingVolume']=_0x2bd3aa(_0x58f4f6['obb'],_0x4cf862['modelMatrix']);else{if(_0x58f4f6['box'])_0x37fcb7['boundingVolume']=_0x2bd3aa(_0x58f4f6['box'],_0x4cf862['modelMatrix']);else _0x58f4f6['sphere']&&(_0x58f4f6['isCalc']?_0x37fcb7['boundingVolume']=new Cesium['TileBoundingSphere'](_0x58f4f6['sphere']['center'],_0x58f4f6['sphere']['radius']):_0x37fcb7['boundingVolume']=_0x47d355(_0x58f4f6['sphere'],_0x4cf862['modelMatrix']));}_0x37fcb7['renderEntities']=_0x14c22b['renderEntities'],_0x37fcb7['isLeafTile']=_0x14c22b['isLeafTile'],_0x3155f3['pageLods']['push'](_0x37fcb7);}}function _0x23d3d8(_0xb19d98,_0xb208d8,_0x1d14b7){let _0x44add7=_0xb208d8[_0x1d14b7['fileName']];if(!_0x44add7)return;_0x1d14b7['blockKey']=_0x1d14b7['fileName'],_0x1d14b7['isAncestorBlock']=!![];let _0x2ed3cf=_0x4dcc3e['parse'](_0xb19d98,_0x1d14b7,_0x44add7);_0x171530(_0x1d14b7,_0x2ed3cf);let _0x39145b=[_0x1d14b7];while(_0x39145b['length']){let _0x6f5afd=_0x39145b['pop']();for(let _0x457c3f=0x0,_0x5471d8=_0x6f5afd['pageLods']['length'];_0x457c3f<_0x5471d8;_0x457c3f++){const _0x978762=_0x6f5afd['pageLods'][_0x457c3f],_0x239655=_0x978762['fileName'];if(_0x239655==='')continue;const _0x568136=new _0x56c988(_0xb19d98,_0x6f5afd,_0x978762['boundingVolume'],_0x239655);_0x568136['rootBatchIdMap']=_0x481ec8(_0x44add7)?_0x44add7['rootBatchIdMap']:_0x6f5afd['rootBatchIdMap'],_0x568136['ancestorMap']=_0x481ec8(_0x44add7)?_0x44add7['ancestorMap']:_0x6f5afd['ancestorMap'],_0x978762['childTile']=_0x568136,_0x44add7=_0xb208d8[_0x239655];if(_0x481ec8(_0x44add7)){_0x568136['blockKey']=_0x6f5afd['blockKey'],_0x568136['isChildBlock']=!![],_0x568136['contentState']=_0x122b7e['LOADED'];let _0x2a8a7b=_0x4dcc3e['parse'](_0xb19d98,_0x568136,_0x44add7);_0x171530(_0x568136,_0x2a8a7b),_0x39145b['push'](_0x568136);}else _0x568136['isAncestorBlock']=!![],_0x568136['blockKey']=_0x239655;}}}function _0x1ce42c(_0x1588db,_0x387444,_0x305931){_0x1588db['_cache']['add'](_0x387444);if(_0x1588db['_isS3MBlock']){let _0x9ad4bd=_0x496d3b['parseBuffer'](_0x305931,_0x387444);_0x23d3d8(_0x1588db,_0x9ad4bd,_0x387444),_0x387444['contentState']=_0x122b7e['LOADED'],_0x387444['contentReadyPromise']['resolve'](!![]);return;}let _0x38b101;if(_0x387444['fileExtension']==='s3mb')_0x38b101=_0x54fd63['parseBuffer'](_0x305931);else _0x387444['fileExtension']==='s3m'&&(_0x38b101=_0x540f57['parseBuffer'](_0x305931));if(!_0x38b101){_0x387444['contentState']=_0x122b7e['FAILED'],_0x387444['contentReadyPromise']['reject']();return;}let _0x4bca68=_0x3d306e['parse'](_0x1588db,_0x38b101,_0x387444);_0x171530(_0x387444,_0x4bca68),_0x387444['contentState']=_0x122b7e['LOADED'],_0x387444['contentReadyPromise']&&_0x387444['contentReadyPromise']['resolve'](_0x38b101);}_0x56c988['prototype']['requestContent']=function(){let _0x2fecfa=this,_0x49ab10=this['layer'];const _0x12d773=_0x49ab10['_subdomainConfig'];if(_0x49ab10['_isS3MBlock']&&_0x49ab10['_blockCache']['contains'](_0x49ab10['id'],this['blockKey'])){let _0x467f0d=_0x49ab10['_blockCache']['get'](_0x49ab10['id'],this['blockKey']);return this['contentReadyPromise']=_0x5f48c8(),_0x1ce42c(_0x49ab10,this,_0x467f0d),!![];}let _0x22bcc7=this['contentResource']['clone'](),_0x34925e=/({.*?})/g;if(Cesium['defined'](_0x12d773['subdomains'])){let _0x3fee5d=_0x12d773['subdomains'],_0x1f806e=_0x3fee5d['length'],_0x29e780=_0x3fee5d[parseInt(Math['random']()*_0x1f806e)];_0x22bcc7['url']=_0x22bcc7['url']['replace'](_0x34925e,function(_0x5ccc55,_0x1375b6){if(_0x1375b6==='{s}')return _0x29e780;return _0x5ccc55;});}let _0x169dd9=new Cesium['Request']({'throttle':!![],'throttleByServer':!![],'type':Cesium['RequestType']['TILES3D'],'priorityFunction':_0x16dd2f(this),'serverKey':this['serverKey']});this['request']=_0x169dd9,_0x22bcc7['request']=_0x169dd9;let _0x1332ea=_0x22bcc7['fetchArrayBuffer']();if(!Cesium['defined'](_0x1332ea))return![];this['contentState']=_0x122b7e['LOADING'],this['contentReadyPromise']=_0x5f48c8();let _0xfb5b6d=_0x320b50(this);return _0x1332ea['then'](function(_0x4d91bb){if(_0x2fecfa['isDestroyed']()){_0xfb5b6d();return;}_0x1ce42c(_0x49ab10,_0x2fecfa,_0x4d91bb);},_0x18cca4=>{if(_0x169dd9['state']===Cesium['RequestState']['CANCELLED']){_0x2fecfa['contentState']=_0x122b7e['UNLOADED'];return;}_0xfb5b6d(_0x18cca4);}),!![];};function _0x156d1e(_0x17bd0c,_0x4c5e90,_0xbb2212){return Math['max'](Cesium['Math']['normalize'](_0x17bd0c,_0x4c5e90,_0xbb2212)-Cesium['Math']['EPSILON7'],0x0);}function _0x1d09a6(_0x272a6f,_0x3b8783,_0x23aaa8){let _0xa5f619=_0x272a6f*Math['pow'](0xa,_0x3b8783),_0x26eee3=parseInt(_0xa5f619);return _0x26eee3*Math['pow'](0xa,_0x23aaa8);}_0x56c988['prototype']['updatePriority']=function(_0x528026,_0x5bdf51){let _0xcfd4da=_0x528026['_minimumPriority'],_0x5a3c77=_0x528026['_maximumPriority'],_0x3b151a=0x4,_0x3ab8fe=0x4,_0x106cff=_0x156d1e(this['foveatedFactor'],_0xcfd4da['foveatedFactor'],_0x5a3c77['foveatedFactor']),_0x4304fd=_0x1d09a6(_0x106cff,_0x3ab8fe,_0x3b151a);_0x3b151a=0x8;let _0x58cf8e=_0x156d1e(this['pixel'],_0xcfd4da['pixel'],_0x5a3c77['pixel']),_0x436390=_0x1d09a6(0x1-_0x58cf8e,_0x3ab8fe,_0x3b151a);_0x3b151a=0x0;let _0x5cc611=_0x156d1e(this['distanceToCamera'],_0xcfd4da['distance'],_0x5a3c77['distance']),_0x2a875e=_0x1d09a6(_0x5cc611,_0x3ab8fe,_0x3b151a);this['priority']=_0x4304fd+_0x436390+_0x2a875e;},_0x56c988['prototype']['transformResource']=function(_0x24a261,_0x43387a){const _0x47787e=_0x24a261['context'];let _0x4ff5c9=!![];for(let _0x424edb=0x0,_0xff2911=this['pageLods']['length'];_0x424edb<_0xff2911;_0x424edb++){const _0x28b7dd=this['pageLods'][_0x424edb];var _0x3a545f=!![];for(let _0x5d6fb3=0x0,_0x9e356b=_0x28b7dd['renderEntities']['length'];_0x5d6fb3<_0x9e356b;_0x5d6fb3++){const _0xac47c7=_0x28b7dd['renderEntities'][_0x5d6fb3];if(!_0xac47c7['ready']){_0x4ff5c9=![],_0x3a545f=![];try{_0xac47c7['transformResource'](_0x24a261,_0x43387a);}catch(_0x44f0bc){console['log'](_0x44f0bc);}}}_0x28b7dd['ready']=_0x3a545f;}_0x4ff5c9&&(this['contentState']=_0x122b7e['READY']);},_0x56c988['prototype']['update']=function(_0x457d5f,_0x20b4b5){},_0x56c988['prototype']['free']=function(){this['contentState']=_0x122b7e['UNLOADED'],this['request']=undefined,this['cacheNode']=undefined,this['contentReadyPromise']=undefined;for(let _0x1ee792=0x0,_0x18c4e7=this['pageLods']['length'];_0x1ee792<_0x18c4e7;_0x1ee792++){const _0x1fa7bb=this['pageLods'][_0x1ee792];_0x1fa7bb['destroy']();}this['pageLods']['length']=0x0;},_0x56c988['prototype']['isDestroyed']=function(){return![];},_0x56c988['prototype']['destroy']=function(){return this['free'](),Cesium['destroyObject'](this);};export default _0x56c988;